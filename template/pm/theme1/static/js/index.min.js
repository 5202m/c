function openLive800Chat(e){var t="https://www.onlineservice-hk.com/k800/chatClient/chatbox.jsp?companyID=209&s=1";e?location.href=t:window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonv3(e,t){common.isBlank(t)&&(t="800018282");var i="http://crm2.qq.com/page/portalpage/wpa.php?uin="+t+"&cref=&ref=&f=1&ty=1&ap=&as="+e;window.open(i,"QQChatindow","height=544, width=644,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonjs(){var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018282";window.open(e)}function live800Prompt(e){window.onbeforeunload=null;var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886",i="http://onlinecustomer-service.gwghk.com/live800/chatClient/chatbox.jsp?companyID=283&enterurl=http%3A%2F%2Fwww%2Egwfx%2Ecom%2F&tm=1355377642406";if(2==e)try{UUID.prototype.createUUID();window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(a){window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}else try{UUID.prototype.createUUID();window.open(i,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(a){window.open(i)}}function qqPrompt(e){var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886";window.onbeforeunload=null;try{var i=UUID.prototype.createUUID();getGacookiesTrack(i,"2","1"),window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(a){window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}}function UUID(){this.id=this.createUUID()}var common={daysCN:{0:"星期天",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},clientGroupStr:{vip:"VIP会员",active:"激活会员",notActive:"真实会员",simulate:"模拟会员",register:"注册会员",visitor:"游客"},remove:function(e,t){return isNaN(t)||t>e.length?!1:void e.splice(t,1)},joinSplit:function(e){return",".concat(e).concat(",")},isBlank:function(e){return void 0==e||null==e||"undefined"==e||"null"==e||""==$.trim(e)},isValid:function(e){return!this.isBlank(e)},trim:function(e){return this.isBlank(e)?"":e.toString().replace(/(^\s*)|(\s*$)/g,"")},escapeHtml:function(e){return document.createElement("div").appendChild(document.createTextNode(e)).parentNode.innerHTML.replace(/"/g,'\\"')},encodeHtml:function(e){return this.isBlank(e)?"":e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},formatterDate:function(e,t){t||(t="-"),e instanceof Date||(e=new Date(e));var i=e.getFullYear()+t+(e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1))+t+(e.getDate()<10?"0"+e.getDate():e.getDate());return i},getHHMMSS:function(e){e instanceof Date||(e=new Date(e));var t=(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds());return t},getMMSS:function(e){return e instanceof Date||(e=new Date(e)),(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},getHHMM:function(e){e instanceof Date||(e=new Date(e));var t=(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes());return t},formatterDateTime:function(e,t){if(t||(t="-"),e instanceof Date||(e=new Date(e)),"Invalid Date"==e)return"";var i=e.getFullYear()+t+(e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1))+t+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds());return i},longMsTimeToDateTime:function(e,t){var i=new Date(e);return this.formatterDateTime(i,t)},getDaysInMonth:function(e){var t=new Date(e.getFullYear(),e.getMonth()+1,1),i=Math.floor((t.getTime()-e.getTime())/864e5)+e.getDate()-1;return i},showBox:function(e,t){$(e).slideDown(),$(t||".layer-shadow").show()},hideBox:function(e,t){$(e).slideUp(),$(t||".layer-shadow").hide()},containSplitStr:function(e,t){return common.isBlank(e)||common.isBlank(t)?!1:-1!=(","+e+",").indexOf(","+t+",")},getJson:function(e,t,i,a,s){var n=null;return $.ajax({url:e,type:"POST",timeout:1e5,cache:!1,async:void 0!=a?a:i?!0:!1,dataType:"json",data:t,success:"function"==typeof i?i:function(e){n=e},error:function(t,i){"function"==typeof s?s(i):common.isValid(t.responseText)&&"OK"!=t.statusText?console.error(t.responseText):console.error("请求超时,请重试:url[%s]",e)}}),n},arraySort:function(e,t){return function(i,a){return t?i[e]<a[e]:i[e]>a[e]}},randomNumber:function(e){for(var t="",i=0;e>i;i++)t+=Math.floor(10*Math.random());return t},isMobilePhone:function(e){return/(^[0-9]{11})$|(^86(-){0,3}[0-9]{11})$/.test(e)},dateTimeWeekCheck:function(e,t,i){if(this.isBlank(e))return!!t;$.isPlainObject(e)||(e=JSON.parse(e));var a=i?new Date(i):new Date,s=!1,n=this.formatterDate(a);if(s=this.isBlank(e.beginDate)||n>=e.beginDate,s&&(s=this.isBlank(e.endDate)||n<=e.endDate),!s)return!1;var o=e.weekTime;if(this.isBlank(o))return s;var r=null,l=null,c=!1;for(var d in o)if(r=o[d],(!this.isValid(r.week)||a.getDay()==parseInt(r.week))&&(l=this.getHHMMSS(a),c=this.isBlank(r.beginTime)||l>=r.beginTime,c&&(c=this.isBlank(r.endTime)||l<=r.endTime),c))break;return c},arrayUnique:function(e){if(!e)return e;for(var t,i=[],a={},s=0;null!=(t=e[s]);s++)a[t]||(i.push(t),a[t]=!0);return i},isWebSocket:function(){return window.WebSocket},getSocket:function(e,t,i){return common.isWebSocket()?(console.log("used websocket!"),e.connect(t.webSocket+"/"+i,{transports:["websocket"]})):e.connect(t.socketIO+"/"+i)},randomNumber:function(e){for(var t="",i=0;e>i;i++)t+=Math.floor(10*Math.random());return t},clearMsgHtml:function(e){var e=e.replace(/((^((&nbsp;)+))|\n|\t|\r)/g,"").replace(/<\/?(?!(img|IMG)\s+src="[^>"]+\/face\/[^>"]+"\s*>)[^>]*>/g,"");return e&&(e=$.trim(e)),e},formatToJson:function(e){return this.isBlank(e)?null:JSON.parse(e)},getSyllabusPlan:function(e,t,i,a){if(!e||!e.courses)return null;var s=function(e,t){if(e&&3!=t){var s,n=common.isMobile();"object"!=typeof e&&(e=JSON.parse(e));for(var o in e)if(s=e[o],n){if(1==t&&(!i&&3==s.code||i&&4==s.code))return s.url}else if(a){if(1==t&&3==s.code){var r=s.url||"";return r=r.replace(/^http:/,"rtmps:").replace(/\/index\.m3u8$/,"")}}else if(s.code==t)return s.url}return null},n=function(t,i,a){var n=null,o=t.course;return o&&o.length>i?(n=o[i],0==n.status||common.isBlank(n.lecturerId)?null:(n.studioLink=s(e.studioLink,n.courseType),n.startTime=t.startTime,n.endTime=t.endTime,n.day=l[i].day,n.isNext=a,n)):null},o=null;o=this.isValid(e.courses)&&"object"!=typeof e.courses?JSON.parse(e.courses):e.courses;for(var r,l=o.days,c=o.timeBuckets,d=(new Date(t).getDay()+6)%7,u=common.getHHMM(t),p=null,h=null,m=0;m<l.length;m++)if(0!=l[m].status)if(r=(l[m].day+6)%7,r>d){for(var f in c)if(p=c[f],h=n(p,m,!0))return h}else if(r==d)for(var f in c)if(p=c[f],p.startTime<=u&&(p.endTime>=u||"00:00"==p.endTime)?h=n(p,m,!1):p.startTime>u&&(h=n(p,m,!0)),h)return h;if(!e.publishEnd)return null;for(var m=0;m<l.length;m++)if(0!=l[m].status&&(r=(l[m].day+6)%7,!(e.publishEnd<864e5*(r+7-d)+t)))for(var f=0;f<c.length;f++)if(h=n(c[f],m,!0))return h;return null},formatSyllabus:function(e,t,i,a){var s={dayCN:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],indexCN:["第一节","第二节","第三节","第四节","第五节","第六节","第七节","第八节"],courseCls:["prev","ing","next"],tableCls:"syllabus",courseType:{0:"文字在线",1:"视频在线",2:"ONE TV"}},n=new Date(t).getDay(),o=this.getHHMM(t),r=$.extend({},s,a),l=function(e,t,i,a){var s=0,l=(e+6)%7,c=(n+6)%7;return s=l>c?2:c>l?0:a?1:o>=i?0:t>o?2:1,r.courseCls[s]},c=[];try{if(e){var d=$.isPlainObject(e)?e:JSON.parse(e),u=d.days?d.days.length:0;if(u>0)if(1===i){var p={0:"文字",1:"视频",2:"oneTV"};c.push('<div class="sy_panel">');var h=t-864e5*((n+6)%7),m=null,f=null,g=null;c.push('<div class="sy_nav">');for(var v=' style="width:'+100/u+'%;"',b=0;u>b;b++)m=new Date(h+(d.days[b].day+6)%7*864e5),f=m.getFullYear()+"-"+(m.getMonth()<9?"0":"")+(m.getMonth()+1)+"-"+(m.getDate()<10?"0":"")+m.getDate(),g=d.days[b].day==n?' class="active"':"",c.push('<a href="javascript:void(0)" d="'+d.days[b].day+'"'+g+v+">"+r.dayCN[d.days[b].day]+"<br/><span>"+f+'</span><em class="dir">^</em></a>');c.push("</div>"),c.push('<div class="sy_cont"><div>'),c.push('<table cellpadding="0" cellspacing="0" border="0" class="'+r.tableCls+'">');for(var y=null,w=null,b=0;u>b;b++){if(c.push('<tbody d="'+d.days[b].day+'">'),0==d.days[b].status)w=l(d.days[b].day,null,null,!0),c.push('<tr class="'+w+'" width="100%"><td>休市</td></tr>');else for(var x=0,_=d.timeBuckets.length;_>x;x++)y=d.timeBuckets[x],w=l(d.days[b].day,y.startTime,y.endTime,!1),0==y.course[b].status?(c.push('<tr class="'+w+'">'),c.push('<td width="25%">'+y.startTime+"-"+y.endTime+"</td>"),c.push('<td colspan="2" width="75%">休市</td>'),c.push("</tr>")):y.course[b].lecturer&&(c.push('<tr class="'+w+'">'),c.push('<td width="25%">'+y.startTime+"-"+y.endTime+"【"+p[y.course[b].courseType]+"】</td>"),c.push('<td width="25%">'+y.course[b].lecturer+"</td>"),c.push('<td width="50%">'+y.course[b].title+"</td>"),c.push("</tr>"));c.push("</tbody>")}c.push("</table>"),c.push("</div></div>"),c.push("</div>")}else if(2===i){c.push('<table cellpadding="0" cellspacing="1" border="0" class="'+r.tableCls+'">'),c.push("<tr>"),c.push("<th>星期\\节次</th>");for(var _=d.timeBuckets?d.timeBuckets.length:0,y=null,w=null,x=0;_>x;x++)y=d.timeBuckets[x],c.push("<th>"+r.indexCN[x]+"<br><span>("+y.startTime+"-"+y.endTime+")</span></th>");c.push("</tr>");for(var k=null,b=0,T=d.days?d.days.length:0;T>b;b++){if(k=d.days[b],c.push("<tr>"),c.push("<th>"+r.dayCN[k.day]+"</th>"),0==k.status)w=l(k.day,null,null,!0),c.push('<td class="'+w+'" colspan="'+_+'">休市</td>');else for(var x=0;_>x;x++)y=d.timeBuckets[x],w=l(k.day,y.startTime,y.endTime,!1),c.push('<td class="'+w+'">'+(0==y.course[b].status?"休市":y.course[b].lecturer)+"</td>");c.push("</tr>")}c.push("</table>")}else if(3===i){var h=o-864e5*((n+6)%7),m=null,g=null,k=null,v=' style="width:'+100/u+'%;"';c.push("<tr>");for(var b=0;u>b;b++)k=d.days[b],m=new Date(h+(d.days[b].day+6)%7*864e5),g=d.days[b].day==n?' class="active"':"",c.push('<th d="'+d.days[b].day+'"'+g+v+">"+r.dayCN[d.days[b].day]+"<i></i></th>");c.push("</tr>"),c.push('<tr><td class="space" colspan="'+u+'"></td></tr>');for(var y=null,w=null,b=0;u>b;b++){if(k=d.days[b],c.push('<tr d="'+k.day+'"><td colspan="'+u+'">'),0==k.status)w=l(k.day,null,null,!0),c.push('<p class="'+w+'">休市</p>');else for(var x=0,_=d.timeBuckets?d.timeBuckets.length:0;_>x;x++)y=d.timeBuckets[x],y.course[b].lecturer&&(w=l(k.day,y.startTime,y.endTime,!1),c.push('<p class="'+w+'">'),c.push("<span>"+y.startTime+"-"+y.endTime+"</span>"),0==y.course[b].status?c.push("<span>休市</span>"):(c.push("<span>"+r.courseType[y.course[b].courseType]+"</span>"),c.push("<span>"+y.course[b].lecturer+"</span>"),c.push('<span class="item">'+y.course[b].title+"</span>")),c.push("</p>"));c.push("</td></tr>")}}}}catch(I){return console.error("formatSyllabus->"+I),""}return c.join("")},isMobile:function(){return/(iphone|ipod|ipad|android|mobile|playbook|bb10|meego)/.test(navigator.userAgent.toLowerCase())},isHTTPS:function(){return/^https:\/\//.test(location.href)},copyObject:function(e,t,i){if(!t)return e;for(var a in e)t.hasOwnProperty(a)&&common.isValid(t[a])&&(e[a]=t[a]);if(i)for(var a in t)e.hasOwnProperty(a)||(e[a]=t[a])},isRightName:function(e){return!/^([0-9]{2,10})$/g.test(e)&&/^([\w\u4e00-\u9fa5]{2,10})$/g.test(e)},randomIndex:function(e){var t=parseInt(Math.round(Math.random()*e));return t==e&&(t=e-1),0>t?0:t},saveToDesktop:function(e,t){try{var i=new ActiveXObject("WScript.Shell"),a=i.CreateShortcut(i.SpecialFolders("Desktop")+"\\"+t+".url");a.TargetPath=e,a.Save()}catch(s){return!1}return!0},getUrlParam:function(e,t){var i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(i);if(t){if(null!=a)return a[2]}else if(null!=a)return unescape(a[2]);return null},keysrt:function(e,t){return function(i,a){return t?~~(i[e]<a[e]):~~(i[e]>a[e])}},newsMarquee:function(e,t,i,a,s,n,o){e&&(clearInterval(e),e=null);var r="object"==typeof i?i:$(i),l="object"==typeof a?a[0]:$(a)[0],c="object"==typeof s?s:$(s),d="object"==typeof n?n:$(n);if(o&&c.children().size()>0?r.show():r.hide(),d.html(""),$(l).unbind("mouseover mouseout"),o){c.css("width","auto"),d.css("width","auto");var u=r.width()-27;c.width()<u&&(c.css("width",u),d.css("width",u)),d.html(c.html());var p=function(){c.width()-l.scrollLeft<=0?l.scrollLeft-=c.width():l.scrollLeft++};e=window.setInterval(p,t),$(l).bind("mouseover",function(){window.clearInterval(e),e=null}).bind("mouseout",function(){e&&(window.clearInterval(e),e=null),e=window.setInterval(p,t)})}},placeholderSupport:function(e){e="object"==typeof e?e:$(e);var t="placeholder"in document.createElement("input");t||e.each(function(){var e=$(this).attr("placeholder");if(e){var t=$(this),i=$('<span class="placeholder">'+e+"</span>");t.before(i),i.bind("click",function(){$(this).hide(),$(this).next().focus()}),t.bind("focus",function(){$(this).prev().hide()}),t.bind("blur",function(){""===$(this).val()&&$(this).prev().show()}),""!=t[0].defaultValue&&t.prev().hide(),$(this).attr("placeholder","")}})},openPopup:function(e){e="object"==typeof e?e:$(e),e.show()},isEmail:function(e){return/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(e)},getDateDiff:function(e,t){var i=new Date(e).getTime(),a=new Date(t).getTime(),s=Math.abs(i-a)/864e5;return s},getHourDiff:function(e,t){var i=new Date(e).getTime(),a=new Date(t).getTime(),s=Math.abs(i-a)/36e5;return s=Math.floor(s)},getMinuteDiff:function(e,t){var i=new Date(e).getTime(),a=new Date(t).getTime(),s=Math.abs(i-a)/6e4;return s=Math.floor(s)},addDate:function(e,t){var i=new Date(e);i.setDate(i.getDate()+t);var a=i.getMonth()+1;return i.getFullYear()+"-"+a+"-"+i.getDate()}};window.console||(console=function(){function e(){}function t(){return null==i&&(i=new e),i}var i=null;return e.prototype={log:function(e){},error:function(e){}},t()}()),$.fn.focusEnd=function(){$(this).focus();var e=$("<span/>").appendTo($(this)),t=e.get(0),i=null,a=null;return document.selection?(i=document.body.createTextRange(),i.moveToElementText(t),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(t),a=window.getSelection(),a.removeAllRanges(),a.addRange(i)),e.remove(),this},String.prototype.formatStr=function(){if(0==arguments.length)return this;for(var e=this,t=0;t<arguments.length;t++)e=e.replace(new RegExp("\\{"+t+"\\}","g"),null==arguments[t]||void 0==arguments[t]?"":arguments[t]);return e};var _gaq=_gaq||[],_hmt=_hmt||[];UUID.prototype.valueOf=function(){return this.id},UUID.prototype.toString=function(){return this.id},UUID.prototype.createUUID=function(e){var t=new Date(1582,10,15,0,0,0,0),i=new Date,a=i.getTime()-t.getTime(),s=UUID.getIntegerBits(a,0,31),n=UUID.getIntegerBits(a,32,47),o=UUID.getIntegerBits(a,48,59)+"1",r=UUID.getIntegerBits(UUID.rand(4095),0,7),l=UUID.getIntegerBits(UUID.rand(4095),0,7),c=UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,15);return(e||"")+s+n+o+r+l+c},UUID.getIntegerBits=function(e,t,i){var a=UUID.returnBase(e,16),s=new Array,n="",o=0;for(o=0;o<a.length;o++)s.push(a.substring(o,o+1));for(o=Math.floor(t/4);o<=Math.floor(i/4);o++)n+=s[o]&&""!=s[o]?s[o]:"0";return n},UUID.returnBase=function(e,t){return e.toString(t).toUpperCase()},UUID.rand=function(e){return Math.floor(Math.random()*(e+1))};var chatAnalyze={localHref:window.location.href,utmStore:{userIp:"",storeKey:"GWAFLGPHONECOOIKETRACK",userId:"",roomId:"",userTel:"",userType:"",userName:"",roomName:"",userSource:"web",useEquipment:"",tradingAccount:"",tradingPlatform:"",platformType:0,businessPlatform:"",operateEntrance:"",operationType:2,touristId:"",sessionId:"",nickName:"",email:"",videoId:"",videoName:"",courseId:"",courseName:"",teacherId:"",teacherName:""},isLocalHref:function(){return/^https?:\/\/(\d{1,3}\.){3}\d{1,3}.+/.test(chatAnalyze.localHref)},init:function(){if(!this.isLocalHref()){var e="";-1!=chatAnalyze.localHref.indexOf("/studio")?e="studio":-1!=chatAnalyze.localHref.indexOf("/fxstudio")?e="fxstudio":-1!=chatAnalyze.localHref.indexOf("/hxstudio")&&(e="hxstudio"),""!=e&&(this.initGA(e),this.setGA(),this.setBaidu())}},initGA:function(e){"studio"==e&&(_gaq.push(["_setAccount","UA-31478987-1"]),_gaq.push(["_setDomainName","24k.hk"]),_gaq.push(["_addIgnoredRef","24k.hk"])),"fxstudio"==e&&(_gaq.push(["_setAccount","UA-49389835-1"]),_gaq.push(["_setDomainName","gwfx.com"]),_gaq.push(["_addIgnoredRef","gwfx.com"])),"hxstudio"==e&&(_gaq.push(["_setAccount",""]),_gaq.push(["_setDomainName","handan.hx9999"]),_gaq.push(["_addIgnoredRef","handan.hx9999"])),_gaq.push(["_setAllowLinker",!0]),_gaq.push(["_addOrganic","soso","w"]),_gaq.push(["_addOrganic","sogou","query"]),_gaq.push(["_addOrganic","youdao","q"]),_gaq.push(["_addOrganic","baidu","word"]),_gaq.push(["_addOrganic","baidu","q1"]),_gaq.push(["_addOrganic","ucweb","keyword"]),_gaq.push(["_addOrganic","ucweb","word"]),_gaq.push(["_addOrganic","114so","kw"]),_gaq.push(["_addOrganic","360","q"]),_gaq.push(["_addOrganic","so","q"]),_gaq.push(["_trackPageview"])},setGA:function(){try{var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}catch(i){console.log("Set GA fail!"+i)}},setBaidu:function(){try{var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?52a2828b884f1a2ba8a3e25efe98eb65";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}catch(i){console.log("Set GA fail!"+i)}},getIp:function(e){$.getJSON("https://oa.24k.hk/ajax/getIp?callback=ip&_="+Math.random(),function(t){chatAnalyze.utmStore.userIp=t.Ip,e&&e()})},getUTMCookie:function(){for(var e=document.cookie,t=e.split(/[;&]/),i=0;i<t.length;i++){var a=t[i].split("=");if($.trim(a[0])==this.utmStore.storeKey)return a[1]}var s=document.domain;$.inArray(s,["pmchat.24k.hk","chat.gwfx.com","handan.hx9999.com"])>-1&&(-1!=chatAnalyze.localHref.indexOf("/studio")?s=".24k.hk":-1!=chatAnalyze.localHref.indexOf("/fxstudio")&&(s=".gwfx.com"));var n=UUID.prototype.createUUID(-1!=s.indexOf("gwfx")?"":"G");return document.cookie=this.utmStore.storeKey+"="+escape(n)+"; expires=Tue, 31 Dec 2030 00:00:00 UTC; path=/;domain="+s,n},setUTM:function(e,t){try{if(e)this.utmStore.roomId=t.groupId,this.utmStore.userId=t.userId,this.utmStore.userTel=t.userTel,this.utmStore.clientGroup=t.clientGroup,this.utmStore.groupType=t.groupType,$(window).unload(function(){chatAnalyze.utmStore.onlineETM=(new Date).getTime(),window.event.returnValue=!0});else if(chatAnalyze.utmStore.userId=chatAnalyze.getUTMCookie(),chatAnalyze.utmStore.userType=chatAnalyze.getClientGroup(t.clientGroup),chatAnalyze.utmStore.businessPlatform=chatAnalyze.getGroupType(t.groupType),chatAnalyze.utmStore.roomId=t.groupId,chatAnalyze.utmStore.userTel=t.mobile,chatAnalyze.utmStore.userName=t.userName,chatAnalyze.utmStore.roomName=t.roomName,chatAnalyze.utmStore.platformType=common.isMobile(navigator.userAgent)?1:0,chatAnalyze.utmStore.touristId=t.visitorId,chatAnalyze.utmStore.sessionId=t.sid,chatAnalyze.utmStore.nickName=t.nickname,chatAnalyze.utmStore.email=t.email,chatAnalyze.utmStore.useEquipment=navigator.userAgent,chatAnalyze.utmStore.operateEntrance=common.isBlank(common.getUrlParam("platform"))?"web":common.getUrlParam("platform"),chatAnalyze.utmStore.courseId=t.courseId||"",chatAnalyze.utmStore.courseName=t.courseName,chatAnalyze.utmStore.teacherId=t.lecturerId||"",chatAnalyze.utmStore.teacherName=t.lecturer||"",i?chatAnalyze.utmStore.userIp=t.ip:this.getIp(),chatAnalyze.utmStore.operationType=t.operationType,chatAnalyze.utmStore.tradingAccount=t.accountNo||"",t&&7==t.operationType&&(chatAnalyze.utmStore.videoId=t.videoId,chatAnalyze.utmStore.videoName=t.videoName),t=chatAnalyze.utmStore,common.isValid(t.sessionId)&&common.isValid(t.userId)&&(common.isValid(t.touristId)||common.isValid(t.userTel))&&common.isValid(t.operationType)){var i=this.isLocalHref(),a=i?"http://testweboa.gwfx.com:8088/GwUserTrackingManager_NEW/put/insertRoom":"https://das.gwfx.com/put/insertRoom";chatAnalyze.utmAjax(a,t,!0)}}catch(s){console.log("Set UTM fail!"+s)}},utmAjax:function(e,t,i){$.post(e,{data:JSON.stringify(t),callback:"?"},function(e){})},sendUTM:function(e){return!1},getClientGroup:function(e){var t=1;switch(e){case"visitor":t=1;break;case"register":t=2;break;case"simulate":t=3;break;case"active":t=4;break;case"notActive":t=5;break;case"vip":t=6;break;case"analyst":t=7;break;case"admin":t=8;break;case"cs":t=9;break;default:t=1}return t},getGroupType:function(e){var t=1;return t=/^fx/.test(e)?1:/^hx/.test(e)?3:2}};$(function(){chatAnalyze.init()});var indexJS={fromPlatform:null,isNeverLogin:!1,serverTime:0,towMinTime:0,socketUrl:"",userInfo:null,filePath:"",apiUrl:"",currStudioAuth:!1,visitorSpeak:!1,syllabusData:null,infoNewCount:0,onlineCsStatus:0,pointLevel:[{points:0,name:"L1"},{points:1e4,name:"L2"},{points:3e4,name:"L3"},{points:5e4,name:"L4"},{points:1e5,name:"L5"},{points:3e5,name:"L6"},{points:5e5,name:"L7"},{points:1e6,name:"L8"},{points:2e6,name:"L9"},{points:4e11,name:"L10"}],init:function(){this.widthCheck(),this.heightCalcu(),this.serverTimeUp(),this.setVisitStore(),this.setEvent(),box.init(),videosTeach.init(),videos.init(),videosLive.init(),videosSubscribe.init(),videosTrain.init(),chatPride.init(),chat.init(),chatTeacher.init(),chatShowTrade.init(),noticeJS.init(),indexTool.SimpleRoom.init(),indexTool.RedPacket.init()},setEvent:function(){$(window).resize(function(e){indexJS.widthCheck(),indexJS.heightCalcu()}),lightbox.option({resizeDuration:200,wrapAround:!0,disableScrolling:!0,positionFromTop:50,albumLabel:"%1 of %2"}),$("#register_a").click(function(){common.openPopup(".blackbg,.register")}),$("#panel_theme .sk_item").bind("click",function(){indexTool.Theme.setTheme($(this).attr("theme"),!0)}),$("#personal_center").click(function(){indexJS.userInfo.isLogin?(chatShowTrade.getPointsInfo(),common.openPopup(".blackbg,.personal_center"),$('#infotab a[t="accountInfo"]').click()):common.openPopup(".blackbg,.login")}),$("#vipbenefit").click(function(){$(".vipbenefit .main_tabnav a:first").click(),common.openPopup(".blackbg,.vipbenefit")}),$("#pointsRule").click(function(){$(".pointrule .main_tabnav a:first").click(),common.openPopup(".blackbg,.pointrule")}),indexJS.setListScroll($(".pointrule .tabcont .scrollbox")),$("#infodown").click(function(){indexJS.userInfo.isLogin?(box.setDownloadPPT(1,box.getDownloadSort()),common.openPopup(".blackbg,.infodown")):common.openPopup(".blackbg,.login")}),$("#live_preview").click(function(){common.openPopup(".blackbg,.live_preview")}),$("#qqcs").click(function(){openQQChatByCommonv3("","800018282")}),$(".main_tabnav a").click(function(){var e=$(this).attr("t");switch($(this).parent().find("a").removeClass("on"),$(this).parent().parent().find(".tabcont .main_tab").removeClass("on"),$(this).addClass("on"),$("div[t="+e+"]").addClass("on"),e){case"livepride":$("#livePrideCount").data("cnt",0).html("").hide(),chatPride.setTradeStrategyNote(null,!1);break;case"teacher":chatTeacher.teacherSele="off",chatTeacher.getShowTeacher(null);break;case"showtrade":chatShowTrade.initShowTrade();break;case"mySubscribe":chatShowTrade.getPointsInfo(),videosSubscribe.setSubscribeType();break;case"myPoint":chatShowTrade.getPointsInfo()}$(this).parent().hasClass("vipbene")&&!$(this).hasClass("loaded")&&($(this).addClass("loaded"),box.setVipBeneFit(e)),indexJS.heightCalcu(),"chat"==e&&(chat.showChatMsgNumTip(!0),chat.setTalkListScroll(!0))}),$(".tabnav a.tablink").bind("click",function(e,t){$(this).hasClass("on")||($(this).parent().find(".tablink").removeClass("on"),$(this).parent().parent().find(".tabcont .main_tab").removeClass("on"),$(this).addClass("on"),$($(this).parent().parent().find(".tabcont .main_tab")[$(this).index()]).addClass("on"),t||($(this).hasClass("live")?($(this).addClass("initEasyPieChart"),videos.playAuto(!0)):$(this).hasClass("teach")&&videosTeach.playRandomTeach(!0)))}),$(window).width()>768&&(indexJS.setListScroll($(".tabcont .main_tab .teacherlist .scrollbox")),indexJS.setListScroll($(".pop_train .cont .scrollbox")),indexJS.setListScroll($(".train_detail .cont .scrollbox")),indexJS.setListScroll("#teachVideoPanel .scrollbox")),$(".mod_infotab .tabnav .myaid").click(function(){var e=$("#roomInfoId").attr("rt");"vip"==e||"train"==e?indexJS.connectOnlineCs():(0==$(".pletter_win .mult_dialog a[utype=3]").length&&chat.getCSList(),$(this).hasClass("nocs")?box.showTipBox("助理失联中"):common.openPopup(".blackbg,.pletter_win"))}),$(".ietip .iewhybtn").click(function(){$(".ietip").hide(),$(".iestory").show()}),$(".iestory .closebtn").click(function(){$(".iestory").hide(),$(".ietip").show()}),common.placeholderSupport(".formcont .in_line input[placeholder]")},showWelcomeMsg:function(){var e=$(".mod_infotab .sub-tabnav a:contains('专场')");if(1==e.size()){var t=e.siblings(".enterbtn").attr("cgs"),i=e.text();common.containSplitStr(t,indexJS.userInfo.clientGroup)&&alert("您已具备进入“"+i+"”的条件，请关注"+i+"的课程安排。")}},fillCourse:function(){var e=indexJS.syllabusData&&indexJS.syllabusData.courses;if(e){for(var t,i={0:"文字直播",1:"视频直播",2:"oneTV直播"},a=e.days,s=e.timeBuckets,n=$(".live_preview .main_tabnav").html(""),o="",r="",l=new Date(indexJS.serverTime).getDay(),c=indexJS.serverTime-864e5*((l+6)%7),d=(100/a.length,0),u=a.length;u>d;d++){o=0==d?"fir":d==u-1?"last":"nct",r=a[d].day==l?" on":"",t=common.formatterDate(new Date(c+(a[d].day+6)%7*864e5)).substring(5),n.append('<a href="javascript:" class="'+r+'" t="'+d+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'header_yg_"+d+"', 'content_top', 1, true]);\"><span>"+common.daysCN[a[d].day+""]+"<b>"+t+"</b></span><i></i></a>"),$(".live_preview .tabcont").append('<div class="main_tab'+r+'" t="'+d+'" d="'+a[d].day+'"><ul class="live_prevlist"></ul></div>'),o="";var p=$(".live_preview .tabcont .main_tab:last ul"),h=null;if(1!=a[d].status)p.append('<li><a href="javascript:"><span><lable>休市</lable></span></a></li>');else{o="on";for(var m=0,f=s.length;f>m;m++)h=s[m].course[d],0!=h.status&&h.lecturer&&(p.append('<li class="'+o+'" tuid="'+h.lecturerId+'"><a href="javascript:" st="'+s[m].startTime+'" et="'+s[m].endTime+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'header_yg_course', '"+h.title+'\', 1, true]);"><i></i><div class="c_name">'+h.title+"<span>"+h.lecturer+'</span><span class="time">'+s[m].startTime+"- "+s[m].endTime+"　</span><span>"+i[h.courseType]+"　</span></div></a></li>"),o="")}}$(".live_preview .main_tabnav a").click(function(){$(".live_preview .main_tabnav a").removeClass("on"),$(".live_preview .tabcont .main_tab").removeClass("on"),$(this).addClass("on"),$(".live_preview .tabcont .main_tab[t="+$(this).attr("t")+"]").addClass("on")}),$(".live_preview .tabcont").css("height","200px"),indexJS.setListScroll(".live_preview .tabcont")}},toRefreshView:function(){window.location.reload()},checkClientGroup:function(e){var t=this.userInfo.clientGroup,i=!1;switch(e){case"visitor":i="visitor"==t;break;case"vip":i="vip"==t||"active"==t;break;case"new":i="vip"!=t&&"active"!=t}return i},serverTimeUp:function(){indexJS.fillCourse(),indexJS.courseTick.tick(),this.towMinTime=this.serverTime,setInterval(function(){indexJS.serverTime+=1e3,indexJS.serverTime-indexJS.towMinTime>=12e4&&(indexJS.towMinTime=indexJS.serverTime,videosLive.setInformation()),chat.setPushInfo(),indexJS.courseTick.tick(),indexTool.RedPacket.tick()},1e3)},refreshNickname:function(e,t){this.userInfo.isSetName=e,this.userInfo.nickname=t,$(".personal_info .username,.header-right .welcome span").text(t)},setVisitStore:function(){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var e="storeInfos_"+this.userInfo.groupType,t=store.get(e),i={};if(common.isBlank(t)){var a=common.randomNumber(8);i.clientStoreId=(new Date).getTime()+"_"+a,i.userId="visitor_"+a,i.nickname="游客_"+a,i.userType=-1,store.set(e,i)}else i=t;this.userInfo.clientStoreId=i.clientStoreId,this.userInfo.visitorId=i.userId,this.userInfo.loginId=i.loginId,this.userInfo.clientGroup&&"visitor"==this.userInfo.clientGroup?(this.userInfo.nickname=i.nickname,this.userInfo.userId=i.userId,this.visitorSpeak||$("#contentText").attr("contenteditable",!1).append('<div class="lgtip">亲，<a href="javascript:box.openLgBox();">登录</a> 后可以发言哦~</div>')):(i.loginId=this.userInfo.userId,store.set(e,i)),this.isNeverLogin=!common.isValid(i.loginId),common.isBlank(this.userInfo.nickname)&&"visitor"!=this.userInfo.clientGroup&&this.refreshNickname(!1,"匿名_"+this.userInfo.userId.substring(8,12))},setScrollStyle:function(e){e.find(".mCSB_dragger_bar").css({background:"url(/pm/theme1/img/scroll.png) -10px 50% repeat-y",width:"6px","-webkit-border-radius":"3px","-moz-border-radius":"3px","border-radius":"3px"})},setListScroll:function(e,t,i){var a="object"==typeof e?e:$(e);a.hasClass("mCustomScrollbar")?(a.mCustomScrollbar("update"),common.isValid(t)&&a.mCustomScrollbar("scrollTo",t)):(i=$.extend({scrollButtons:{enable:!0},theme:"light-thick",scrollbarPosition:"outside",scrollButtons:!1},i),a.mCustomScrollbar(i),i.isCustom&&this.setScrollStyle(a))},getArticleList:function(e,t,i,a,s,n,o,r){o=o||{};try{$.getJSON("/studio/getArticleList",{authorId:common.trim(o.authorId),code:e,platform:t,hasContent:i,pageNo:a,pageKey:common.trim(o.pageKey),pageLess:common.trim(o.pageLess),isAll:common.trim(o.isAll),pageSize:s,orderByStr:n,ids:common.isBlank(o.ids)?"":o.ids,callTradeIsNotAuth:o.callTradeIsNotAuth,strategyIsNotAuth:o.strategyIsNotAuth},function(e){r(e)})}catch(l){console.error("getArticleList->"+l),r(null)}},getArticleInfo:function(e,t){try{$.getJSON("/studio/getArticleInfo",{id:e},function(e){t(e)})}catch(i){console.error("getArticleInfo->"+i),t(null)}},setTradeStrategy:function(e){this.getArticleList("trade_strategy_article",indexJS.userInfo.groupId,1,1,100,'{"sequence":"asc","createDate":"desc"}',null,function(t){if(t&&0==t.result){var i=t.data,a=null,s="",n=indexJS.formatHtml("tradestrategy");for(var o in i){a=i[o].detailList[0];var r="",l="";if(common.isBlank(a.author))r=a.authorInfo.name,l=a.authorInfo.avatar;else{var c=a.author.split(";");r=c[0],l=c[1]}var d=common.formatterDateTime(i[o].publishStartDate,"-").substring(0,16);s+=n.formatStr(l,r,d,a.tag,a.title,a.content)}$("#guidelist ul").html(s)}else $("#guidelist ul").html("");indexJS.setListScroll(e)})},connectOnlineCs:function(){switch(indexJS.onlineCsStatus){case 0:indexJS.onlineCsStatus=1;var e="http://jms.phgsa.cn/chat.php?pid=PM01&tln="+indexJS.userInfo.userId+"&tnn="+indexJS.userInfo.nickname+"&tul="+indexJS.userInfo.clientGroup+"&tp="+$("#myMobilePhone").attr("t")+"&ta="+$("#myMobilePhone").attr("ta");LazyLoad.js(e,function(){indexJS.onlineCsStatus=2,$("#welive_info").trigger("click")});break;case 2:$("#welive_info").trigger("click");break;case 1:}},formatHtml:function(e){var t=[];switch(e){case"tradestrategy":t.push('<li class="guideli">'),t.push('    <div class="line1 clearfix">'),t.push('        <img class="himg" src="{0}" alt="{1}">'),t.push('        <h4 class="name">{1}<span class="timespan">{2}</span></h4>'),t.push('        <span class="tag"><i></i>{3}</span>'),t.push("    </div>"),t.push('    <h4 class="gtit"><strong><a href="" target="_blank" class="taglink"></a></strong>{4}</h4>'),t.push('    <div class="g_cont">'),
t.push("    <p>{5}</p>"),t.push("    </div>"),t.push("</li>");break;case"news":t.push("<li><span><i></i><b>{0} </b>{1}</span></li>")}return t.join("")},courseTick:{course:{courseId:"",courseType:0,courseTypeName:"",day:0,endTime:"",isNext:!1,lecturer:"",lecturerId:"",startTime:"",status:0,studioLink:null,title:"",courseName:""},nextTickTime:0,tick:function(){if(!(indexJS.serverTime<=this.nextTickTime)){var currCourse=common.getSyllabusPlan(indexJS.syllabusData,indexJS.serverTime);if(currCourse){var nextTime=0,todayTime0=new Date(indexJS.serverTime);if(todayTime0=new Date(todayTime0.getFullYear(),todayTime0.getMonth(),todayTime0.getDate()).getTime(),currCourse.isNext?nextTime=currCourse.day!=new Date(indexJS.serverTime).getDay()?todayTime0+864e5+6e4:6e4*eval(currCourse.startTime.replace(":","*60+"))+todayTime0:(nextTime=6e4*eval(currCourse.endTime.replace(":","*60+"))+todayTime0+6e4,currCourse.endTime<currCourse.startTime&&(nextTime+=864e5)),this.nextTickTime!=nextTime){var courseType={0:"文字直播",1:"视频直播",2:"oneTV直播"},courseId=common.formatterDate(indexJS.serverTime,"-")+"_"+currCourse.startTime+"_"+indexJS.userInfo.groupId;this.course=currCourse,this.course.courseId=courseId,common.isValid(currCourse.title)&&common.isValid(currCourse.lecturer)&&common.isValid(currCourse.courseType)&&(this.course.courseTypeName=courseType[currCourse.courseType],this.course.courseName=currCourse.title+"_"+currCourse.lecturer+"_"+courseType[currCourse.courseType]),this.nextTickTime=nextTime,videos.refreshVideo()}}}}},widthCheck:function(){var e=$(window).width();1680>=e&&($("body").addClass("wid1"),1440>=e&&($("body").addClass("wid2"),1280>=e&&$("body").addClass("wid3"))),e>1680&&($("body").removeClass("wid1"),$("body").removeClass("wid2"),$("body").removeClass("wid3"))},heightCalcu:function(){var e=$(window).height(),t=$(".box-header").height();$(".mod_video").height(e-$(".mod_infotab").height()-t-5),$(".mod_main .tabcont .scrollbox").height(e-$(".main_tabnav").height()-t-16),$(".chat_content .scrollbox").height(e-$(".main_tabnav").height()-201-t-6),$(".sd_list .scrollbox").height(e-$(".main_tabnav").height()-$(".sdbtn_bar").height()-t-6),$(".pop_mysd .sd_list .scrollbox").height(340),$(".userlist .scrollbox").height(340)}},box={verifyCodeIntMap:{},toRoomId:null,enable:!0,storeInfoKey:"storeInfo_VerifyCodeTime",init:function(){this.setEvent()},setEvent:function(){$(".signinbox .progressbar").bind("signin",function(e,t){var i=common.getDaysInMonth(new Date(indexJS.serverTime));30>i&&$(".signinbox .progressbar .rewardpoint[days='30']").hide(),$(".signinbox .progressbar .barcont .current").text(t+"天");for(var a=[{days:3,start:0,step:8},{days:7,start:24,step:6},{days:10,start:48,step:8},{days:30,start:72,step:1.235},{days:31,start:96.7,step:3.3}],s=0,n=0,o=0,r=a.length;r>o;o++){if(!(t>a[o].days&&o!=r-1)){s=a[o].start+(t-n)*a[o].step;break}n=a[o].days}$(".signinbox .progressbar .bar").width(s+"%")}),$(".tosigninbtn").click(function(){indexJS.userInfo.isLogin?common.getJson("/studio/getSignin",null,function(e){if(null!=e){var t=e.signinInfo,i=e.signinUser;$(".signinbox .progressbar").trigger("signin",t.signDays);var a=new Date(indexJS.serverTime),s=[],n=box.formatHtml("signin");if(null!=i)for(var o in i){var r=i[o],l=null!=r.avatar?r.avatar:"/pm/theme1/img/user.jpg",c=common.getMinuteDiff(a,r.signinTime);if(c=0>=c?1:c,c>59){var d=common.getHourDiff(a,r.signinTime);s.push(n.formatStr(l,d+"小时前"))}else s.push(n.formatStr(l,c+"分钟前"))}$(".signinbox .sign_vistor ul").empty().prepend(s.join("")),$("#sign_vistor").height(75),indexJS.setListScroll($("#sign_vistor")),common.openPopup(".blackbg,.signin")}else console.log("fail"),box.showMsg(e.msg)}):common.openPopup(".blackbg,.login")}),$(".popup_box .pop_close,.formbtn[t=close]").click(function(){$(this).parent().parent().hide(),$("div.popup_box:visible").length<1&&$("div.pletter_win:visible").length<1&&$(".blackbg").hide(),$(".blackbg form").each(function(){this.reset()})}),$("#prev").click(function(){var e=parseInt($("#page b").text()),t=0;return e>1?(t=e-1,void box.setDownloadPPT(t,box.getDownloadSort())):!1}),$("#next").click(function(){var e=parseInt($("#page b").text()),t=0;return e<parseInt($("#page span").text())?(t=e+1,void box.setDownloadPPT(t,box.getDownloadSort())):!1}),$(".infodown .ranknavbar a.rankbtn").click(function(){$(".infodown .ranknavbar a.rankbtn").removeClass("on"),$(this).addClass("on"),box.setDownloadPPT(1,box.getDownloadSort())}),$(".infodown .ranknavbar .search_bar .sbtn").click(function(){var e=$(".infodown .ranknavbar .search_bar .sinp").val();common.isBlank(e)?$(".infodown .downtable table tbody tr").show():($(".infodown .downtable table tbody tr").hide(),$(".infodown .downtable table tbody tr").each(function(){-1!=$(this).find("td.sname").text().indexOf(e)&&$(this).show()}))}),this.loginEvent(),this.modifyAvatarEvent(),this.modifyUserNameEvent(),this.modifyNickNameEvent(),this.modifyEmailEvent(),this.modifyPasswordEvent()},upgradeEvent:function(){$("#tipbtnId").hover(function(){$(".upg_tip").show()},function(){$(".upg_tip").hide()}),$(".upgradebtn").click(function(){try{$(".upgrade,#up_loading").show(),$.getJSON("/studio/getClientGroupList",null,function(e){if($("#up_loading").hide(),e){$("#upg_tbody_id").html("");var t="",i=0,a=null,s="";for(var n in e)e[n].clientGroupId==indexJS.userInfo.clientGroup&&(i=e[n].sequence);for(var o=0;o<e.length;o++)if(a=e[o],s="",a.clientGroupId==indexJS.userInfo.clientGroup?(t="当前级别",s="current"):t="visitor"!=a.clientGroupId&&i<a.sequence?"vip"==a.clientGroupId?"联系客服升级":'<a href="javascript:" t="'+a.clientGroupId+'">升级</a>':"---",!common.isBlank(common.trim(a.remark))){var r=[];r.push('<tr class="'+s+'"><td><p>'+box.getUserLevelShortName(a.clientGroupId)+'</p></td><td><p class="p2">'+common.trim(a.remark)+"</p></td><td><p>"+common.trim(a.authorityDes)+"</p></td><td>"+t+"</td></tr>"),$("#upg_tbody_id").append(r.join(""))}$("#upg_tbody_id a").click(function(){var e=$(this),t=e.attr("t");common.getJson("/studio/upgrade",{clientGroup:t},function(i){if(e.attr("disabled",!1),i.isOK)"active"===i.clientGroup&&"notActive"===t?$("#studioUpgA").show():$("#studioUpgA").hide(),$(".upgrade,.upgrade_result .fail").hide(),$(".upgrade_result,.upgrade_result .succ").show();else{var a="";"active"===t?a="很遗憾，您未激活金道真实交易账户，升级失败！<br>如有疑问请联系客服！":"notActive"===t?a="很遗憾，您未开通金道真实交易账户，升级失败！<br>如有疑问请联系客服！":"simulate"===t&&(a="很遗憾，您未开通金道模拟交易账户，升级失败！<br>如有疑问请联系客服！"),$(".upgrade_result .succ").hide(),$(".upgrade_result,.upgrade_result .fail").show(),$(".upgrade_result .fail>span").html(a)}},!0,function(t){e.attr("disabled",!1)})})}})}catch(e){$("#up_loading").hide(),console.error("getClientGroupList->"+e)}})},loginEvent:function(){$("#loginForm .login_option a").bind("click",function(){var e=$(this).attr("lt");$("#loginForm .login_option a.selected").removeClass("selected"),$(this).addClass("selected"),$("#loginForm .in_line[lt]").hide(),$("#loginForm .in_line[lt='"+e+"']").show(),$("#loginForm .fr[lt]").hide(),$("#loginForm .fr[lt='"+e+"']").show(),$("#loginType").val(e)}),$("#preSetPwdBtn,#preSetPwdBtn2").bind("click",function(){box.openSettingBox("password2")}),$("#popBoxPassword2 .set_submit").click(function(){if(!$(this).prop("disabled")&&box.checkFormInput($("#popBoxPassword2"))){$(this).prop("disabled",!0),$("#popBoxPassword2 .img-loading").show();var e=this;common.getJson("/studio/resetPwd",$("#popBoxPassword2 form").serialize(),function(t){return box.showBoxError($("#popBoxPassword2")),$(e).prop("disabled",!1),$("#popBoxPassword2 .img-loading").hide(),t.isOK?($("#popBoxPassword3_mb").val(t.mobilePhone),void box.openSettingBox("password3")):(box.showBoxError($("#popBoxPassword2"),"<i></i>"+t.msg),!1)},!0,function(t){$(e).prop("disabled",!1),$("#popBoxPassword2 .img-loading").hide()})}}),$("#popBoxPassword3 .set_submit").click(function(){if(!$(this).prop("disabled")&&box.checkFormInput($("#popBoxPassword3"))){$(this).prop("disabled",!0),$("#popBoxPassword3 .img-loading").show();var e=this;common.getJson("/studio/resetPwd",$("#popBoxPassword3 form").serialize(),function(t){return box.showBoxError($("#popBoxPassword3")),$(e).prop("disabled",!1),$("#popBoxPassword3 .img-loading").hide(),t.isOK?(box.showTipBox("重置密码成功，请使用新密码登录！"),void box.openLgBox()):(box.showBoxError($("#popBoxPassword3"),"<i></i>"+t.msg),!1)},!0,function(t){$(e).prop("disabled",!1),$("#popBoxPassword3 .img-loading").hide()})}}),$("#preRegBtn").bind("click",function(){box.openSettingBox("reg")}),$("#reg_login").bind("click",function(){box.openLgBox()}),$("#popBoxRegister .set_submit").click(function(){if(!$(this).prop("disabled")&&box.checkFormInput($("#popBoxRegister"))){$(this).prop("disabled",!0),$("#popBoxRegister .img-loading").show(),$('#popBoxRegister form [name="cookieId"]').val(chatAnalyze.getUTMCookie()),$('#popBoxRegister form [name="visitorId"]').val(indexJS.userInfo.visitorId||""),$('#popBoxRegister form [name="clientStoreId"]').val(indexJS.userInfo.clientStoreId||""),$('#popBoxRegister form [name="roomName"]').val($("#roomInfoId").text()),$('#popBoxRegister form [name="courseId"]').val(indexJS.courseTick.course.courseId||""),$('#popBoxRegister form [name="courseName"]').val(indexJS.courseTick.course.courseName),$('#popBoxRegister form [name="teacherId"]').val(indexJS.courseTick.course.lecturerId||""),$('#popBoxRegister form [name="teacherName"]').val(indexJS.courseTick.course.lecturer||"");var e=this;common.getJson("/studio/reg",$("#popBoxRegister form").serialize(),function(t){return box.showBoxError($("#popBoxRegister")),$(e).prop("disabled",!1),$("#popBoxRegister .img-loading").hide(),t.isOK?($(".blackbg,#popBoxRegister").hide(),$("#regLpBtn").attr("href","http://www.24k.hk/activity/studioLottery/index.html?userId="+t.userId+"#ba"),$(".register_result").show(),void 0):(box.showBoxError($("#popBoxRegister"),"<i></i>"+t.msg),!1)},!0,function(t){$(e).prop("disabled",!1),$("#popBoxRegister .img-loading").hide()})}}),$(".register_result .pop_close").bind("click",function(){indexJS.toRefreshView()}),$("#login_a").bind("click",function(e,t){t=t||{},box.toRoomId=t.groupId,box.openLgBox(t.closeable,t.showTip,t.loginTime)}),$("#logout").bind("click",function(){LoginAuto.setAutoLogin(!1),window.location.href="/studio/logout?platform="+indexJS.fromPlatform+"&cookieId="+chatAnalyze.getUTMCookie()+"&roomName="+$("#roomInfoId").text()+"&courseName="+indexJS.courseTick.course.courseName+"&courseId="+indexJS.courseTick.course.courseId||"&teacherId="+indexJS.courseTick.course.lecturerId||"&teacherName="+indexJS.courseTick.course.lecturer||""}),$("#loginForm .rbtn,#popBoxPassword2 .rbtn,#popBoxRegister .rbtn").click(function(){if(!$(this).hasClass("pressed")){var e=$(this).parents(".popup_box:first"),t=e.find("input[name=mobilePhone]").val();if(!common.isMobilePhone(t))return void box.showBoxError(e,"<i></i>手机号码有误，请重新输入！");$(this).addClass("pressed").html("发送中...");try{$.getJSON("/studio/getMobileVerifyCode?t="+(new Date).getTime(),{mobilePhone:t,useType:$(this).attr("ut")},function(t){t&&0==t.result?(box.showBoxError(e),box.setVerifyCodeTime(e.attr("id"))):("1005"==t.errcode?box.showBoxError(e,"<i></i>"+t.errmsg):console.error("提取数据有误！"),box.resetVerifyCode(e))})}catch(i){box.resetVerifyCode(e),console.error("setMobileVerifyCode->"+i)}}}),$("#loginForm input[name=verifyCode],#setNkForm input[name=nickname],#loginForm input[name=password]").keydown(function(e){return 13==e.keyCode?($(this).parents("form").find(".set_submit").click(),!1):void 0}),$("#logBtnSub").click(function(){if(!$(this).prop("disabled")&&($("#loginForm input[name=clientStoreId]").val(indexJS.userInfo.clientStoreId),box.checkFormInput($("#loginForm")))){$(this).prop("disabled",!0);var e=this;$("#formBtnLoad").show(),$('#loginForm [name="cookieId"]').val(chatAnalyze.getUTMCookie()),$('#loginForm [name="visitorId"]').val(indexJS.userInfo.visitorId||""),$('#loginForm [name="roomName"]').val($("#roomInfoId").text()),$('#loginForm [name="roomId"]').val(indexJS.userInfo.groupId||""),$('#loginForm [name="courseId"]').val(indexJS.courseTick.course.courseId||""),$('#loginForm [name="courseName"]').val(indexJS.courseTick.course.courseName),$('#loginForm [name="teacherId"]').val(indexJS.courseTick.course.lecturerId||""),$('#loginForm [name="teacherName"]').val(indexJS.courseTick.course.lecturer),common.getJson("/studio/login",$("#loginForm").serialize(),function(t){return $("#loginForm .error").hide(),$(e).prop("disabled",!1),$("#formBtnLoad").hide(),t.isOK?($(".blackbg,#loginBox").hide(),LoginAuto.setAutoLogin($("#autoLogin").prop("checked")),indexJS.userInfo.clientGroup=t.userInfo.clientGroup,box.toRoomId?common.getJson("/studio/checkGroupAuth",{groupId:box.toRoomId},function(e){e.isOK||alert("您没有访问该房间的权限，将为您跳转到默认房间，如有疑问，请联系老师助理。"),indexJS.toRefreshView()},!0,function(e){"success"!=e&&(box.preGroupId=null,alert("操作失败，请联系客服！"))}):(indexJS.showWelcomeMsg(),indexJS.toRefreshView()),void 0):($("#loginForm .error").html("<i></i>"+t.error.errmsg).show(),!1)},!0,function(t){$(e).prop("disabled",!1),$("#formBtnLoad").hide()})}})},getUserLevelShortName:function(e){var t="";switch(e){case"vip":t="l4";break;case"real":t="l3";break;case"active":t="l3";break;case"notActive":t="l3";break;case"simulate":t="l2";break;case"register":t="l1";break;default:t="l0"}return'<i class="level '+t+'"></i>'},checkFormInput:function(e){var t=!0;if(box.showBoxError(e),e.find("input").each(function(){return $(this).is(":visible")?common.isBlank($(this).val())?(("mobilePhone"==this.name||"userId"==this.name)&&box.showBoxError(e,"<i></i>手机号码不能为空！"),"verifyCode"==this.name&&box.showBoxError(e,"<i></i>验证码不能为空！"),"nickname"==this.name&&box.showBoxError(e,"<i></i>昵称不能为空！"),"password0"==this.name&&box.showBoxError(e,"<i></i>原始密码不能为空！"),"password"==this.name&&box.showBoxError(e,"<i></i>密码不能为空！"),"password1"==this.name&&box.showBoxError(e,"<i></i>确认密码不能为空！"),t=!1):"nickname"!=this.name||common.isRightName(this.value)?"password"!=this.name||/^.{6,20}$/.test(this.value)||"loginForm"==e.attr("id")?void 0:(box.showBoxError(e,"<i></i>密码由6至20数字、字母、符号组成！"),t=!1):(box.showBoxError(e,"<i></i>昵称为2至10位字符(数字/英文/中文/下划线)，不能全数字!"),t=!1):void 0}),!t)return t;var i=e.find("input[type='password']"),a=i.size();return 2==a&&i.eq(a-2).val()!=i.eq(a-1).val()?(box.showBoxError(e,"<i></i>两次密码输入不一致！"),t=!1):t},setVerifyCodeTime:function(e){var t=$("#"+e+" .rbtn"),i=parseInt(t.attr("t"))||120;this.verifyCodeIntMap[e]||(this.verifyCodeIntMap[e]=setInterval("box.setVerifyCodeTime('"+e+"')",1e3)),i>1?t.attr("t",i-1).html("重新获取("+(i-1)+")"):(clearInterval(this.verifyCodeIntMap[e]),this.verifyCodeIntMap[e]=null,t.attr("t",120).html("获取验证码").removeClass("pressed"))},resetVerifyCode:function(e){var t=e.attr("id");this.verifyCodeIntMap[t]&&(clearInterval(this.verifyCodeIntMap[t]),this.verifyCodeIntMap[t]=null),e.find(".rbtn").attr("t",120).html("获取验证码").removeClass("pressed")},openLgBox:function(e,t,i){e===!1||$(".login").data("closeable")===!1?($(".pop_close").hide(),$(".login").data("closeable",!1)):$(".pop_close").show(),t?(i=i||1,$("#login_tip").show().text($("#setlogintip").text())):$("#login_tip").hide(),$(".popup_box").hide(),common.openPopup(".blackbg,.login")},openSettingBox:function(e){$(".popup_box").hide();var t=null;switch(e){case"reg":t=$("#popBoxRegister");break;case"password1":t=$("#popBoxPassword1");break;case"password2":t=$("#popBoxPassword2");break;case"password3":t=$("#popBoxPassword3");break;case"nickname":t=$("#popBoxNickname")}box&&(box.showBoxError(t),t.find("input[type='text'],input[type='password']").each(function(){$(this).val("")}),t.show(),$(".blackbg").show())},showBoxError:function(e,t){t?e.find(".error").html(t).show():e.find(".error").html("").hide()},refreshVerifyCode:function(){var e=LoginAuto.sessionUser.groupType;$("#verifyCodeId img").attr("src","/"+e+"/getVerifyCode?code=email&v="+Math.random())},modifyAvatarEvent:function(){$("#modifyAvatar").click(function(){var e=$("#fileForm"),t=e.find("input[type=file]");"true"!=e.attr("hasEv")&&(e.attr("hasEv","true"),t.change(function(){var e=this,t=e.files[0];if(!t)return!1;if(0!=t.type.indexOf("image")||!t.type||!/\.(?:jpg|png|gif)$/.test(t.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=t.size;if(i>=524288)return alert("上传的图片大小不要超过512KB."),!1;try{var a=new FormData($("#fileForm")[0]);$.ajax({url:indexJS.apiUrl+"/upload/uploadFile",type:"POST",data:a,async:!1,cache:!1,contentType:!1,processData:!1,success:function(t){if(0==t.result){var i=t.data?t.data[0]:null;if(i){var a={item:"register_avatar"};common.getJson("/studio/modifyAvatar",{avatar:i.fileDomain+i.filePath,params:JSON.stringify(a)},function(t){t.isOK?($("#avatarInfoId").attr("src",t.avatar),$("#userListId li .mynk").prev().find("img").attr("src",t.avatar),indexJS.userInfo.avatar=t.avatar,$(e).val("")):console.error("上传头像失败，请联系在线客服！")},!0,function(){alert("上传头像失败，请联系在线客服！")})}}else alert("上传头像失败，请联系在线客服！")},error:function(e){console.error("error:",e)}})}catch(s){console.error("上传图片失败",s)}})),t.click()})},modifyUserNameEvent:function(){$("#setUserName").click(function(){$(this).addClass("dn"),$("#myUserName").removeAttr("disabled").focus(),$("#saveUserName").removeClass("dn")}),$("#saveUserName").click(function(){var e=$("#myUserName").val();if(common.isBlank(e))return void box.showMsg("请输入用户名");$(this).prop("disabled",!0);var t=this;common.getJson("/studio/modifyUName",{params:JSON.stringify({userName:e,item:""})},function(e){return $(t).attr("disabled",!1),e.isOK?(box.showMsg("修改成功"),$("#myUserName").prop("disabled",!0),$("#saveUserName").addClass("dn"),$("#setUserName").removeClass("dn"),void 0):(box.showMsg(e.msg?e.msg:"修改失败，请联系客服！"),!1)},!0,function(e){$(t).attr("disabled",!1)})})},modifyEmailEvent:function(){$("#bindEmail").click(function(){$(this).addClass("dn"),$("#myEmail").removeAttr("disabled").focus(),$("#saveEmail").removeClass("dn")}),$("#saveEmail").click(function(){var e=$("#myEmail").val();if(common.isBlank(e))return void box.showMsg("请输入邮箱地址");if(!common.isEmail(e))return void box.showMsg("邮箱地址有误");$(this).prop("disabled",!0);var t=this;common.getJson("/studio/modifyEmail",{params:JSON.stringify({email:e})},function(e){return $(t).attr("disabled",!1),e.isOK?(box.showMsg(e.msg),$("#myEmail").prop("disabled",!0),$("#saveEmail").addClass("dn"),$("#bindEmail").removeClass("dn"),void 0):(box.showMsg(e.msg?e.msg:"修改失败，请联系客服！"),!1)},!0,function(e){$(t).attr("disabled",!1)})})},modifyNickNameEvent:function(){$("#modifyNk").click(function(){$(this).addClass("dn"),$("#myNickName").removeAttr("disabled").focus(),$("#setNkBtn").removeClass("dn")}),$("#setNkBtn").click(function(){var e=$("#myNickName").val();if(common.isBlank(e))return void box.showMsg("请输入昵称");if(!common.isRightName(e))return void box.showMsg("昵称为2至10位字符(数字/英文/中文/下划线)，不能全数字!");$(this).prop("disabled",!0);var t=this;common.getJson("/studio/modifyName",{nickname:e},function(e){return $(t).attr("disabled",!1),e.isOK?(indexJS.refreshNickname(!0,e.nickname),$("#myNickName").prop("disabled",!0),$("#setNkBtn").addClass("dn"),$("#modifyNk").removeClass("dn"),$(".nickNameTip").addClass("dn"),void 0):(box.showMsg(e.msg?e.msg:"修改失败，请联系客服！"),!1)},!0,function(e){$(t).attr("disabled",!1)})})},modifyPasswordEvent:function(){$("#modifyPwd").click(function(){common.openPopup($(".change_psw"))}),$("#savePwd").click(function(){var e=$("#oPwd").val(),t=$("#newPwd").val(),i=$("#newPwd1").val();if(common.isBlank(e)&&"true"==$("#oPwd").attr("s"))return void $(".change_psw .error").html("<i></i>请输入原始密码！").removeClass("dn");if(common.isBlank(t))return void $(".change_psw .error").html("<i></i>请输入新密码！").removeClass("dn");if(!/^.{6,20}$/.test(t))return void $(".change_psw .error").html("<i></i>密码由6至20数字、字母、符号组成！").removeClass("dn");if(common.isBlank(i))return void $(".change_psw .error").html("<i></i>请输入确认新的密码！").removeClass("dn");if(t!=i)return void $(".change_psw .error").html("<i></i>两次密码输入不一致！").removeClass("dn");$(".change_psw .error").addClass("dn"),$(this).prop("disabled",!0);var a=this,s={password:e,newPwd:t,newPwd1:i,item:""};common.getJson("/studio/modifyPwd",{params:JSON.stringify(s)},function(e){return $(a).attr("disabled",!1),e.isOK?(box.openLgBox(!0,!1,null),$("#myPwd").prop("disabled",!0),$(".change_psw").hide(),$('.change_psw form input[type="password"]').val(""),void 0):($(".change_psw .error").html("<i></i>"+(e.msg?e.msg:"修改失败，请联系客服！")).removeClass("dn"),!1)},!0,function(e){$(a).prop("disabled",!1)})})},hideMsg:function(){$("#popMsgBox").is(":visible")&&$("#popMsgBox").fadeOut("normal","swing",function(){$("div.popup_box:visible").length<1&&$("div.pletter_win:visible").length<1&&$(".blackbg").hide()})},showMsg:function(e){"string"==typeof e&&(e={msg:e}),e=$.extend({closeable:!0,title:"",msg:"",modal:!0,delay:0,btns:[{txt:"确定",fn:function(){box.hideMsg()}}]},e),$("#popMsgTit").text(e.title||""),$("#popMsgTxt").text(e.msg);var t=$("#popMsgCont");t.find("a.yesbtn").remove();for(var i=null,a=null,s=0,n=e.btns?e.btns.length:0;n>s;s++)i=e.btns[s],a=$('<a class="yesbtn" href="javascript:void(0)">'+i.txt+"</a>"),t.append(a),a.click(i.fn);e.closeable?$("#popMsgClo").show():$("#popMsgClo").hide(),$("#popMsgBox").show(),e.modal&&$(".blackbg").show(),e.delay&&window.setTimeout(function(){box.hideMsg()},e.delay)},showTipBox:function(e){$(".tipsbox").fadeIn().delay(1e3).fadeOut(200).find(".cont").text(e)},contVerifyCodeTime:function(){var e=$("#loginForm input[name=mobilePhone]").val();if(e&&this.enable){var t=this.storeInfoKey+e,i=store.get(t);if(i>1){var a="#loginForm .rbtn";$(a).attr("t",i).addClass("pressed"),box.setVerifyCodeTime(a)}}},setDownloadPPT:function(e,t){common.isBlank(t)&&(t='{"sequence":"desc","publishStartDate":"desc"}'),indexJS.getArticleList("download",indexJS.userInfo.groupId,1,e,5,t,null,function(e){if($("#totalRecords").text("共"+e.totalRecords),$("#page b").text(e.pageNo),$("#page span").text(Math.ceil(e.totalRecords/5)),e&&0==e.result){var t=e.data,i=null,a=[],s=box.formatHtml("download"),n=$(".downtable table tbody");n.html("");for(var o in t){a=[],i=t[o].detailList[0];var r=t[o].mediaUrl.substring(t[o].mediaUrl.lastIndexOf(".")+1).toLowerCase(),l=i.title+"."+r,c=common.formatterDate(t[o].publishStartDate,"-").replace("-","/").replace("-","/");a.push(s.formatStr(r,i.title,i.authorInfo?i.authorInfo.name:"",c,t[o].point,common.isBlank(t[o].downloads)?0:t[o].downloads,l,t[o]._id,i.remark,common.isBlank(i.remark)?' style="display:none;"':"")),a=$(a.join("")),$(a).find("a.downbtn").data("file_url",t[o].mediaUrl),n.append(a)}box.setDownloads()}})},setDownloads:function(){$(".downtable table tbody a.downbtn").click(function(){var e=$(this),t={groupType:indexJS.userInfo.groupType,item:"used_download",remark:"下载"+e.attr("dn"),val:-parseInt(e.attr("p")),tag:"download_"+e.attr("_id")};common.getJson("/studio/addPointsInfo",{params:JSON.stringify(t)},function(t){return t.isOK?(common.getJson(indexJS.apiUrl+"/common/modifyArticle",{id:e.attr("_id"),type:"downloads"},function(i){i.isOK&&(common.isValid(t.msg)&&"number"==typeof t.msg.change&&box.showMsg("消费"+-t.msg.change+"积分"),e.parent().prev().text(i.num))}),void($.inArray(e.attr("sufix"),["pdf","png","jpg","jpeg","gif"])>-1?window.open(e.data("file_url")):window.location.href=e.data("file_url"))):(box.showMsg(t.msg),!1)})})},getDownloadSort:function(){var e="";switch($(".infodown .ranknavbar a.on").attr("sort")){case"point":e='{"point":"desc"}';break;case"uptime":e='{"createDate":"desc"}'}return e},setVipBeneFit:function(e){common.isBlank(e)&&(e="member_activity"),indexJS.getArticleList(e,indexJS.userInfo.groupId,1,1,1,'{"sequence":"desc","publishStartDate":"desc"}',null,function(t){if(t&&0==t.result){var i=t.data[0].detailList[0];$("div[t="+e+"] .benefit_table").html(i.content)}})},formatHtml:function(e){var t=[];switch(e){case"download":t.push("<tr>"),t.push("    <td>{0}</td>"),t.push('    <td class="sname">{1}'),t.push('        <div class="arr"{9}><i></i><i class="i2"></i></div>'),t.push('        <div class="cmbox"{9}>'),t.push('            <div class="cont">'),t.push("                <b>推荐理由：</b>"),t.push("                <p>{8}</p>"),t.push("            </div>"),t.push("        </div>"),t.push("    </td>"),t.push("    <td>{2}</td>"),t.push("    <td>{3}</td>"),t.push("    <td>{4}积分</td>"),t.push("    <td>{5}</td>"),t.push('    <td><a href="javascript:void(0);" target="download" dn="{6}" p="{4}" _id="{7}" class="downbtn" sufix="{0}" onclick="_gaq.push([\'_trackEvent\', \'pmchat_studio\', \'header_zl_download\', \'content_top\', 1, true]);">下载</a></td>'),t.push("</tr>");break;case"signin":t.push("<li>"),t.push('     <div class="himg"><img src="{0}" alt=""></div>'),t.push("     <span>{1}</span>"),t.push("</li>")}return t.join("")}},videos={init:function(){return this.rollNews.bindEvents(),this.playlist.init(),this.playAuto(!1),this},player:{videoData:function(e,t,i){var a=e.data("videoData")||{};return 3==arguments.length?(a[t]=i,e.data("videoData",a),a):a[t]},playByIframe:function(e,t,i,a){this.clear(e),e.append('<iframe frameborder=0 width="100%" height="100%" src="'+t+'" allowfullscreen></iframe>')},playByBLWS:function(e,t,i,a){var s=t.split("&");if(s.length>1){var n=s[1].replace(/^vid=/g,"");if(this.clear(e),this.videoData(e,"isLoading"));else if(window.polyvObject){var o=polyvObject(e).videoPlayer({width:"100%",height:"100%",vid:n,flashvars:{autoplay:a,setScreen:"fill"},onPlayOver:function(e){}});this.videoData(e,"player",o)}else{this.videoData(e,"isLoading",!0);var r=this;LazyLoad.js(["/base/lib/polyvplayer.min.js"],function(){var t=polyvObject(e).videoPlayer({width:"100%",height:"100%",vid:n,flashvars:{autoplay:a,setScreen:"fill"},onPlayOver:function(e){}});r.videoData(e,"player",t),r.videoData(e,"isLoading",!1)})}}},playBySewise:function(e,t,i,a){if(this.clear(e),this.videoData(e,"isLoading"));else if(window.Sewise){var s=new Sewise.SewisePlayer({elid:e,autostart:a,url:t,title:i,skin:"vodWhite",localPath:"/base/lib/sewise/"});a&&s.startup(),this.videoData(e,"player",s)}else{this.videoData(e,"isLoading",!0);var n=this;LazyLoad.js(["/base/lib/sewise/sewise.player.min.js"],function(){var s=new Sewise.SewisePlayer({elid:e,autostart:a,url:t,title:i,skin:"vodWhite",localPath:"/base/lib/sewise/"});a&&s.startup(),n.videoData(e,"player",s),n.videoData(e,"isLoading",!1)})}},playByEmbed:function(e,t,i,a){this.clear(e);var s=[];s.push('<embed src="'),s.push(t),s.push('" autostart="'+a+'" wmode="Opaque" quality="high" width="100%" height="100%" align="middle" allowScriptAccess="never" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>'),e.html(s.join(""))},playByVideo:function(e,t,i,a){this.clear(e),e.html('<video src="'+t+'" controls="true" webkit-playsinline autoplay="'+a+'" style="width: 100%; height: 100%; background-color: rgb(0, 0, 0);"></video>');var s=e.find("video");a?s.trigger("play"):s.trigger("pause")},clear:function(e){e.empty()},play:function(e,t){if(e){var i=$("#videoPlayerPanel");if(this.videoData(i,"currVideoUrl")==e&&this.videoData(i,"currVideoTitle")==t)return;this.videoData(i,"currVideoUrl",e),this.videoData(i,"currVideoTitle",t),/\.html/.test(e)?this.playByIframe(i,e,t,!0):/type=blws/.test(e)?this.playByBLWS(i,e,t,!0):/\.swf/.test(e)?this.playByEmbed(i,e,t,!0):/rtmp/.test(e)?obsPlayer.init(e,"videoPlayerPanel",!0):this.playBySewise(i,e,t,!0),videos.setStudioInfo(!1)}}},playlist:{init:function(){indexJS.setListScroll($(".mod_livelist .livetab .scrollbox")),this.setEvent(),this.initToday(indexJS.syllabusData&&indexJS.syllabusData.courses)},initToday:function(e){if($("#playlist_panel ul[t='today']").html(""),!e)return void $("#playlist_hide").trigger("click");for(var t,i=new Date(indexJS.serverTime).getDay(),a=e.days,s=e.timeBuckets,n=[],o=0,r=0,l=a.length;l>r;r++)if(a[r].day==i&&1==a[r].status){for(var c=0,d=s.length;d>c;c++)t=s[c].course[r],0!=t.status&&t.lecturer&&(o++,n.push('<li class="" st="'+s[c].startTime+'" et="'+s[c].endTime+'">'),n.push('<span class="fl">'),n.push("<b>"+o+"</b>"),n.push(t.title),n.push("</span>"),n.push('<span class="fr">'),n.push(s[c].startTime+"-"+s[c].endTime),n.push("</span></li>"));$("#playlist_panel ul[t='today']").html(n.join(""));break}this.refreshStyle(),window.setTimeout(function(){$("#playlist_hide").trigger("click")},5e3)},initYesterday:function(){$("#playlist_panel ul[t='yesterday']").html(""),$.getJSON("/studio/getSyllabusHis",{groupType:indexJS.userInfo.groupType,groupId:indexJS.userInfo.groupId},function(e){if(e){for(var t=null,i=[],a=0,s=e.length;s>a;a++)t=e[a],i.push('<li class="" st="'+t.startTime+'" et="'+t.endTime+'">'),i.push('<span class="fl">'),i.push("<b>"+a+"</b>"),i.push(t.title),i.push("</span>"),i.push('<span class="fr">'),i.push(t.startTime+"-"+t.endTime),i.push("</span></li>");$("#playlist_panel ul[t='yesterday']").html(i.join(""))}})},setEvent:function(){$("#playlist_nav a").bind("click",function(){var e=$(this).attr("t");$(this).addClass("on").siblings().removeClass("on"),$("#playlist_panel ul[t!='"+e+"']").hide(),$("#playlist_panel ul[t='"+e+"']").show()}),$("#playlist_hide").bind("click",function(){$("#playlist_min").show(),$("#playlist_max").hide()}),$("#playlist_show").bind("click",function(){$("#playlist_min").hide(),$("#playlist_max").show()})},refreshStyle:function(){var e=common.getHHMM(indexJS.serverTime);$("#playlist_panel ul[t='today'] li").each(function(){e<$(this).attr("st")?$(this).attr("class",""):e<$(this).attr("et")?$(this).attr("class","on"):$(this).attr("class","over")})}},rollNews:{newMarIntervalId:null,bindEvents:function(){$(".mod_scrollnews .newsclose").click(function(){$(".mod_scrollnews .newslist").hide(),$(".mod_scrollnews .newsbtn").show(),clearInterval(videos.rollNews.newMarIntervalId),videos.rollNews.newMarIntervalId=null}),$(".mod_scrollnews .newsbtn").click(function(){$(this).hide(),$(".mod_scrollnews .newslist").slideDown(),videos.rollNews.newsMarquee(!0)}),$("#newscont1 a").live("click",function(){return"false"===$(this).attr("url")?($("#popMsgTit").text($(this).attr("title")),$("#popMsgTxt").html($(this).data("content")||"没有内容"),$("#popMsgBox,.blackbg").show(),indexJS.setListScroll(".popMsgBox"),!1):void 0}),$("#newscont2 a").live("click",function(){return"false"===$(this).attr("url")?($("#newscont1 a[tid='"+$(this).attr("tid")+"']").trigger("click"),!1):void 0})},update:function(e){var t=$("#newscont1");if(e["delete"]){var i=e.ids.split(",");if(i.length>0)for(var a=0;a<i.length;a++)t.find('a[tid="'+i[a]+'"]').remove()}else if(e.edit){e.isValid="true"==e.isValid?!0:!1,!e.isValid||indexJS.userInfo.clientGroup&&e.clientGroup&&-1!=$.inArray(indexJS.userInfo.clientGroup,e.clientGroup)||(e.isValid=!1);var s=t.find('a[tid="'+e.id+'"]');if(e.isValid)if(s.size()>0)common.isValid(e.url)?s.attr({title:e.title,href:e.url,url:"true"}).html("<i></i><span>"+e.title+"</span>"):s.attr({title:e.title,url:"false"}).html("<i></i><span>"+e.title+"</span>").data("content",e.content);else{var n=$('<a href="javascript:void(0);" tid="'+e.id+'" title="'+e.title+"\" target=\"_blank\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'left_sp_zimutxt', 'content_left', 1, true]);\"><i></i><span>"+e.title+"</span></a>");common.isValid(e.url)?n.attr({href:e.url,url:"true"}):n.attr({url:"false"}).data("content",e.content),t.append(n)}else s.size()>0&&s.remove()}else if(e.infos){var o=e.infos.length,n=null;if(o>0)for(var a=0;o>a;a++)indexJS.userInfo.clientGroup&&e.infos[a].clientGroup&&$.inArray(indexJS.userInfo.clientGroup,e.infos[a].clientGroup)>-1&&1==e.infos[a].pushType&&e.infos[a].contentId&&e.infos[a].title&&(common.isValid(e.infos[a].url)?n=$('<a href="'+e.infos[a].url+'" url="true" tid="'+e.infos[a].contentId+'" title="'+e.infos[a].title+"\" target=\"_blank\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'left_sp_zimutxt', 'content_left', 1, true]);\"><i></i><span>"+e.infos[a].title+"</span></a>"):(n=$('<a href="javascript:void(0);" url="false" tid="'+e.infos[a].contentId+'" title="'+e.infos[a].title+"\" target=\"_blank\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'left_sp_zimutxt', 'content_left', 1, true]);\"><i></i><span>"+e.infos[a].title+"</span></a>"),
n.data("content",e.infos[a].content)),t.append(n))}this.newsMarquee(!0)},newsMarquee:function(e){videos.rollNews.newMarIntervalId&&(clearInterval(videos.rollNews.newMarIntervalId),videos.rollNews.newMarIntervalId=null);var t=30,i=$(".mod_scrollnews"),a=$("#scrollnews_demo")[0],s=$("#newscont1"),n=$("#newscont2");if(e&&s.children().size()>0?i.show():i.hide(),n.html(""),$(a).unbind("mouseover mouseout"),e){s.css("width","auto"),n.css("width","auto");var o=i.width()-27;s.width()<o&&(s.css("width",o),n.css("width",o)),n.html(s.html());var r=function(){s.width()-a.scrollLeft<=0?a.scrollLeft-=s.width():a.scrollLeft++};videos.rollNews.newMarIntervalId=window.setInterval(r,t),$(a).bind("mouseover",function(){window.clearInterval(videos.rollNews.newMarIntervalId),videos.rollNews.newMarIntervalId=null}).bind("mouseout",function(){videos.rollNews.newMarIntervalId&&(window.clearInterval(videos.rollNews.newMarIntervalId),videos.rollNews.newMarIntervalId=null),videos.rollNews.newMarIntervalId=window.setInterval(r,t)})}}},playAuto:function(e){var t=indexJS.courseTick.course,i=$("#videoPlayerPanel");!t||!t.lecturerId||t.isNext||0!=t.courseType&&3!=t.courseType&&common.isBlank(t.studioLink)?e?(this.setStudioInfo(t),this.player.clear(i)):(this.setStudioInfo(!1),videosTeach.playRandomTeach(!0)):0==t.courseType?(this.setStudioInfo(t),this.player.clear(i)):(this.setStudioInfo(!1),this.player.play(t.studioLink,t.title)),videos.rollNews.newsMarquee(t&&1==t.courseType),this.refreshCourseStyle(t)},refreshVideo:function(){var e=indexJS.courseTick.course;$(".tabnav a.tablink.live").is(".on")?this.playAuto(!0):this.refreshCourseStyle(e)},refreshCourseStyle:function(e){this.playlist.refreshStyle();var t=$("#roomList_panel a.on>i");e&&e.lecturerId&&!e.isNext?t.addClass("living"):t.removeClass("living"),$("#course_panel li.on").removeClass("on"),e&&e.lecturerId&&$("#course_panel .main_tab[d="+e.day+"]").find('li a[st="'+e.startTime+'"][et="'+e.endTime+'"]').parent().addClass("on")},setStudioInfo:function(e){return e===!1?void $("#nextCourse").hide():($("#nextCourse").show(),e&&e.lecturerId?void((e.isNext||0==e.courseType)&&videos.setNextCourse(e)):($("#nextCourse").find(".ntext").text("当前暂无直播"),void $("#nextCourse .nextbox").hide()))},setNextCourse:function(e,t){if(e){var i="当前暂无直播，请关注下节课";e.isNext||0!=e.courseType||(i="当前正在文字直播"),$("#nextCourse").find(".ntext").text(i),$("#nextCourse .nextbox").show(),$("#nextCourse").find(".t_name").text(e.lecturer),$("#nextCourse").find(".live_name").text(e.title),$("#nextCourse").find(".time").text(common.daysCN[e.day]+" "+e.startTime+" - "+e.endTime);var a=$("#nextCourse").find(".tec_head"),s=a.data("avatars")||{},n=e.lecturerId||"";n=n.replace(/(,\w+)*$/g,"");var o=a.data("lecturerId");o!=n&&n&&(s.hasOwnProperty(o)?a.find("img").attr("src",s[o]):(a.data("lecturerId",n),$.getJSON("/studio/getUserInfo",{uid:n},function(e){if(e&&e.userNo){var t=$("#nextCourse").find(".tec_head"),i=t.data("avatars")||{};i[e.userNo]=e.avatar||"",t.data("avatars",i),t.data("lecturerId")==e.userNo&&t.find("img").attr("src",i[e.userNo])}})))}$("#lvVideoId").hide(),$("#nextCourse").show()},refreshStudioInfoAvatar:function(e){$("#nextCourse").find("img").attr("src",e)}};$(".slidebox").slide({mainCell:".slideinner",effect:"left",autoPlay:!1,delayTime:300,interTime:4e3,prevCell:".sl_prev",nextCell:".sl_next"});var videosLive={init:function(){this.setEvent(),this.getMarketPrice(),this.setCftcCot(),this.setSymbolOpenPositionRatios(),this.initCalendar(function(){}),this.setFinanceData("",1),this.setInformation()},setEvent:function(){$(".tabcont .main_tab .s1 a").click(function(){if($(this).hasClass("on"))return!1;var e=$(this),t=$(this).attr("cgs"),i=e.find("b").text(),a=e.attr("rt");if("false"==e.attr("av")&&indexJS.checkClientGroup("visitor"))return $("#login_a").trigger("click",{groupId:e.attr("rid"),closeable:!1}),!1;if(!common.containSplitStr(t,indexJS.userInfo.clientGroup))return videosLive.changeRoomMsg({title:i,roomType:a,clientGroups:t}),!1;if("2"==e.attr("st")){if("train"==a)return"1"!=e.attr("ha")?("true"!=e.attr("sp")?chatTeacher.trainDetailsLoad($(this).attr("userno"),$(this).text()):videosLive.changeRoomMsg({title:i,type:"onlyTrain"}),!1):(chatTeacher.trainRegis(e),!1);if("1"!=e.attr("ha"))return videosLive.changeRoomMsg({title:i,type:"onlyMark"}),!1}common.getJson("/studio/checkGroupAuth",{groupId:e.attr("rid")},function(s){s.isOK?indexJS.toRefreshView():"train"==a?common.getJson("/studio/getchatGroupByGroupId",{groupId:e.attr("rid")},function(t){for(var a=t.traninClient,s=!1,n=0;n<a.length;n++){var o=a[n];if(indexJS.userInfo.userId==o.clientId){s=!0;break}}if(s)if(t.point&&Math.abs(t.point)>0){var r="您未报名培训班或者未通过审核，是否消耗"+t.point+"积分直接进入房间？";videosLive.changeRoomMsg({title:i,msg:r},function(){var i=t.point,a={groupType:indexJS.userInfo.groupType,item:"prerogative_room",tag:"user_"+indexJS.userInfo.userId,val:-t.point,groupId:e.attr("rid")};0!=i?common.getJson("/studio/addPointsInfo",{params:JSON.stringify(a)},function(e){e.isOK?common.getJson("/studio/updateSession",{params:JSON.stringify(a)},function(e){e.isOK&&indexJS.toRefreshView()}):box.showTipBox(e.msg)}):common.getJson("/studio/updateSession",{params:JSON.stringify(a)},function(e){e.isOK&&indexJS.toRefreshView()})})}else indexJS.toRefreshView()}):videosLive.changeRoomMsg({title:i,roomType:a,clientGroups:t})},!0,function(e){"success"!=e&&videosLive.changeRoomMsg({title:i,type:"error"})})}),indexJS.setListScroll($(".tabcont .main_tab .infocont .rbox .scrollbox")),$("#calendarFinance").val(videosLive.currentDate()),$("#calendarFinance").change(function(){var e=$(this).val();videosLive.setFinanceData(e,1)}),$(".calenda_sel a").click(function(){$(this).addClass("on").siblings("").removeClass("on");var e=($(".calenda_show .scrollbox ul").html(),$(this).attr("data")),t=$("#calendarFinance").val();videosLive.setFinanceData(t,1,e)}),$(".querybtn").click(function(){var e=$("#calendarFinance").val();videosLive.setFinanceData(e,1)}),$(".casel_more_sel").click(function(){common.openPopup(".blackbg,.calenda_select")}),$("#countrySel li").click(function(){var e=$("#calendarFinance").val(),t=$(this).find("img").attr("alt");$(".blackbg").hide(),$(".calenda_select").hide(),videosLive.setFinanceData(e,1,"countrysel_"+t)}),$("#importanceQuery li").click(function(){var e=$("#calendarFinance").val(),t=$(this).attr("ta");$(".blackbg").hide(),$(".calenda_select").hide(),videosLive.setFinanceData(e,1,"stars_"+t)})},currentDate:function(){return common.formatterDate(indexJS.serverTime,"-")},changeRoomMsg:function(e,t){var i={onlyTrain:"该房间仅对培训班学员开放，",onlyNew:"该房间仅对新客户开放，",onlyActive:"已有真实账户并激活的客户才可进入该房间，您还不满足条件，",onlyVip:"该房间仅对VIP客户开放，",onlyMark:"该房间仅对指定客户开放，",noAuth:"您没有访问该房间的权限，",error:"操作失败，"};t||(t=function(){videosLive.contactTeacher(),_gaq.push(["_trackEvent","pmchat_studio","left_zb_confirm","content_left",1,!0])}),e=e||{},e.type&&i.hasOwnProperty(e.type)?e.msg=i[e.type]:"train"==e.roomType?e.msg=i.onlyTrain:"2"==e.status?e.msg=i.onlyMark:e.clientGroups&&(/^((,visitor)|(,register))+$/.test(","+e.clientGroups)?e.msg=i.onlyNew:"vip"==e.clientGroups?e.msg=i.onlyVip:/^((,active)|(,vip))+$/.test(","+e.clientGroups)&&(e.msg=i.onlyActive)),box.showMsg({title:e.title||"",msg:e.msg||i.noAuth,btns:[{txt:"确定",fn:t}]});var a="<a class=\"contactContact\" style=\"color:#2980d1; font-size:14px;text-decoration:none;cursor:pointer\" onclick=\"videosLive.contactTeacher();_gaq.push(['_trackEvent', 'pmchat_studio', 'left_zb_callzhuli', 'content_left', 1, true]);\">如有疑问请联系老师助理</a>。";$("#popMsgTxt").append(a)},getMarketPrice:function(){var e="wss://kdata.gwfx.com:7087/websocket.do",t="service=HqDataWebSocketService&method=pushMarketprice&symbol=XAGUSD|XAUUSD|USDX|CLWTI&dataType=simpleMarketPrice",i="https://kdata.gwfx.com:7099/gateway.do?service=HqDataService&method=getMarkrtPriceDataFromCache",a={from:"studio",fall:"fall"};getAllMarketpriceIndex(e,t,i,a)},setCftcCot:function(){$.getJSON("https://oa.24k.hk/activity20160603/getShortRatiosList?callbackFun=?",null,function(e){var t={LLG:"伦敦金",LLS:"伦敦银"};if(null!=e&&e){var i=[],a=videosLive.formatHtml("cftcperc");$.each(t,function(t,s){var n=t+"BuyRatios",o=t+"SellRatios";i.push(a.formatStr(e[n],e[o],s)),$("#ratioInfoUpdateTime").text("上次更新时间："+e.LLGDate+" 11:15 GMT+0800")}),$(".rbox .infobox .ratioInfo").html(i.join("")),videosLive.initEasyPieChart(function(){})}else videosLive.setCftcCot()})},initEasyPieChart:function(e){if($(".tabnav .live").hasClass("initEasyPieChart"))e();else{var t=[];$.browser.msie&&t.push("/base/lib/excanvas.compiled.js"),t.push("/base/lib/jquery.easy-pie-chart.min.js"),LazyLoad.js(t,function(){$(".percentage").easyPieChart({barColor:"#e34b51",trackColor:"#2bb38a",scaleColor:!1,lineCap:"square",lineWidth:2,animate:1e3,size:65}),e()})}},setSymbolOpenPositionRatios:function(){var e={LLS:"伦敦银",LLG:"伦敦金"};$.getJSON("/studio/getSymbolOpenPositionRatios",null,function(t){if(null!=t&&"SUCCESS"==t.code){var i=t.result,a=[],s=videosLive.formatHtml("symbolOpenPositionRatios");$.each(i,function(t,i){a.push(s.formatStr(e[i.symbol],i.openPositionRatios)),$("#percentInfoUpdateTime").text("上次更新时间："+common.formatterDate(i.date.time)+" 11:15 GMT+0800")}),$(".rbox .infobox .percentInfo").html(a.join(""))}})},initCalendar:function(e){$(".dr3").hasClass("initCalendar")?e():LazyLoad.js(["/base/lib/pikaday/moment.min.js","/base/lib/pikaday/pikaday.min.js"],function(){var t=videosLive.currentDate(),i={previousMonth:"上个月",nextMonth:"下个月",months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],weekdays:["周日","周一","周二","周三","周四","周五","周六"],weekdaysShort:["日","一","二","三","四","五","六"]};new Pikaday({field:$("#calendarFinance")[0],firstDay:1,container:$("#calendarContainer")[0],defaultDate:t,i18n:i,minDate:new Date(2e3,0,1),maxDate:new Date(2050,12,31),yearRange:[2e3,2050],onSelect:function(){document.createTextNode(this.getMoment().format("YYYY-MM-DD")+" ")}});e()})},setFinanceData:function(e,t,i){common.isBlank(e)&&(e=videosLive.currentDate()),common.getJson("/studio/getFinancData",{releaseTime:e,dataTypeCon:t},function(e){if(0==e.result){var t={"德国":"Germany","法国":"France","欧元区":"EUR","加拿大":"CAD","美国":"USD","澳大利亚":"AUD","日本":"JPY","瑞士":"CHF","意大利":"Italy","英国":"GBP","中国":"CNY","新西兰":"NZD","韩国":"SK","香港":"HKD","西班牙":"Spain","台湾":"Taiwan","印度":"INR","新加坡":"Singapore"},a="",s=videosLive.formatHtml("finance");$.each(e.data.financeData,function(e,n){var o="";e%2==0&&0!=e&&(o="r");var r=common.isBlank(n.name)?"---":n.name,l=common.isBlank(n.predictValue)?"---":n.predictValue,c=common.isBlank(n.value)?"---":n.value,d=n.time.substring(0,5),u=common.isBlank(n.country)?"---":n.country,p=common.isBlank(t[u])?"none":t[u],h=videosLive.importanceLevel(n.importanceLevel);if("undefined"!=typeof i)if("usdx"==i)("欧元区"==u||"美国"==u)&&(a+=s.formatStr(o,r,l,c,d,p,u,h));else if("pm"==i){var m=n.description,f=m.indexOf("PM_");0==f&&(a+=s.formatStr(o,r,l,c,d,p,u,h))}else if("all"==i)a+=s.formatStr(o,r,l,c,d,p,u,h);else{if(-1!=i.indexOf("countrysel_")){var g=i.split("_")[1];u==g&&(a+=s.formatStr(o,r,l,c,d,p,u,h))}if(-1!=i.indexOf("stars_")){var v=i.split("_")[1];n.importanceLevel==v&&(a+=s.formatStr(o,r,l,c,d,p,u,h))}}else a+=s.formatStr(o,r,l,c,d,p,u,h)}),$(".calenda_show .scrollbox ul").html(a),indexJS.setListScroll(".calenda_show .scrollbox",{isCustom:!1,scrollbarPosition:"outside",theme:"dark-2"})}})},setInformation:function(){var e=$(".message_list ").find(".scrollbox"),t=$("#newInfoCount").attr("t");!common.isBlank(t)&&indexJS.serverTime-t<12e4||$.getJSON(indexJS.apiUrl+"/common/getInformation?t="+indexJS.serverTime,null,function(t){if(t&&t.isOK){var i=$("#newInfoCount").attr("pt"),a=null,s="",n=videosLive.formatHtml("news");$.each(t.data.news.item,function(e,t){i==t.pubDate&&common.isValid(i)&&(indexJS.infoNewCount++,$("#newInfoCount").text(indexJS.infoNewCount).css("display","inline-block")),1>e&&(a=t.pubDate),(t.pubDate>i||common.isBlank(i))&&(s+=n.formatStr(t.pubDate.substring(10),t.title))}),common.isValid(s)&&$(".message_list .scrollbox ul").html(s),common.isBlank(i)&&$("#newInfoCount").attr("pt",a),indexJS.setListScroll(e),$("#newInfoCount").attr("pt",a),$(".message_list .scrollbox:eq(2)").hasClass("on")&&(indexJS.infoNewCount=0,$("#newInfoCount").attr({pt:a,t:indexJS.serverTime}).text(indexJS.infoNewCount).hide())}})},formatHtml:function(e){var t=[];switch(e){case"finance":t.push('<li class="{0}">'),t.push('    <div class="cacont">'),t.push('        <div class="ca_item"><i></i><span>{1}</span></div>'),t.push('        <div class="ca_detail">'),t.push('            <table cellpadding="0" cellspacing="0" border="0" width="100%">'),t.push("                <tr>"),t.push("                    <td><strong>预测值:</strong>-<b>{2}</b> </td>"),t.push('                    <td class="t3"><strong>公布值:</strong>-<b>{3}</b></td>'),t.push("                </tr>"),t.push("                <tr>"),t.push('                    <td class="tl"><span class="timetag">{4}</span></td>'),t.push('                    <td><i class="country"><img src="//img.kgold852.com/public/economicCalenda/images/country/{5}.png" width="100%" alt="{6}"></i>{6}</td>'),t.push('                    <td><div class="star">{7}</div></td>'),t.push("                </tr>"),t.push("            </table>"),t.push("        </div>"),t.push("    </div>"),t.push("</li>");break;case"news":t.push("<li><span><i></i><b>{0} </b>{1}</span></li>");break;case"cftcperc":t.push('<div class="ratiobox">'),t.push('    <div class="data">'),t.push("        <span>多头<b>{0}</b>%</span><br>"),t.push('        <span class="b">空头<b>{1}</b>%</span>'),t.push("    </div>"),t.push('    <div class="percentage easyPieChart" data-percent="{1}">'),t.push('        <b class="rationame">{2}</b>'),t.push("    </div>"),t.push("</div>");break;case"symbolOpenPositionRatios":t.push('<div class="perbox">'),t.push('    <span class="pname">{0}</span>'),t.push('    <span class="pervalue">{1}%</span>'),t.push('    <div class="main"><b class="bar" style="width:{1}%"></b></div>'),t.push("</div>")}return t.join("")},contactTeacher:function(){0==$(".pletter_win .mult_dialog a[utype=3]").length&&chat.getCSList(),$(this).hasClass("nocs")?box.showTipBox("助理失联中"):common.openPopup(".blackbg,.pletter_win"),$("#popMsgBox").hide()},importanceLevel:function(e){var t="";switch(e){case 1:t='<span class="on">★</span><span>★</span><span>★</span><span>★</span><span>★</span>';break;case 2:t='<span class="on">★</span><span class="on">★</span><span>★</span><span>★</span><span>★</span>';break;case 3:t='<span class="on">★</span><span class="on">★</span><span class="on">★</span><span>★</span><span>★</span>';break;case 4:t='<span class="on">★</span><span class="on">★</span><span class="on">★</span><span class="on">★</span><span>★</span>';break;case 5:t='<span class="on">★</span><span class="on">★</span><span class="on">★</span><span class="on">★</span><span class="on">★</span>';break;default:t="<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>"}return t}},videosTeach={init:function(){this.setEvent()},setEvent:function(){$("#teachVideoId a").bind("click",function(e,t,i){$("#teachVideoId a").removeClass("on");var a=$(this);videosTeach.setVideoList(a.addClass("on").attr("t"),function(){"function"==typeof t&&t(i)})})},setVideoList:function(e,t){var i=$("#teachVideoPanel .sub_tab .numbox .inner"),a=$("#teachVideoPanel").attr("t");a!=e&&($("#teachVideoPanel").attr("t",e),i.html(""),indexJS.getArticleList(e,indexJS.userInfo.groupId,0,1,100,'{"sequence":"desc","publishStartDate":"desc"}',null,function(e){if(e&&0==e.result){var a,s=e.data;for(var n in s)a=s[n].detailList[0],i.append('<div title="'+a.title+'" class="c_num"><a href="javascript:void(0);" title="'+a.title+'" ct="'+s[n].categoryId+'" id="'+s[n]._id+'" t="'+(common.isValid(s[n].mediaUrl)&&-1!=s[n].mediaUrl.indexOf(".mp4")?"mp4":"")+'" vurl="'+s[n].mediaUrl+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'left_jx_video', '"+a.title+"', 1, true]);\">"+(parseInt(n)+1)+"</a></div>");videosTeach.numSlide(0),$("#teachVideoPanel .numbox .c_num a").click(function(){$("#teachVideoPanel .numbox .c_num a").removeClass("on"),$(this).addClass("on");var e=$(this).attr("title");videos.player.play($(this).attr("vurl"),e);var t=$(this).attr("id");$("#tvInfoId").attr("tid")!=t&&(indexJS.getArticleInfo(t,function(e){if(e){$("#tvInfoId").attr("tid",e._id);var t=e.detailList[0];common.isBlank(e.mediaImgUrl)?$("#tvInfoId .cpic img").hide():$("#tvInfoId .cpic img").attr("src",e.mediaImgUrl).show(),$("#tvInfoId .introtext p").text(t.remark)}}),indexJS.setListScroll("#teachVideoPanel .scrollbox"),chatAnalyze.setUTM(!1,$.extend({operationType:7,videoId:t,videoName:e},indexJS.userInfo,indexJS.courseTick.course)))}),"function"==typeof t&&t()}}))},playRandomTeach:function(e,t){if($(".tabnav a.teach").is(".on")||$(".tabnav a.teach").trigger("click",[!0]),$("#teachVideoId a.on").size()>0)videosTeach.playRandomTeachFunc(t);else{var i=$("#teachVideoId a"),a=common.randomIndex(i.size());e?i.eq(a).trigger("click",[videosTeach.playRandomTeachFunc,t]):i.eq(a).trigger("click")}},playRandomTeachFunc:function(e){var t=$("#teachVideoPanel .numbox .c_num a");if(t.size()>0)if(t.is("on"))$(this).trigger("click");else{var i=common.randomIndex(t.size()),a=t.eq(i);a.trigger("click")}},playTeachByUrlFunc:function(e){if(e&&e.url){var t=!1;$("#teachVideoPanel .numbox .c_num a").each(function(){var i=$(this).attr("vurl");return i==e.url?($(this).trigger("click"),t=!0,!1):void 0}),t||videos.player.play(e.url,e.title)}},numSlide:function(e){var t=0,i=$($(".teachlive .sub_tab")[e]);$(i).find(".courseNum .inner").stop();var a=$(".courseNum .c_num").width(),s=$(i).find(".courseNum .c_num").size();$(i).find(".courseNum .inner").width(function(){return s*a}).css("left",0),$(i).find(".numctrl.next").unbind("click").click(function(){$(i).find(".courseNum .inner").width()-t*a-$(i).find(".courseNum .numbox").width()>0&&(t++,$(i).find(".courseNum .inner").stop().animate({left:-t*a}))}),$(i).find(".numctrl.prev").unbind("click").click(function(){0!=t&&(t--,$(i).find(".courseNum .inner").stop().animate({left:-t*a}))})}},videosSubscribe={subscribeData:null,init:function(){this.setEvent()},setEvent:function(){$("#subscribe").click(function(){indexJS.userInfo.isLogin?(common.openPopup(".blackbg,.personal_center"),$('#infotab a[t="mySubscribe"]').click()):common.openPopup(".blackbg,.login")})},setSubscribe:function(){common.getJson("/studio/getSubscribe",{params:JSON.stringify({groupType:indexJS.userInfo.groupType})},function(e){null!=e&&(videosSubscribe.subscribeData=e,$.each(e,function(e,t){var i=t.analyst.split(","),a=t.noticeType.split(",");$('input[name="'+t.type+'_analysts"]').val(t.analyst),$('input[name="'+t.type+'_noticeTypes"]').val(t.noticeType),$.each(i,function(e,i){$("#"+i+"_"+t.type).prop("checked",!0)}),$.each(a,function(e,i){$("#"+i+"_"+t.type).prop("checked",!0)});var s=$("#week_"+t.type).parent().parent().parent(),n=$("#month_"+t.type).parent().parent().parent();common.getDateDiff(t.startDate,t.endDate)>7?($("#month_"+t.type).prop("checked",!0),n.children("div.item").hide(),n.children("div.item").hide(),n.children("div.mydytime").html(common.formatterDate(t.startDate,"/")+" <b>至</b> "+common.formatterDate(t.endDate,"/")).removeClass("dn")):($("#week_"+t.type).prop("checked",!0),s.children("div.item").hide(),s.children("div.item").hide(),s.children("div.mydytime").html(common.formatterDate(t.startDate,"/")+" <b>至</b> "+common.formatterDate(t.endDate,"/")).removeClass("dn")),$(".dytable ."+t.type+' a[t="'+t.type+'"]').attr({id:t._id,orip:t.point})}))})},setSubscribeType:function(){common.getJson("/studio/getSubscribeType",{params:JSON.stringify({groupType:indexJS.userInfo.groupType})},function(e){if(null!=e){var t=[],i=videosSubscribe.formatHtml("subscribeType"),a=videosSubscribe.formatHtml("analysts"),s=(videosSubscribe.formatHtml("analyst"),videosSubscribe.formatHtml("noticeTypes")),n=(videosSubscribe.formatHtml("noticeType"),videosSubscribe.formatHtml("noticeCycle")),o=videosSubscribe.formatHtml("subscribeBtn");cls1=cls2="",$.each(e,function(e,r){var l=[],c=[],d=[],u=[],p=JSON.parse(r.analysts);p.length;$.each(p,function(e,t){var i=t.name;t.name.indexOf("(")>-1&&(i=t.name.substring(0,t.name.indexOf("("))),l.push(a.formatStr(t.userId,i,t.point,r.code))});var h=JSON.parse(r.noticeTypes),m=h.length;if($.each(h,function(e,t){0==e&&c.push('<div class="itembox w1">'),c.push(s.formatStr(t.type,t.name,t.point,r.code)),e==m-1&&(c.push("</div>"),u.push(o.formatStr(r.code,r.name,r.analysts,r.noticeTypes,r.noticeCycle)))}),common.isValid(r.noticeCycle)){cls2=" w1";var f=JSON.parse(r.noticeCycle);$.each(f,function(e,t){d.push(n.formatStr(t.cycle,t.name,t.point,r.code))})}t.push(i.formatStr(r.name,l.join(""),c.join(""),d.join(""),u.join(""),cls1,cls2,r.code))}),$(".dytable .tody tbody").html(t.join("")),indexJS.setListScroll($("#dy-scbox")),videosSubscribe.setSubscribeEvent(),videosSubscribe.setSubscribe()}})},setSubscribeEvent:function(){$('.dytable .tody input[type="checkbox"],.dytable .tody input[type="radio"],.dytable .pdbox a').unbind("click"),$('.dytable .tody input[type="checkbox"],.dytable .tody input[type="radio"],.dytable .pdbox a').click(function(){var e=0,t=[],i=[];$('.dytable .tody tr[t="'+$(this).attr("t")+'"] input[t="'+$(this).attr("t")+'"]').each(function(){$(this).is(":checked")&&(e+=parseInt($(this).attr("p")),"analyst"==$(this).attr("name")&&t.push($(this).val()),"noticeType"==$(this).attr("name")&&i.push($(this).val()))}),$('input[name="'+$(this).attr("t")+'_analysts"]').val(t.join(",")),$('input[name="'+$(this).attr("t")+'_noticeTypes"]').val(i.join(",")),$(".dytable ."+$(this).attr("t")+" b").text(e+"分"),$(".dytable ."+$(this).attr("t")+' a[t="'+$(this).attr("t")+'"]').attr("p",e)}),$(".dytable .pdbox a").unbind("click"),$(".dytable .pdbox a").click(function(){var e=$(this);if(e.hasClass("clicked"))return!1;e.addClass("clicked");var t={groupType:indexJS.userInfo.groupType,type:e.attr("t"),point:common.isBlank(e.attr("p"))?0:parseInt(e.attr("p"))};if(t.noticeCycle=common.isBlank($('input[name="noticeCycle_'+e.attr("t")+'"]:checked').val())?"":$('input[name="noticeCycle_'+e.attr("t")+'"]:checked').val(),t.analyst=$('input[name="'+e.attr("t")+'_analysts"]').val(),t.noticeType=common.isBlank($('input[name="'+e.attr("t")+'_noticeTypes"]').val())?e.attr("nts"):$('input[name="'+e.attr("t")+'_noticeTypes"]').val(),t.pointsRemark="订阅"+e.attr("tn"),t.id=common.isBlank(e.attr("id"))?"":e.attr("id"),t.orip=common.isBlank(e.attr("orip"))?0:e.attr("orip"),common.isBlank($("#myEmail").val())&&$.inArray("email",t.noticeType.split(","))>-1)box.showMsg("请先绑定邮箱！"),$('#infotab a[t="accountInfo"]').click();else if(common.isBlank(t.id)&&common.isBlank(t.analyst))box.showMsg("请选择订阅老师！");else if(common.isBlank(t.id)&&common.isBlank(t.noticeType))box.showMsg("请选择订阅方式！");else if(common.isBlank(t.id)&&common.isBlank(t.noticeCycle))box.showMsg("请选择订阅周期！");else{(common.isBlank(t.analyst)||common.isBlank(t.noticeType))&&(t.point=0,t.analyst="",t.noticeType="",t.noticeCycle="");var i=[],a=null;$("#course_panel .main_tab .live_prevlist li").each(function(){var e=$(this).attr("tuid");common.isValid(e)&&(e.indexOf(",")>-1?(a=e.split(","),i=$.merge(i,a)):i.push(e))}),$.unique(i);var s=t.analyst.split(","),n=[],o=!0;if(common.isValid(t.analyst)&&$.each(s,function(t,a){$.inArray(a,i)<0&&n.push($("#"+a+"_"+e.attr("t")).attr("cval"))}),$.each(videosSubscribe.subscribeData,function(i,a){if(e.attr("t")==a.type&&t.analyst==a.analyst&&t.noticeType==a.noticeType){var s=common.getDateDiff(a.startDate,a.endDate)>7?"month":"week";if(t.noticeCycle==s)return o=!1,!1}}),o)if(n.length>0&&$.inArray(e.attr("t"),["live_reminder","shout_single_strategy","trading_strategy"])>-1){var r={title:"温馨提醒",msg:n.join(",")+"老师没有课程安排，确定订阅？",btns:[{txt:"确定",fn:function(){videosSubscribe.saveSubscribe(t,e)}},{txt:"取消",fn:function(){box.hideMsg(),e.removeClass("clicked")}}]};box.showMsg(r)}else videosSubscribe.saveSubscribe(t,e);else box.showMsg("你已订阅相关课程，无需重复订阅！")}})},saveSubscribe:function(e,t){parseInt(e.point)!=parseInt(e.orip)||e.analyst!=t.attr("a")||e.noticeType!=t.attr("t")||e.noticeCycle!=t.attr("c")?common.getJson("/studio/subscribe",{params:JSON.stringify(e)},function(i){i.isOK?(chatShowTrade.getPointsInfo(),common.isBlank(e.analyst)||common.isBlank(e.noticeType)?box.showMsg("取消订阅成功！"):common.isValid(e.id)?box.showMsg("修改订阅成功！"):box.showMsg("订阅成功！"),videosSubscribe.setSubscribeType()):box.showMsg(i.msg),t.removeClass("clicked")}):(box.showMsg("订阅内容无变化！"),t.removeClass("clicked"))},formatHtml:function(e){var t=[];switch(e){case"subscribe":t.push("<tr>"),t.push('    <td><span class="fz12">{0}</span></td>'),t.push('    <td><span class="fz12">{1}</span></td>'),t.push("    <td>{2}</td>"),t.push("    <td>{3}</td>"),t.push("    <td>{4}</td>"),t.push("    <td>{5}</td>"),t.push("</tr>");break;case"subscribeType":t.push('<tr t="{7}">'),t.push("    <td>{0}</td>"),t.push('    <td><div class="itembox{5}">{1}</div><input type="hidden" name="{7}_analysts" /></td>'),t.push('    <td>{2}<input type="hidden" name="{7}_noticeTypes" /></td>'),t.push('    <td><div class="itembox{6}">'),t.push('    <div class="mydytime dn"></div>'),t.push("    {3}</div></td>"),t.push("    <td>{4}</td>"),t.push("</tr>");break;case"analysts":t.push('<div class="item">'),t.push('    <span class="inp_checkbox">'),t.push('        <input type="checkbox" name="analyst" id="{0}_{3}" p="{2}" value="{0}" cval="{1}" t="{3}" />'),t.push('        <label for="{0}_{3}"><i></i></label>'),t.push("    </span>"),t.push('    <span class="tname">{1}</span>'),t.push('    <span class="point">（{2}积分）</span>'),t.push("</div>");break;case"analyst":t.push('<div class="item">'),t.push('    <span class="inp_checkbox">'),t.push('    <input type="checkbox" name="analyst" id="{0}_{3}" value="{0}" p="{2}" cval="{1}" t="{3}" />'),t.push('    <label for="{0}_{3}"><i></i></label>'),t.push("    </span>"),t.push('    <span class="tname">{1}</span>'),t.push("</div>");break;case"noticeTypes":t.push('<div class="item">'),t.push('    <span class="inp_checkbox">'),t.push('        <input type="checkbox" name="noticeType" id="{0}_{3}" value="{0}" p="{2}" cval="{1}" t="{3}" />'),t.push('        <label for="{0}_{3}"><i></i></label>'),t.push("    </span>"),t.push('    <span class="tname">{1}</span>'),t.push('    <span class="point">（{2}积分）</span>'),t.push("</div>");break;case"noticeType":t.push('<div class="pdbox {0}"><a href="javascript:void(0);" class="dybtn" t="{0}" tn="{1}" nts="email"'),t.push(" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'header_dy_{0}', 'content_top', 1, true]);\">"),t.push("邮件订阅</a></div>");break;case"noticeCycle":t.push('<div class="item">'),t.push('    <span class="inp_radio">'),t.push('        <input type="radio" name="noticeCycle_{3}" id="{0}_{3}" value="{0}" p="{2}" cval="{1}" t="{3}" />'),t.push('        <label for="{0}_{3}"><i></i></label>'),t.push("    </span>"),t.push('    <span class="tname">{1}</span>'),t.push('    <span class="point">（{2}积分）</span>'),t.push("</div>");break;case"subscribeBtn":t.push('<div class="pdbox {0}">共计：<b>0分</b><a href="javascript:void(0);" class="dybtn" t="{0}" tn="{1}" a="{2}" t="{3}" c="{4}"'),t.push(" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'header_dy_{0}', 'content_top', 1, true]);\">"),t.push("订阅/结算</a></div>")}return t.join("")}},videosTrain={trainLpUrl:{tonylee:"http://www.24k.hk/lp_v142_lgg.html",tracey_jiang:"http://www.24k.hk/lp_v137_cls.html",joe_chung:"http://www.24k.hk/lp_v154_zwy.html"},init:function(){this.setEvent(),this.getTrainList()},setEvent:function(){$("#trains").click(function(){common.openPopup(".blackbg,.pop_train")})},initTraninNum:function(){$.getJSON("/studio/getTrainRoomNum",{groupType:indexJS.userInfo.groupType},function(e){null!=e&&e.num>0?$("#trainsnum").text(e.num).css("display","inline-block"):$("#trainsnum").hide()})},getTrainList:function(){$.getJSON("/studio/getTrainRoomList",{groupType:indexJS.userInfo.groupType},function(e){if(null!=e){var t=e.length,i=[],a=[],s=videosTrain.formatHtml("train");$.each(e,function(e,n){var o=(common.trim(n.defaultAnalyst.introduction),"报名/详情"),r="traindetails trainbtn",l="已报名"+(n.clientSize||0)+"人",c='onclick="chatTeacher.trainDetails(this);" ',d='href="javascript:void(0);"';n.allowInto?(o="进入",c='onclick="chatTeacher.trainRegis(this);" '):n.isEnd&&(t-=1,o="已结束，精彩回顾",c="",l="&nbsp;",d=common.isBlank(videosTrain.trainLpUrl[n.defaultAnalyst.userNo])?'href="javascript:void(0);"':'href="'+videosTrain.trainLpUrl[n.defaultAnalyst.userNo]+'" target="_blank"'),0==n.status?a.push(s.formatStr(n.defaultAnalyst.avatar,n.name,n.label,n.remark,n.defaultAnalyst.userNo,n.clientGroup,n.allowInto,o,n._id,l,c,r,d)):i.push(s.formatStr(n.defaultAnalyst.avatar,n.name,n.label,n.remark,n.defaultAnalyst.userNo,n.clientGroup,n.allowInto,o,n._id,l,c,r,d))}),i=$.merge(i,a),$(".pop_train .scrollbox .trainlist").html(i.join("")),t>0?$("#trainsnum").text(e.num).css("display","inline-block"):$("#trainsnum").hide()}})},formatHtml:function(e){var t=[];switch(e){case"train":t.push("<li>"),t.push('     <div class="headimg"><img src="{0}" alt=""></div>'),t.push('     <div class="train_name">{1}</div>'),t.push('     <span class="slogan">{2}</span>'),t.push("     <p>{3}</p>"),t.push('     <a {12} class="{11}" userno="{4}" cgs= "{5}" isDetail="true" {10}sp="{6}" rid="{8}">{7}</a>'),t.push('     <span class="bm">{9}</span>'),t.push("</li>")}return t.join("")}},chatPride={classNoteInfo:[],strategyIsNotAuth:0,callTradeIsNotAuth:0,init:function(){this.setTradeStrategyNote(null,!0),this.setEvent()},setEvent:function(){$("#textliveMore").bind("click",function(){if(!$(this).is(".all")){var e=$("#textlivePanel li[aid]:last").attr("aid");chatPride.setTradeStrategyNote(e,!1)}})},setAdvertisement:function(){$(".live_banner").hasClass("loaded")?0==$(".live_banner:first").is(".livebrief_ad")&&$(".live_banner:first").after($(".livebrief_ad")).remove():indexJS.getArticleList("advertisement",indexJS.userInfo.groupId,"0",1,5,'{"sequence":"desc","publishStartDate":"desc"}',null,function(e){if(e&&0==e.result){var t=e.data;$(".ban_ul").empty();var i=[],a=null,s=null,n=null;for(var o in t){if(a=t[o],common.isBlank(a.linkUrl)){switch(a.detailList[0].tag){case"live800":s="javascript:openLive800Chat(null)";break;case"qq":s="javascript:openQQChatByCommonv3('','800018282');";break;default:s="javascript:"}n=""}else s=a.linkUrl,n=' target="_blank"';i.push('<li><a href="'+s+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_zb_banner', '"+a.detailList[0].title+"', 1, true]);\""+n+'><img width="100%" alt="" src="'+a.mediaUrl+'"></a></li>')}$(".ban_ul:first").html(i.join("")).parent().addClass("livebrief_ad"),$(".live_banner").slide({titCell:".num ul",mainCell:".ban_ul",effect:"left",autoPlay:!0,delayTime:300,interTime:4e3,autoPage:!0}),$(".live_banner").addClass("loaded")}})},setTradeStrategyNote:function(e,t){if(!t||!$("#textlivePanel").data("loaded")){t&&($("#textlivePanel").data("loaded",!0),e||(e=$("#textlivePanel li[aid]:last").attr("aid")));var i={type:"prerogative",item:["prerogative_strategy","prerogative_callTrade"]};common.getJson("/studio/getChatPointsConfig",{data:JSON.stringify(i)},function(t){t&&$.each(t,function(e,t){for(var i=t.clientGroup,e=0,a=i?i.length:0;a>e;e++){var s=i[e];s==indexJS.userInfo.clientGroup&&("prerogative_callTrade"==t.item?chatPride.callTradeIsNotAuth=1:"prerogative_strategy"==t.item&&(chatPride.strategyIsNotAuth=1))}});var i=chatPride.getStoreViewData()||[],a={isAll:1,pageKey:e||"",pageLess:1,ids:i.join(","),callTradeIsNotAuth:chatPride.callTradeIsNotAuth,strategyIsNotAuth:chatPride.strategyIsNotAuth};indexJS.getArticleList("class_note",indexJS.userInfo.groupId,1,1,30,'{"publishStartDate":"desc","createDate":"desc"}',a,function(e){if(e&&0==e.result){var t=e.data;for(var i in t)chatPride.appendTradeStrategyNote(t[i],!1,!1,!1);for(var i in chatPride.classNoteInfo)chatPride.appendClassNoteInfo(chatPride.classNoteInfo[i],!1,!1,!1);chatPride.classNoteInfo=[],
t.length<e.pageSize&&$("#textliveMore").addClass("all").html("已加载全部")}chatPride.setAdvertisement(),indexJS.setListScroll($(".tabcont .main_tab .livebrief_list .scrollbox"))})})}},appendTradeStrategyNote:function(e,t,i,a){var s,n,o,r,l=$("#textlivePanel"),c="",d=chatPride.formatHtml("tradeStrategyLiveBrief"),u=chatPride.formatHtml("tradeStrategySupport"),p=chatPride.formatHtml("tag"),h=chatPride.formatHtml("tradeStrategyNoteImg"),m=/<img\s+[^>]*src=['"]([^'"]+)['"][^>]*>/;s=e.detailList&&e.detailList[0];var f=e._id||e.id,g=chatPride.getStoreViewData()||[],v={up:"看涨",down:"看跌"},b="";if(common.isValid(s.tag)&&"trading_strategy"==s.tag){if(n=new Date(e.publishStartDate).getTime(),o=l.find(".livebrief[pt='"+n+"']>div.te_info"),0==o.size()){var y="",w="",x="",_=[],k=[],T="";s.authorInfo&&(y=s.authorInfo.name||"",w=s.authorInfo.avatar||"",T=s.authorInfo.userId||"",_=common.isValid(s.authorInfo.tag)?s.authorInfo.tag.replace(/\s*，\s*/g,",").split(","):[],$.each(_,function(e,t){common.isValid(t)&&k.push(p.formatStr(t))}));var I=common.formatterDateTime(n,"-").substring(0,16)+"-"+common.formatterDateTime(e.publishEndDate,"-").substring(11,16),S=[];if(common.isValid(s.tag)&&"trading_strategy"==s.tag){var C=common.isValid(s.remark)?JSON.parse(s.remark):[];0==C.length&&(b=' style="display:none;"'),indexJS.userInfo.isLogin&&!chatPride.strategyIsNotAuth||$.inArray(f,g)>-1?(x=' style="display:none;"',$.each(C,function(e,t){var i="";common.isBlank(t.description)&&(i=' style="display:none;"'),S.push(u.formatStr(t.name,v[t.upordown],t.open,t.profit,t.loss,t.description,"",i))})):(0==C.length&&(x=' style="display:none;"'),$.each(C,function(e,t){var i="";common.isBlank(t.description)&&(i=' style="display:none;"'),S.push(u.formatStr(t.name,v[t.upordown],"****","****","****","****","dim",i))}))}else x=' style="display:none;"';var P="trading_strategy"==s.tag?s.content:"";if(common.isValid(P))for(r=m.exec(P);r;)P=P.replace(m,h.formatStr(r[1])),r=m.exec(P);if(c=d.formatStr(w,y,I,s.title||"",P,S.join(""),n,x,k.join(""),f,T,b),t){var L=$("#financeDataAndReview");L.size()>0?L.after(c):l.prepend(c)}else l.append(c);l.find(".picpart>.imgbox").each(function(){var e=$(this);e.find("a>img").attr("src",e.attr("url"))})}else if(o.size()>0&&a){var y="",w="",x="",_=[],k=[],T="";s.authorInfo&&(y=s.authorInfo.name||"",w=s.authorInfo.avatar||"",T=s.authorInfo.userId||"",_=common.isValid(s.authorInfo.tag)?s.authorInfo.tag.replace(/\s*，\s*/g,",").split(","):[],$.each(_,function(e,t){k.push(p.formatStr(t))}));var I=common.formatterDateTime(n,"-").substring(0,16)+"-"+common.formatterDateTime(e.publishEndDate,"-").substring(11,16),S=[],C=common.isValid(s.remark)?JSON.parse(s.remark):[];common.isValid(s.tag)&&"trading_strategy"==s.tag&&(indexJS.userInfo.isLogin&&!chatPride.strategyIsNotAuth||$.inArray(f,g)>-1?(x=' style="display:none;"',$.each(C,function(e,t){var i="";common.isBlank(t.description)&&(i=' style="display:none;"'),S.push(u.formatStr(t.name,v[t.upordown],t.open,t.profit,t.loss,t.description,"",i))})):(0==C.length&&(x=' style="display:none;"'),$.each(C,function(e,t){var i="";common.isBlank(t.description)&&(i=' style="display:none;"'),S.push(u.formatStr(t.name,v[t.upordown],"****","****","****","****","dim",i))})));var P="trading_strategy"==s.tag?s.content:"";if(common.isValid(P))for(r=m.exec(P);r;)P=P.replace(m,h.formatStr(r[1])),r=m.exec(P);o=l.find(".livebrief[_aid='"+f+"']"),o.find("div.te_info").attr("tid",T),o.find("div.te_info>div.himg>img").attr("src",w),o.find("div.te_info>div.teinfo1>span.te_name").text(y),o.find("div.te_info>div.teinfo1>span.livetime").text(I),o.find("div.te_info>div.teinfo1>span.brieftit").text(s.title||""),o.find("div.te_info>div.teinfo>div.taglist").html(k.join("")),o.find("div.hdbox>div.skill").html('<span><i class="dot"></i>当前交易策略：</span>'+P),o.find("div.hdbox>div.hdbox2").remove(),o.find("div.hdbox>div.skill").after(S.join("")),0==C.length&&o.find("div.hdbox>a.show-ctrl").hide()}}else chatPride.classNoteInfo.push(e);var J=$("#livePrideCount");if(i)if(J.parent().parent().parent().parent().is(".on"))J.data("cnt",0).html("").hide();else{var D=(J.data("cnt")||0)+1;J.data("cnt",D).html(D).css("display","inline-block")}else J.data("cnt",0).html("").hide();$(".show-ctrl").unbind("click"),$(".hdbox .show-ctrl").click(function(){$(this).parent().find(".showpart").hasClass("cut")?($(this).parent().find(".showpart").removeClass("cut"),$(this).text("收起")):($(this).parent().find(".showpart").addClass("cut"),$(this).text("点击展开"))}),$(".viewdata").unbind("click"),$(".viewdata").click(function(){indexJS.userInfo.isLogin?chatPride.viewData($(this)):$("#login_a").click()});var N=$(".livebrief[_aid="+f+"] .hdbox");N.find(".hdbox2").size()>=2||N.find(".hdbox2").height()>=55||N.find(".skill").height()>=55?N.find(".show-ctrl").show():N.find(".show-ctrl").hide()},appendClassNoteInfo:function(e,t,i,a){var s,n,o,r,l,c,d=$("#textlivePanel"),u=chatPride.formatHtml("tradeStrategyNote"),p=chatPride.formatHtml("tradeStrategyHd"),h=chatPride.formatHtml("tradeStrategyHdDetail"),m=(chatPride.formatHtml("tradeStrategyNoteDetail"),chatPride.formatHtml("tradeStrategyNoteImg")),f=/<img\s+[^>]*src=['"]([^'"]+)['"][^>]*>/,g={up:"看涨",down:"看跌"};s=e.detailList&&e.detailList[0],n=new Date(e.publishStartDate).getTime();var v=e._id||e.id,b=chatPride.getStoreViewData()||[];if(a&&d.find("li[aid='"+v+"']").remove(),!(d.find("li[aid='"+v+"']").size()>0)){var y="";for(s.authorInfo&&(y=s.authorInfo.name.substring(0,1)||""),o=s.content,c=f.exec(o);c;)o=o.replace(f,m.formatStr(c[1])),c=f.exec(o);if(common.isValid(s.tag)&&common.isValid(s.remark)&&("shout_single"==s.tag||"resting_order"==s.tag)){var w=[],x=JSON.parse(s.remark),_="";indexJS.userInfo.isLogin&&!chatPride.callTradeIsNotAuth||$.inArray(v,b)>-1?(_=' style="display:none;"',$.each(x,function(e,t){var i="";common.isBlank(t.description)&&(i=' style="display:none;"'),w.push(h.formatStr(t.name,g[t.upordown],t.open,t.profit,t.loss,t.description,"",i))})):$.each(x,function(e,t){var i="";common.isBlank(t.description)&&(i=' style="display:none;"'),w.push(h.formatStr(t.name,g[t.upordown],"***","***","***","***","dim",i))});var k=s.content||"";for(c=f.exec(k);c;)k=o.replace(f,m.formatStr(c[1])),c=f.exec(k);var T="喊单",I="prerogative_callTrade";"resting_order"==s.tag&&(T="挂单",I="prerogative_callTrade"),o=p.formatStr(k,w.join(""),_,v,y,T,I)}if(l=common.formatterDateTime(e.createDate,"-").substring(11),"trading_strategy"!=s.tag){r=$(u.formatStr(l,o,v)),r.find(".imgbox").each(function(){$(this).find("img").attr("src",$(this).attr("url"))}),t?d.find(".livebrief[pt='"+n+"']>div.brieflist ul").prepend(r):d.find(".livebrief[pt='"+n+"']>div.brieflist ul").append(r);var S=$("#livePrideCount");if(i)if(S.parent().parent().parent().parent().is(".on"))S.data("cnt",0).html("").hide();else{var C=(S.data("cnt")||0)+1;S.data("cnt",C).html(C).show()}else S.data("cnt",0).html("").hide();$(".viewdata2").unbind("click"),$(".viewdata2").click(function(){indexJS.userInfo.isLogin?chatPride.viewData($(this)):$("#login_a").click()})}}},pushShoutSingleInfo:function(e){var t=chatPride.formatHtml("pushShortSingle"),i=e.detailList&&e.detailList[0],a=e._id||e.id,s=null;if(common.isValid(i.tag)&&common.isValid(i.remark)&&("shout_single"==i.tag||"resting_order"==i.tag)){var n="老师喊单啦";"resting_order"==i.tag&&(n="老师挂单啦"),s=common.isBlank(i.content)?(i.authorInfo.userName||"")+n:i.content.replace("<p>","").replace("</p>",""),$("#chatMsgContentDiv .dialoglist").append(t.formatStr(s,a)),chat.showSystemTopInfo("class_note",a,s),$("#chatMsgContentDiv .dialoglist .pushclose").unbind("click"),$("#chatMsgContentDiv .dialoglist .pushclose").click(function(){$(this).parent().hide()}),$("#chatMsgContentDiv .dialoglist .shoutsingle").unbind("click"),$("#chatMsgContentDiv .dialoglist .shoutsingle").click(function(){chatPride.gotoLook($(this).attr("_id"))})}},gotoLook:function(e){$('.main_tabnav a[t="livepride"]').click(),common.isValid(e)&&indexJS.setListScroll($(".tabcont .main_tab .livebrief_list .scrollbox"),$('.livebrief_list .livebrief .brieflist ul li[aid="'+e+'"]').offset().top)},getStoreViewData:function(){return store.enabled?store.get("point_"+indexJS.userInfo.userId):void console.log("Local storage is not supported by your browser.")},viewData:function(e){var t=chatPride.getStoreViewData()||[],i={groupType:indexJS.userInfo.groupType,item:e.attr("item"),tag:"viewdata_"+e.attr("_id")};common.getJson("/studio/addPointsInfo",{params:JSON.stringify(i)},function(i){i.isOK?indexJS.getArticleInfo(e.attr("_id"),function(a){a&&(common.isValid(i.msg)&&"number"==typeof i.msg.change&&box.showMsg("消费"+Math.abs(i.msg.change)+"积分"),chatPride.setViewDataHtml(e,a),$.inArray(e.attr("_id"),t)<0&&t.push(e.attr("_id")),store.set("point_"+indexJS.userInfo.userId,t))}):box.showMsg(i.msg)})},setViewDataHtml:function(e,t){var i={up:"看涨",down:"看跌"},a=t.detailList&&t.detailList[0],s=JSON.parse(a.remark),n=[],o=[],r=chatPride.formatHtml("tradeStrategyHdDetail");if("shout_single"==a.tag||"resting_order"==a.tag)$.each(s,function(e,t){var a="";common.isBlank(t.description)&&(a=' style="display:none;"'),n.push(r.formatStr(t.name,i[t.upordown],t.open,t.profit,t.loss,t.description,"",a))}),e.parent().children("table").remove(),e.after(n.join("")),e.hide();else if("trading_strategy"==a.tag){var l=chatPride.formatHtml("tradeStrategySupport");chatPride.formatHtml("tradeStrategySupportDiv");$.each(s,function(e,t){var a="";common.isBlank(t.description)&&(a=' style="display:none;"'),o.push(l.formatStr(t.name,i[t.upordown],t.open,t.profit,t.loss,t.description,"",a))});var c=e.parent("div.hdbox").children("div.showpart").children("div.hdbox2");c.children("table").remove(),c.html(o.join(""))}},formatHtml:function(e){var t=[];switch(e){case"tradeStrategyLiveBrief":t.push('<div class="livebrief" pt="{6}" _aid="{9}">'),t.push('    <div class="te_info" tid="{10}">'),t.push('        <div class="himg"><img src="{0}" alt="" width="120" height="120"></div>'),t.push('        <div class="teinfo1">'),t.push('            <span class="te_name">{1}</span>'),t.push('            <span class="livetime">{2}</span>'),t.push("        </div>"),t.push('        <span class="brieftit">{3}</span>'),t.push('        <div class="taglist">'),t.push("            {8}"),t.push("        </div>"),t.push("    </div>"),t.push('    <div class="hdbox">'),t.push('        <div class="showpart cut">'),t.push('            <div class="skill">'),t.push('                <span><i class="dot"></i>当前交易策略：</span>'),t.push("                <p>{4}</p>"),t.push("            </div>"),t.push("                    {5}"),t.push('            <div class="scbox-shadow"></div>'),t.push("        </div>"),t.push('        <a href="javascript:void(0);" class="show-ctrl"{11}>点击展开</a>'),t.push('        <a href="javascript:void(0);" class="viewdata"{7} _id="{9}" item="prerogative_strategy" onclick="_gaq.push([\'_trackEvent\', \'pmchat_studio\', \'right_zb_cl_ChaKanShuJu\', \'content_right\', 1, true]);">查看数据</a>'),t.push('        <i class="hdbox-i"></i>'),t.push("    </div>"),t.push('    <div class="live_banner">'),t.push('        <ul class="ban_ul"></ul>'),t.push('        <div class="num">'),t.push("            <ul></ul>"),t.push("        </div>"),t.push("    </div>"),t.push('    <div class="brieflist">'),t.push("        <ul></ul>"),t.push("    </div>"),t.push("</div>");break;case"tradeStrategySupport":t.push('<div class="hdbox2 clearfix">'),t.push('    <table width="100%" border="0" cellspacing="0" cellpadding="0">'),t.push("        <tr>"),t.push("            <th>品种</th>"),t.push('            <th width="21%">方向</th>'),t.push('            <th width="21%">进场点位</th>'),t.push('            <th width="21%">止盈</th>'),t.push('            <th width="21%">止损</th>'),t.push("        </tr>"),t.push("        <tr>"),t.push("            <td>{0}</td>"),t.push("            <td>{1}</td>"),t.push('            <td><span class="{6}">{2}</span></td>'),t.push('            <td><span class="{6}">{3}</span></td>'),t.push('            <td><span class="{6}">{4}</span></td>'),t.push("        </tr>"),t.push("        <tr{7}>"),t.push('            <td colspan="5" class="explain">说明：<span class="{6}">{5}</span></td>'),t.push("        </tr>"),t.push("    </table>"),t.push("</div>");break;case"tradeStrategySupportDiv":break;case"tradeStrategyNote":t.push('<li aid="{2}">'),t.push('    <i class="dot"></i>'),t.push('    <span class="ltime">{0}</span>'),t.push('    <div class="textcont">'),t.push("    {1}"),t.push("    </div>"),t.push("</li>");break;case"tradeStrategyHd":t.push("{0}"),t.push('<div class="hdbox2 clearfix">'),t.push('    <span class="hdtit">【{5}】{4}老师{5}了，快来围观！</span>'),t.push('    <a href="javascript:void(0);" class="viewdata2"{2} _id="{3}" item="{6}" onclick="_gaq.push([\'_trackEvent\', \'pmchat_studio\', \'right_zb_hd_ChaKanShuJu\', \'content_right\', 1, true]);">查看数据</a>'),t.push("            {1}"),t.push("</div>");break;case"tradeStrategyHdDetail":t.push('<table width="100%" border="0" cellspacing="0" cellpadding="0">'),t.push("    <tbody>"),t.push("        <tr>"),t.push("            <th>品种</th>"),t.push('            <th width="21%">方向</th>'),t.push('            <th width="21%">进场点位</th>'),t.push('            <th width="21%">止盈</th>'),t.push('            <th width="21%">止损</th>'),t.push("        </tr>"),t.push("        <tr>"),t.push("            <td>{0}</td>"),t.push("            <td>{1}</td>"),t.push('            <td><span class="{6}">{2}</span></td>'),t.push('            <td><span class="{6}">{3}</span></td>'),t.push('            <td><span class="{6}">{4}</span></td>'),t.push("        </tr>"),t.push("        <tr{7}>"),t.push('            <td colspan="5" class="explain">说明：<span class="{6}">{5}</span></td>'),t.push("        </tr>"),t.push("    </tbody>"),t.push("</table>");break;case"tradeStrategyNoteDetail":t.push('<div class="textcont">{0}</div>');break;case"tradeStrategyNoteImg":t.push('<div class="picpart">'),t.push('    <div class="imgbox" url="{0}">'),t.push("        <a href=\"{0}\" data-lightbox=\"liveinfo-img\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_zb_ChaKanTu', 'content_right', 1, true]);\"><i></i><img alt=\"\" /></a>"),t.push("    </div>"),t.push("</div>");break;case"tag":t.push('<a href="javascript:void(0);" class="tag"><span>{0}</span><i></i></a>');break;case"pushShortSingle":t.push('<div class="info_push">'),t.push('    <div class="pushcont">系统：{0}</div>'),t.push("    <a href=\"javascript:void(0);\" class=\"detailbtn shoutsingle\" _id=\"{1}\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_lts_QuKankan', 'content_right', 1, true]);\">去看看</a>"),t.push('    <a href="javascript:void(0);" class="pushclose"><i></i></a>'),t.push("</div>")}return t.join("")}},chat={socket:null,msgPushObj:{pbInfos:[],whInfos:[],whInfo:{}},whTipInterId:null,pushInfoTimeOutId:null,initUserList:!1,userList:{},msgType:{text:"text",img:"img",file:"file"},init:function(){this.setEvent(),this.getCSList(),this.setSocket(),this.setTalkListScroll(!0)},setEvent:function(){(indexJS.visitorSpeak||!indexJS.checkClientGroup("visitor"))&&$("#msgFaceBtn").qqFace({id:"faceId",assign:"contentText",path:indexJS.filePath+"/face/"}),$(document).click(function(e){$("div[id^=faceId]").hide(),$(e.target).hasClass("headimg")||$(e.target).parents().hasClass("headimg")||"header"==$(e.target).parent().attr("t")||$(e.target).hasClass("uname")||$(e.target).parents().hasClass("te_ul")||$(".dialogbtn").hide()}),$(".clearbtn").click(function(){$("#dialog_list").html(""),chat.setTalkListScroll()}),$("#scrollbtn").click(function(){$(this).hasClass("on")?$(this).removeClass("on"):($(this).addClass("on"),chat.setTalkListScroll(!0))}),$(".view_select").hover(function(){$(this).addClass("dw")},function(){$(this).removeClass("dw")}).find(".selectlist a").click(function(){$(this).is(".on")||($(".view_select .selectlist a").removeClass("on"),$(".view_select .selected").text($(this).text()),$(this).addClass("on"),chat.showViewSelect($(this).attr("t")),chat.setTalkListScroll(!0))}),$("#contentText").pastableTextarea().on("pasteImage",function(e,t){var i=$(this).find(".text-min-img");i.length>0?(i.attr("href",t.dataURL),i.find("img").attr("src",t.dataURL)):($(this).append('<a class="text-min-img" href="'+t.dataURL+'" data-lightbox="send-img"><img src="'+t.dataURL+'"/></a>'),$(this).focusEnd())}).keydown(function(e){var t=$(this).html();if(13==e.keyCode)return common.isValid(t)&&($(this).html(t.replace(/<div>|<\/div>/g,"")),$(".ui-autocomplete").is(":hidden")&&$("#sendBtn").click()),!1;if(8==e.keyCode){var i=$(this).find(".txt_dia");if($.trim($(this).text())==i.text())return i.remove(),$(this).html(""),!0}}).autocomplete({source:function(e,t){/^@.*$/g.test(e.term)&&(t(chat.searchUserList(e.term.substring(1,e.term.length))),$(".ui-autocomplete").css("z-index","10000000"))},delay:500,minLength:2,position:{my:"left bottom",at:"left top"},select:function(e,t){return $("#contentText").html("").append('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+t.item.value+'" utype="'+t.item.userType+'">@<label>'+t.item.label+"</label></span>&nbsp;").focusEnd(),!1}}).autocomplete("instance")._renderItem=function(e,t){return $("<li>").attr("data-value",t.label).append("<a>"+t.label+"</a>").appendTo(e)},$("#sendBtn").click(function(){if(!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor"))return void box.openLgBox();if(indexJS.userInfo.isSetName===!1)return $("#personal_center").trigger("click",[!0]),$("#modifyNk").click(),void $("#myNickName").focus();indexJS.userInfo.isLogin&&common.isBlank($(".personal_center .levelbar .le_detail").attr("sendget"))&&chatShowTrade.getPointsInfo(!0);var e=chat.getToUser(),t=$("#contentText .text-min-img img");if(t.size()>0){var i=t.attr("src");if(i.length>1048576)alert("发送的图片大小不要超过1MB.");else{chat.setUploadImg(i,e),t.remove();var a=$(".replybtn");e&&e.userId==a.attr("uid")&&e.talkStyle==a.attr("ts")&&($('.mymsg div[uid="'+e.userId+'"]').remove(),0==$("#myMsgListContent .mymsg_list").length?$(".mymsg,.mymsg em").hide():$("#myMsgListContent .mymsg_list").length<2&&$(".mymsg").height(27))}}var s=chat.getSendMsg();if(s!==!1){var n={uiId:chat.getUiId(),fromUser:indexJS.userInfo,content:{msgType:chat.msgType.text,value:s}},a=$(".replybtn");e&&e.userId==a.attr("uid")&&e.talkStyle==a.attr("ts")&&($('.mymsg div[uid="'+e.userId+'"]').remove(),0==$("#myMsgListContent .mymsg_list").length?$(".mymsg,.mymsg em").hide():$("#myMsgListContent .mymsg_list").length<2&&$(".mymsg").height(27)),n.fromUser.pointsGlobal=parseInt($(".personal_center .levelbar .le_detail").attr("pg")),n.fromUser.toUser=e,chat.socket.emit("sendMsg",n),chat.setContent(n,!0,!1),$("#contentText").html(""),chatAnalyze.setUTM(!1,$.extend({operationType:2},indexJS.userInfo,indexJS.courseTick.course))}}),$("#sendImgBtn").click(function(){return FileReader?!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor")?void box.openLgBox():indexJS.userInfo.isSetName===!1?($("#personal_center").click(),$("#modifyNk").click(),$(".nickNameTip").removeClass("dn").css("color","red"),void $("#myNickName").focus()):void $("#sendImgInp").trigger("click"):void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$("#sendImgInp").bind("change",function(){var e=this,t=e.files[0];if(!t)return!1;if(0!=t.type.indexOf("image")||!t.type||!/\.(?:jpg|png|gif)$/.test(t.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=t.size;if(i>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var a=new FileReader;a.readAsDataURL(t),a.onload=function(e){chat.setUploadImg(e.target.result,chat.getToUser())},a.onprogress=function(e){},a.onloadend=function(e){},$(this).val("")}),$(".pletter_win").css({top:$(window).height()/2-218,left:$(window).width()/2-310}).draggable({handle:".titonline",cursor:"move",containment:"document",scroll:!1}),$(".signinbtn").click(function(){common.getJson("/studio/addSignin",null,function(e){e.isOK?(box.showMsg("签到成功!"),$(".signinbox .progressbar").trigger("signin",e.signDays)):box.showMsg(e.msg)})}),$("#chatPrideSystemTopInfo .detailbtn").bind("click",function(){$("#chatPrideSystemTopInfo").fadeOut();var e=$("#chatPrideSystemTopInfo").data("data");if(e)switch(e.type){case"class_note":chatPride.gotoLook(e.id);break;case"showTrade":chatShowTrade.gotoLook(e.id)}}),$("#chatPrideSystemTopInfo .pushclose").bind("click",function(){$("#chatPrideSystemTopInfo").fadeOut()})},setUploadImg:function(e,t){var i=chat.getUiId(),a={};common.copyObject(a,indexJS.userInfo,!0),a.toUser=t;var s={uiId:i,fromUser:a,content:{msgType:this.msgType.img,value:"",needMax:0,maxValue:""}};t&&1==t.talkStyle?this.setWhContent(s,!0,!1):this.setContent(s,!0,!1),s.content.value=e,this.zipImg(s,100,60,function(e,t){if(e.error)return alert(e.error),$("#"+i).remove(),!1;var a=$("#"+e.uiId+" span[contt='a'] a");a.attr("href",t).children("img").attr("src",t).attr("needMax",e.content.needMax),chat.dataUpload(e)})},zipImg:function(e,t,i,a){var s=new Image;s.onload=function(){var n=document.createElement("canvas");n||a({error:"发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！"});var o=s.width,r=s.height;if(r>=9*o)return a({error:"该图片高度太高，暂不支持发送！"}),!1;t>0&&(r>t||o>t)&&(e.content.needMax=1,r>t&&t>=o?(o=t/r*o,r=t):(r=t/o*r,o=t),s.height=r,s.width=o);var l=n.getContext("2d");n.width=o,n.height=r,l.clearRect(0,0,n.width,n.height),l.drawImage(s,0,0,o,r),a(e,n.toDataURL("image/jpeg",i/100))},s.src=e.content.value},dataUpload:function(e){var t=new XMLHttpRequest;t.open("POST","/studio/uploadData"),t.addEventListener("progress",function(t){if(t.lengthComputable){var i=(t.loaded/t.total*100|0)+"%";$("#"+e.uiId+" .shadow-box").css({height:"'+ra+'"}),$("#"+e.uiId+" .shadow-conut").html(i)}},!1),t.setRequestHeader("Content-Type","application/json; charset=utf-8"),t.onreadystatechange=function(){4===t.readyState&&200===t.status&&console.log("dataUpload success!")},e.fromUser.socketId=this.socket.id,t.send(JSON.stringify(e))},removeLoadDom:function(e){$("#"+e+" .img-loading,#"+e+" .img-load-gan,#"+e+" .shadow-box,#"+e+" .shadow-conut").remove()},getCSList:function(){var e=LoginAuto.sessionUser.groupType,t=LoginAuto.sessionUser.groupId;try{$.getJSON("/"+e+"/getCS",{groupId:t},function(e){if(e&&e.length>0){var t=null;for(var i in e)t=e[i],t.nickname=t.userName,t.userId=t.userNo,t.sequence=3,t.userType=3,t.isFromAjax=!0,0==$(".mult_dialog a[uid="+t.userId+"]").length&&chat.setWhVisitors("",t.userType,t.userId,t.nickname,t.avatar,!0,!1);$(".mod_infotab .tabnav .myaid").removeClass("nocs"),$(".mult_dialog a[uid] .num").hide(),$(".mult_dialog a[uid]:first").click()}else $(".mod_infotab .tabnav .myaid").addClass("nocs")})}catch(i){console.error("getCSList->"+i),callback(null)}},getSendImgInfo:function(){var e=$("#contentText .text-min-img");return e.length>0?{userId:e.attr("uid"),nickname:e.find("label").text(),talkStyle:0,userType:e.attr("utype")}:null},getUiId:function(){var e=new Date;return e.getTime()+"_ms"},getToUser:function(){var e=$("#contentText .txt_dia");return e.length>0?{userId:e.attr("uid"),nickname:e.find("label").text(),talkStyle:0,userType:e.attr("utype")}:null},getSendMsg:function(e){var e=e?e:$("#contentText");if(e.text().length+e.find("img").size()>140)return alert("消息内容超过最大长度限制（140字以内）！"),!1;e.find(".txt_dia").length>0&&e.find(".txt_dia").remove();var t=common.clearMsgHtml(e.html());return common.isBlank(t)?(e.html(""),!1):t},setDialog:function(e,t,i,a,s){if(console.log(e),1==i)"vip"==$("#roomInfoId").attr("rt")?indexJS.connectOnlineCs():(chat.closeWhTip(e),chat.fillWhBox(null,s,a,e,t,!1,!1));else{if(!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor"))return void box.openLgBox();$("#contentText .txt_dia").remove(),$("#contentText").html($("#contentText").html().replace(/^((&nbsp;)+)/g,"")),$("#contentText").prepend('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+e+'" utype="'+a+'">@<label>'+t+"</label></span>&nbsp;").focusEnd()}},showViewSelect:function(e){"analyst"==e?($("#dialog_list").children("[utype!=2]").hide(),$("#dialog_list").children("[utype=2]").show()):"mine"==e?($("#dialog_list").children("[isme='true']").show(),$("#dialog_list").children("[isme='false']").hide()):"admin"==e?$("#dialog_list").children("[utype!=1]").hide():$("#dialog_list").children().show()},setCookies:function(e){var t=chat.setExpiryTime("h12"),i=new Date;i.setTime(i.getTime()+1*t);var a=document.cookie.split(e+"=");if(2==a.length){var s=a[1].split(";")[0];return s++,document.cookie=e+"="+s+";expires="+i.toGMTString(),s}return document.cookie=e+"=1;expires="+i.toGMTString(),1},getCooikes:function(e){var t=chat.setExpiryTime("h12"),i=new Date;i.setTime(i.getTime()+1*t);var a=document.cookie.split(e+"=");if(2==a.length){var s=a[1].split(";")[0];return s}return 0},setExpiryTime:function(e){var t=1*e.substring(1,e.length),i=e.substring(0,1);return"s"==i?1e3*t:"h"==i?60*t*60*1e3:"d"==i?24*t*60*60*1e3:void 0},setContent:function(e,t,i){var a=e.fromUser;if(t&&(a.publishTime=e.uiId),e.isVisitor)return $("#"+e.uiId).remove(),void box.openLgBox();if(i&&$("#"+a.publishTime).length>0)return $("#"+a.publishTime+" span[contt] em[class=ruleTipStyle]").remove(),void $("#"+a.publishTime+" input").remove();if(e.rule){if(e.value&&e.value.needApproval?$("#"+e.uiId).attr("id",a.publishTime):$("#"+e.uiId+' span[contt="a"]').append('<em class="ruleTipStyle">'+e.value.tip+"</em>"),e.value&&"userGag"==e.value.type){var s=chat.getCooikes("userGag");null!=s&&""!=s&&s>0||(chat.setCookies("userGag"),common.openPopup(".blackbg,.silent_tip"))}}else if(t||indexJS.userInfo.userId!=a.userId||!e.serverSuccess){var n=chat.formatContentHtml(e,t,i),o=$("#dialog_list");o.append(n),this.formatMsgToLink(a.publishTime);var r=$(".view_select .selectlist a[class=on]").attr("t");if("all"!=r&&chat.showViewSelect(r),!i){var l=$("#userListId li[id="+a.userId+"]"),c=null;a.avatar&&l.length>0&&a.avatar!=(c=l.find(".headimg img")).attr("src")&&c.attr("src",a.avatar),$("#scrollbtn").hasClass("on")&&chat.setTalkListScroll(!0),chat.showChatMsgNumTip(!1)}$("#"+a.publishTime+" .headimg").click(function(){chat.openDiaLog($("#"+a.publishTime+" .dialogbtn").attr("avs",$(this).find("img").attr("src")))}),$("#"+a.publishTime+" .txt_dia").click(function(){(indexJS.visitorSpeak||!indexJS.checkClientGroup("visitor"))&&chat.setDialog($(this).attr("uid"),$(this).find("label").text(),0,$(this).attr("utype"))}),$("#"+a.publishTime+" .uname").click(function(){var e=$("#"+a.publishTime+" .dialogbtn");e.attr("avs",$(this).parent().parent().find(".headimg img").attr("src")),chat.openDiaLog(e)})}else if($("#"+e.uiId+" .dtime").html(chat.formatPublishTime(a.publishTime)),$("#"+e.uiId).attr("id",a.publishTime),e.content.msgType==chat.msgType.img){chat.removeLoadDom(a.publishTime);var d=$("#"+a.publishTime+' span[contt="a"]>a'),u=e.content.needMax?"/studio/getBigImg?publishTime="+a.publishTime+"&userId="+a.userId:d.children("img").attr("src");d.attr("href",u)}},showChatMsgNumTip:function(e){var t=$("#chatMsgCount");if(e)t.data("cnt",0).html("").hide();else if(!t.parent().parent().parent().parent().is(".on")){var i=(t.data("cnt")||0)+1;t.data("cnt",i).html(i).css("display","inline-block")}},openDiaLog:function(e){if($(".dialogbtn").not(e).hide(),!e.is(":hidden"))return e.hide(),!1;var t=e.parent(),i=e.is(".bot");t.next().size()<=0?i||e.addClass("bot"):i&&e.removeClass("bot"),e.show();var a=e.find("a"),s=e.attr("avs");common.isValid(s)?(a.attr("avs",s),e.attr("avs","")):a.attr("avs",""),a.unbind("click"),a.click(function(){var e=$(this).parent();chat.setDialog(e.attr("uid"),e.attr("nk"),$(this).attr("t"),e.attr("utype"),$(this).attr("avs")),e.hide()})},formatPublishTime:function(e,t,i){var a=Number(e.replace(/_.+/g,""));return common.isBlank(e)?"":t?common.formatterDateTime(a,i):common.getHHMM(a)},formatContentHtml:function(e,t,i){var a="dialog ",s="",n="",o="false",r="",l=e.fromUser,c=e.content,d=l.nickname,u="";indexJS.userInfo.userId==l.userId&&t&&(l.publishTime=e.uiId,u='<em class="img-loading"></em><span class="shadow-box"></span><s class="shadow-conut"></s>');var p=l.toUser,h="";if(p&&common.isValid(p.userId)&&(h='<span class="txt_dia" uid="'+p.userId+'" utype="'+p.userType+'">@<label>'+p.nickname+"</label></span>",indexJS.userInfo.userId==p.userId&&(o="true")),c.msgType==chat.msgType.img?(s=c.needMax?'<a href="/studio/getBigImg?publishTime='+l.publishTime+"&userId="+l.userId+'" data-lightbox="dialog-img"><img src="'+c.value+'" alt="图片"/></a>':'<a href="'+(c.value?c.value:"javascript:void(0);")+'" data-lightbox="dialog-img"><img src="'+c.value+'" alt="图片" /></a>',s+=u):s=c.value,indexJS.userInfo.userId==l.userId)a+="mine ",o="true",r='<a href="javascript:" class="uname">我</a><span class="ctime">'+chat.formatPublishTime(l.publishTime)+"</span>";else{if(3==l.userType&&(d+="&nbsp;（助理）"),$.inArray(l.userType,[0])>-1&&!isNaN(l.pointsGlobal)){for(var m={},f=indexJS.pointLevel.length-1;f>=0;f--){var g=indexJS.pointLevel[f];if(l.pointsGlobal>=g.points){m=g;break}}r='<span class="level">'+m.name+"</span>"}if(r+='<a href="javascript:void(0);" class="uname">'+d+'</a><span class="ctime">'+chat.formatPublishTime(l.publishTime)+"</span>",n=chat.getDialogHtml(l.userId,d,l.userType),!i&&p&&indexJS.userInfo.userId==p.userId){$(".mymsg").show(),$(".mymsg em").hide();var v=[];v.push('<div class="mymsg_list" uid="'+l.userId+'">'),v.push('    <p><span class="sender">'+l.nickname+'</span>对你说：<span class="xcont">'+s+"</span></p>"),v.push('    <a href="javascript:void(0);" class="replybtn" uid="'+l.userId+'" ts="'+p.talkStyle+'" futype="'+l.userType+'">回复</a>'),v.push('    <a href="javascript:void(0);" class="pop_close mymsg_close"><i>关闭</i></a>'),v.push("</div>"),$("#myMsgListContent").append(v.join("")),$("#myMsgListContent .mymsg_list").length>1?($(".mymsg").height(58),indexJS.setListScroll($(".mymsg"))):$(".mymsg").height(27),chat.replyEvent($(".mymsg .mymsg_list .replybtn"),$(".mymsg .mymsg_list .mymsg_close"))}}var b=chat.getAImgOrLevel(l.userId,l.clientGroup,l.userType,l.avatar),y=[];return y.push('<div class="'+a+b.level+'" id="'+l.publishTime+'"  utype="'+l.userType+'" mtype="'+c.msgType+'" isme="'+o+'">'),y.push('<div class="headimg">'),y.push('<a href="javascript:void(0);">'+b.aImg+"</a>"),y.push("</div>"),y.push('<div class="infobar">'+r+"</div>"),y.push('<div class="bubble"><i></i>'),p&&common.isValid(p.question)?(y.push('<div class="dcont">'),y.push('<div class="question"><span uid="'+p.userId+'" utype="'+p.userType+'">'+p.nickname+"</span>提问："),y.push('<span class="q">'+p.question+"</span></div>"),y.push('<div class="reply"><span>回复：</span><span contt="a">'+s+"</span></div>"),y.push("</div>")):y.push('<div class="dcont"><span contt="a">'+h+s+"</span></div>"),y.push(n+"</div>"),y.join("")},formatMsgToLink:function(e){$("#"+e+' span[contt]:contains("http:"),#'+e+' span[contt]:contains("https:")').each(function(e,t){var i=$(t).html(),a=i.split(/<img[^>]*>|<a[^>]*>.*?<\/a>/g),s="";for(var n in a)if(s=a[n],!common.isBlank(s)){var o=s.replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\\&|-)+)(:\d+)?(\/|\S)+/g,function(e){return'<a href="'+e+"\" target=\"_blank\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'left_lj_zhuli', '$(this).text()', 1, true]);\">"+e+"</a>"});t.innerHTML=t.innerHTML.replace(s,o)}})},removeLoadDom:function(e){$("#"+e+" .img-loading,#"+e+" .img-load-gan,#"+e+" .shadow-box,#"+e+" .shadow-conut").remove()},userGagON:function(e){$("."+e).hide(),$(".blackbg").hide()},getAImgOrLevel:function(e,t,i,a){var s={aImg:common.isValid(a)?'<img src="'+a+'">':'<img src="/pm/theme1/img/user.png">',level:""};if(common.isValid(i)&&i>0)s.level=2==i?"analyst":"admin";else if("vip"==t)s.level="level4";else if("active"==t||"notActive"==t)s.level="level3";else if("simulate"==t)s.level="level2";else if("register"==t)s.level="level1";else if("visitor"==t||-1==i){e=e||"";var n=parseInt(e.substring(e.length-2),10);isNaN(n)&&(n=100),n=(n+17)%40,s.aImg='<img src="'+indexJS.filePath+"/upload/pic/header/chat/visitor/"+n+'.png">',s.level="visitor"}else s.level="visitor";return s},getDialogHtml:function(e,t,i){if(e&&indexJS.userInfo.userId!=e){
var a=$("#roomInfoId"),s="",n=0;return(indexJS.visitorSpeak||-1==indexJS.userInfo.userId.indexOf("visitor_")&&-1==e.indexOf("visitor_"))&&(s+='<a href="javascript:void(0);" class="d1" t="0"><b></b><span>@TA</span></a>',n++),"true"==a.attr("aw")&&common.containSplitStr(a.attr("awr"),i)&&(s+='<a href="javascript:void(0);"'+(0==n?' class="d1"':"")+' t="1"><b></b><span>私聊</span></a>',n++),'<div class="dialogbtn'+(1==n?" one":"")+'"  nk="'+t+'" uid="'+e+'" utype="'+i+'">'+s+"</div>"}return'<div class="dialogbtn'+(1==n?" one":"")+'"  nk="'+t+'" uid="'+e+'" utype="'+i+'"></div>'},setOnlineUser:function(e){chat.userList.hasOwnProperty(e.userId)||(chat.userList[e.userId]=e)},getOnlineUserDom:function(e){if(3==e.userType)return"";$("#userListIdNew li[id='"+e.userId+"']").remove();var t=chat.getDialogHtml(e.userId,e.nickname,e.userType),i="",a="",s=e.sequence,n="";indexJS.userInfo.userId==e.userId&&(i="【我】",s="0",n="mynk"),e.isFromAjax===!0&&(n="csoffline"),a="";var o=chat.getAImgOrLevel(e.userId,e.clientGroup,e.userType,e.avatar);return indexJS.userInfo.userId==e.userId?{hasDg:common.isValid(t),seq:s,dom:'<li  id="'+e.userId+'" cg="'+(common.isBlank(e.clientGroup)?"":e.clientGroup)+'" t="'+s+'" utype="'+e.userType+'" class="'+o.level+'" >'+t+'<div class="imgdiv">'+o.aImg+'</div><span class="'+n+'">'+e.nickname+i+"</span>"+a+"</li>"}:{hasDg:common.isValid(t),seq:s,dom:"<li onclick='chat.setDialog(\""+e.userId+'","'+e.nickname+'",0,"'+e.userType+'","'+e.avatar+'");\' id="'+e.userId+'" cg="'+(common.isBlank(e.clientGroup)?"":e.clientGroup)+'" t="'+s+'" utype="'+e.userType+'" class="'+o.level+'" >'+t+'<div class="imgdiv">'+o.aImg+'</div><span class="'+n+'">'+e.nickname+i+"</span>"+a+"</li>"}},leaveRoomTip:function(e,t){if("forcedOut"!=e){if("roomClose"==e)$(".blackbg").children().hide(),box.showTipBox("注意：房间已停用，正自动登出..."),"visitor"==indexJS.userInfo.clientGroup?window.setTimeout(function(){indexJS.toRefreshView()},1200):window.setTimeout(function(){$(".logout").trigger("click")},1200);else if("otherLogin"==e){if("visitor"==indexJS.userInfo.clientGroup)return;chat.socket.disconnect(),$(".blackbg").children().hide(),box.showMsg({closeable:!1,title:"登出提示",msg:"注意：您的账号已在其他地方登陆，被踢出！",btns:[{txt:"重新登录",fn:function(){indexJS.toRefreshView()}},{txt:"注销",fn:function(){$("#logout").trigger("click")}}]})}}else if(t)for(var i in t)$("#userListId li[id='"+t[i]+"']").remove()},setWhOnlineTip:function(e,t){var i=$("#wh_msg_"+e+" .titonline strong");if(0!=i.length){var a=$("#wh_msg_"+e+" .titonline strong"),s=$(".mult_dialog a[uid="+e+"]").find("img"),n=$("#userListId li[t=3][uid="+e+"] .headimg");t?(a.text("在线"),s.removeClass("have_op"),n.removeClass("have_op")):(a.text("离线"),s.addClass("have_op"),n.addClass("have_op"))}},getWhToUser:function(){var e=$(".mult_dialog a[class=on]"),t=e.attr("uid");return{userId:t,nickname:e.find("label").text(),talkStyle:1,userType:e.attr("utype")}},sendWhMsg:function(e){var t=chat.getWhToUser(),i=e.find(".text-min-img img");if(i.size()>0){var a=i.attr("src");a.length>1048576?alert("发送的图片大小不要超过1MB."):(chat.setUploadImg(a,t),i.remove())}var s=chat.getSendMsg(e);if(s!==!1){var n={uiId:chat.getUiId(),fromUser:indexJS.userInfo,content:{msgType:chat.msgType.text,value:s}},o=$(".mult_dialog a[class=on]"),r=o.attr("uid");n.fromUser.toUser={userId:r,nickname:o.find("label").text(),talkStyle:1,userType:o.attr("utype")};var l=$("#wh_msg_"+r+" .dialog:last"),c=l.find(".whblt");c.length>0&&(n.fromUser.toUser.question=c.html(),n.fromUser.toUser.questionId=c.attr("rid"),n.fromUser.toUser.publishTime=l.attr("id")),chat.socket.emit("sendMsg",n),chat.setWhContent(n,!0,!1),e.html(""),chatAnalyze.setUTM(!1,$.extend({operationType:8},indexJS.userInfo,indexJS.courseTick.course))}},setWhVisitors:function(e,t,i,a,s,n,o){if(0==$(".mult_dialog a[uid="+i+"]").length){var r=this.getAImgOrLevel(i,e?e:$("#userListId li[id='"+i+"']").attr("cg"),t,s);$(".mult_dialog").append('<a href="javascript:void(0);" uid="'+i+'" utype="'+t+'" class=""><span class="himg '+r.level+'">'+r.aImg+"</span>"+a+'<i class="num dn" t="0"></i><i class="close"></i></a>');var l=$(".mult_dialog a[uid="+i+"]");if(o){var c=l.find(".num"),d=parseInt(c.attr("t"))+1;c.attr("t",d).text(d).show()}l.find(".close").click(function(){var e=$(this).parent();e.remove(),$("#wh_msg_"+e.attr("uid")).remove(),0==$(".mult_dialog a").length?($(".pletter_win .cont[id]").remove(),$(".pletter_win,.blackbg").hide()):$(".mult_dialog a:last").click()}),l.click(function(){$(".mult_dialog a").removeClass("on"),$(this).addClass("on"),$(this).find(".num").attr("t",0).text("").hide();var e=$(this).attr("uid"),t="wh_msg_"+e,i=$(this).attr("utype"),a=$(this).attr("online");if(chat.closeWhTip(e),$(".pletter_win .cont[id]").hide(),0==$("#"+t).length){var s="whTxt_"+e;$(".pletter_win").append($("#wh_content_tmp").html()),$(".pletter_win .cont:last").attr("id",t).find(".ctextarea").attr("id",s),$("#"+t).find(".facebtn").qqFace({id:"faceId_"+e,zIndex:1e6,assign:s,path:indexJS.filePath+"/face/"}),$("#"+t).find(".imgbtn").click(function(){return FileReader?void $("#"+t).find(".imginp").trigger("click"):void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$("#"+t).find(".imginp").bind("change",function(){var e=this,t=chat.getWhToUser(),i=e.files[0];if(!i)return!1;if(0!=i.type.indexOf("image")||!i.type||!/\.(?:jpg|png|gif)$/.test(i.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var a=i.size;if(a>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var s=new FileReader;s.readAsDataURL(i),s.onload=function(e){chat.setUploadImg(e.target.result,t)},s.onprogress=function(e){},s.onloadend=function(e){},$(this).val("")}),$("#"+t).find(".ctextarea").pastableTextarea().on("pasteImage",function(e,t){var i=$(this).find(".text-min-img");i.length>0?(i.attr("href",t.dataURL),i.find("img").attr("src",t.dataURL)):($(this).append('<a class="text-min-img" href="'+t.dataURL+'" data-lightbox="whSend-img"><img src="'+t.dataURL+'"/></a>'),$(this).focusEnd())}).keydown(function(e){return 13==e.keyCode?(chat.sendWhMsg($(this)),!1):void 0}),$("#"+t).find(".sendbtn").click(function(e){chat.sendWhMsg($(this).parents(".cont").find(".ctextarea"))}),$("#"+t).find(".pop_close").click(function(){$(".pletter_win .cont[id],.pletter_win .mult_dialog a[uid]").remove(),$(".pletter_win").hide(),$("div.popup_box:visible").length<1&&$("div.pletter_win:visible").length<1&&$(".blackbg").hide()}),$("#"+t).find(".pop_small").click(function(){$(".pletter_win").hide(),$("div.popup_box:visible").length<1&&$("div.pletter_win:visible").length<1&&$(".blackbg").hide()}),chat.socket.emit("getWhMsg",{clientStoreId:indexJS.userInfo.clientStoreId,userType:indexJS.userInfo.userType,groupId:indexJS.userInfo.groupId,groupType:indexJS.userInfo.groupType,userId:indexJS.userInfo.userId,toUser:{userId:e,userType:i}})}$("#"+t).show().find(".wh_nk").text($(this).text()),$("#"+t).find(".ctextarea").focus(),chat.setTalkListScroll(!0,$("#"+t+" .wh-content"),"dark"),chat.setWhOnlineTip(e,common.isValid(a)?!0:n)})}},setWhTip:function(e){if($(".pletter_win").is(":hidden")){var t=$("#userListId li[id="+e+"] a.uname span i"),i=0;t.length>0&&(i=t.text(),i=common.isValid(i)?i:0,$("#userListId li[id="+e+"] a.uname span i").text(parseInt(i)+1)),$("#userListId li[id="+e+"]").attr("k",1),this.whTipInterId||(this.whTipInterId=setInterval(function(){$("#userListId li[k=1]").toggleClass("tip_mrg")},1e3))}},closeWhTip:function(e){$("#userListId li[id="+e+"]").attr("k",0).removeClass("tip_mrg").find("a.uname span i").text(""),0==$("#userListId li[k=1]").length&&this.whTipInterId&&(clearInterval(this.whTipInterId),this.whTipInterId=null)},fillWhBox:function(e,t,i,a,s,n,o){var r=$(".mult_dialog a[uid="+a+"]");if(0==r.length)chat.setWhVisitors(e,i,a,s,t,!0,o);else if(o&&!r.hasClass("on")){var l=r.find(".num"),c=parseInt(l.attr("t"))+1;l.attr("t",c).text(c).show()}return n?(this.setWhTip(a),!1):($(".pletter_win").show(),$(".mult_dialog a[uid="+a+"]").click(),!0)},setWhContent:function(e,t,i,a){var s=e.fromUser,n="dialog ",o=e.content,r="";if(e.rule)return void $("#"+e.uiId+' span[contt="a"]').append('<em class="ruleTipStyle">'+e.value.tip+"</em>");if(i||(s.toWhUserId=s.userId),indexJS.userInfo.userId==s.userId||"0"==indexJS.userInfo.userType&&"-1"==s.userType||"-1"==indexJS.userInfo.userType&&"0"==s.userType){if(t&&(s.publishTime=e.uiId,s.toWhUserId=s.toUser.userId),e.serverSuccess){if($("#"+e.uiId+" .ctime").html(chat.formatPublishTime(s.publishTime)),$("#"+e.uiId).attr("id",s.publishTime),e.content.msgType==chat.msgType.img){chat.removeLoadDom(s.publishTime);var l=$("#"+s.publishTime+' span[contt="a"]>a'),c=e.content.needMax?"/studio/getBigImg?publishTime="+s.publishTime+"&userId="+s.userId:l.children("img").attr("src");l.attr("href",c)}return}n+="mine",r='<div class="infobar"><a href="javascript:void(0);" class="uname">我</a><span class="ctime">'+chat.formatPublishTime(s.publishTime,i,"/")+"</span></div>"}else{if(!i&&!a){this.fillWhBox(s.clientGroup,s.avatar,s.userType,s.userId,s.nickname,!1,!0)}var d="";"3"==s.userType&&(n+="analyst",d="&nbsp;（助理）"),r='<div class="infobar"><a href="javascript:void(0);" class="uname">'+s.nickname+d+'</a><span class="ctime">'+chat.formatPublishTime(s.publishTime,i,"/")+"</span></div>"}if(common.isBlank(s.toWhUserId))return void console.error("setWhContent->fromUser toWhUserId is null,please check!");var u="",p=$("#wh_msg_"+s.toWhUserId+" .dialoglist"),h="";if(o.msgType==chat.msgType.img){u=o.needMax?'<a href="/studio/getBigImg?publishTime='+s.publishTime+"&userId="+s.userId+'" data-lightbox="whimg-"'+s.userId+'><img src="'+o.value+'" alt="图片"/></a>':'<a href="'+o.value+'" data-lightbox="whimg-"'+s.userId+'><img src="'+o.value+'" alt="图片" /></a>';var m=t?'</span><em class="img-loading"></em><span class="shadow-box"></span><s class="shadow-conut"></s>':"";u='<div class="bubble"><i></i><div class="dcont"><span contt="a">'+u+m+"</span></div></div>"}else if(a)u='<div class="bubble whcls"><i></i><div class="dcont whblt" rid="'+o.infoId+'">'+o.value+"</div></div>";else{if(!t&&common.isValid(s.toUser.question)){var f='<a href="javascript:void(0);" class="uname">'+s.toUser.nickname+'</a><span class="ctime">'+chat.formatPublishTime(s.publishTime,i,"/")+"</span>";h='<div class="dialog" id="'+s.publishTime+'">'+f+'<div class="bubble whcls"><i></i><div class="dcont whblt">'+s.toUser.question+"</div></div></div>",p.append(h)}u='<div class="bubble"><i></i><div class="dcont"><span contt="a">'+o.value+"</span></div></div>"}if(h='<div class="'+n+'" id="'+s.publishTime+'" utype="'+s.userType+'" mType="'+o.msgType+'">'+r+u+"</div>",p.append(h),this.formatMsgToLink(s.publishTime),!i){var g=p.parents(".wh-content");g.hasClass("mCustomScrollbar")&&chat.setTalkListScroll(!0,g,"dark")}},setOnlineNum:function(e){common.isBlank(e)||isNaN(e)||($(".right_row .main_tabnav a[t='chat'] .dialognum span").text(parseInt(e)),$(".userListOnline").text(parseInt(e)))},searchUserList:function(e){if(!e)return[];var t=[],i=new RegExp(e,"i");return $.each(chat.userList,function(e,a){-1!=a.userType&&i.test(a.nickname)&&t.push({value:a.userId,label:a.nickname,userType:a.userType})}),t},setUserListIdEmpty:function(){$("#userListId").html("")},setSocket:function(){this.socket=common.getSocket(io,indexJS.socketUrl,indexJS.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),indexJS.userInfo.socketId=chat.socket.id;var e=$("#roomInfoId"),t="",i="",a="",s="";common.isValid(indexJS.courseTick.course)&&(t=indexJS.courseTick.course.courseId,i=indexJS.courseTick.course.courseName,a=indexJS.courseTick.course.lecturerId,s=indexJS.courseTick.course.lecturer),chat.socket.emit("login",{courseId:t,courseName:i,teacherId:a,teacherName:s,cookieId:chatAnalyze.getUTMCookie(),userName:$("#myUserName").attr("un"),roomName:e.text(),email:$("#myEmail").attr("e"),userInfo:indexJS.userInfo,lastPublishTime:$("#dialog_list>div:last").attr("id"),fUserTypeStr:e.attr("awr"),allowWhisper:e.attr("aw")}),$(".img-loading[pf=chatMessage]").show()}),this.socket.on("onlineUserList",function(e,t){var i=t;if("true"==$("#roomInfoId").attr("av")){var a=0,s=0;s=t>100?Math.ceil(50*Math.random())+275:10>=t?60:200/t*3+10;for(var n=0;s>n;n++)a=common.randomNumber(6),e.push({userId:"visitor_"+a,clientGroup:"visitor",nickname:"游客_"+a,sequence:15,userType:-1});i+=s}var o=null,r=[];for(var n in e)r.push(chat.getOnlineUserDom(e[n]).dom),o=e[n],chat.setOnlineUser(o),3==o.userType&&$(".mult_dialog a[uid="+o.userId+"]").length>0?$(".mult_dialog a[uid="+o.userId+"]").attr("online",!0):$.inArray(o.userType,[1,2])>-1&&chat.contactAnalystEvent(o);$("#userListIdNew").html(r.join("")),indexJS.setListScroll(".otheruser .scrollbox"),i=i+$(".mult_dialog a[uid]").length+$("#analystbar a[uid]").length,chat.setOnlineNum(i)}),this.socket.on("disconnect",function(e){console.log("disconnect")}),this.socket.on("error",function(e){console.error("e:"+e)}),this.socket.on("sendMsg",function(e){if(e.fromUser.toUser&&1==e.fromUser.toUser.talkStyle)chat.setWhContent(e,!1,!1);else{if(!e.serverSuccess&&indexJS.userInfo.userId==e.fromUser.userId&&!e.rule)return;chat.setContent(e,!1,!1)}}),this.socket.on("notice",function(e){switch(e.type){case"onlineNum":var t=e.data,i=t.onlineUserInfo;if(t.online){var a=0;$.inArray(i.userType,[1,2])>-1&&(chat.contactAnalystEvent(i),a+=1),chat.setOnlineUser(i),a+=parseInt($(".right_row .main_tabnav a[t='chat'] .dialognum span").text())+1,chat.setOnlineNum(a);var s=$("#userListIdNew li"),n=chat.getOnlineUserDom(i),o=n.dom;if("0"==n.seq)s.first().before(o);else{var r=!1,l=0,c="";s.each(function(){return l=parseInt($(this).attr("t")),i.sequence<l?($(this).before(o),r=!0,!1):i.sequence==l&&(c=$(this).find("a span").text(),i.nickname<=c)?($(this).before(o),r=!0,!1):void 0}),r||$("#userListIdNew").append(o)}indexJS.setListScroll(".otheruser .scrollbox")}else if(indexJS.userInfo.userId!=i.userId)if($("#userListIdNew li[id='"+i.userId+"']").remove(),3==i.userType)$("#userListId #"+i.userId+" .uname>span").addClass("csoffline");else{var a=parseInt($(".right_row .main_tabnav a[t='chat'] .dialognum span").text());$("#userListId #"+i.userId).remove(),chat.contactAnalystEvent(i,!0),$.inArray(i.userType,[1,2])>-1?a-=1:(0==i.userType||-1==i.userType)&&(a-=1),chat.setOnlineNum(a)}3==i.userType&&chat.setWhOnlineTip(i.userId,t.online);break;case"removeMsg":$("#"+e.data.replace(/,/g,",#")).remove(),chat.setTalkListScroll();break;case"leaveRoom":chat.leaveRoomTip(e.flag,e.userIds);break;case"pushInfo":var t=e.data;switch(t.position){case 1:chat.msgPushObj.whInfos=t.infos;break;case 3:chat.msgPushObj.pbInfos=t.infos;for(var d=0,u=chat.msgPushObj.pbInfos.length;u>d;d++)chat.msgPushObj.pbInfos[d].nextTm=chat.msgPushObj.pbInfos[d].serverTime+60*chat.msgPushObj.pbInfos[d].onlineMin*1e3;break;case 4:videos.rollNews.update(t)}break;case"approvalResult":var t=e.data;if(t.refuseMsg){var p=t.publishTimeArr;for(var d in p)$("#"+p[d]+" span[contt] em[class=ruleTipStyle]").html("已拒绝")}else{for(var d in t)chat.formatUserToContent(t[d]);chat.setTalkListScroll(!0)}break;case"articleInfo":var h=e.data;if(h)switch(h.categoryId){case"trade_strategy_article":var m=h.detailList&&h.detailList[0],f=m&&m.authorInfo&&m.authorInfo.userId;m&&$("#lvInfoId .te_detail").attr("uid")==f&&$("#lvInfoId .info2 p").text(m.content);break;case"class_note":if(h.platform&&-1!=h.platform.indexOf(indexJS.userInfo.groupId)){var m=h.detailList&&h.detailList[0];common.isValid(m.tag)&&"trading_strategy"==m.tag?chatPride.appendTradeStrategyNote(h,!0,!0,!0):chatPride.appendClassNoteInfo(h,!0,!0,!0),chatPride.setAdvertisement(),chatPride.pushShoutSingleInfo(h),indexJS.setListScroll($(".tabcont .main_tab .livebrief_list .scrollbox"))}}break;case"showTrade":var g=e.data;chatShowTrade.pushShowTradeInfo(g);break;case"serverTime":indexJS.serverTime=e.data}}),this.socket.on("loadMsg",function(e){$("#dialog_list .push").hide(),$(".img-loading[pf=chatMessage]").hide();var t=e.msgData;if(t&&$.isArray(t)){t.reverse();for(var i in t)chat.formatUserToContent(t[i])}$("#dialog_list .push").appendTo($("#dialog_list")).show(),chat.setTalkListScroll(!0)}),this.socket.on("loadWhMsg",function(e){$("#wh_msg_"+e.toUserId+" .chat_content .dialoglist .dialog .whcls").parent().hide();var t=e.data;if("offline"==e.type){if(t&&!$.isEmptyObject(t))for(var i in t)chat.setWhVisitors(t[i].clientGroup,t[i].userType,i,t[i].nickname,$("#userListId li[id='"+i+"']").length>0)}else if(t&&$.isArray(t)){var a=0,s=null;t.reverse();$(".mult_dialog a[uid="+e.toUserId+"]");for(var n in t)s=t[n],chat.formatUserToContent(s,!0,e.toUserId),s.content.msgType==chat.msgType.img&&a++;$("#wh_msg_"+e.toUserId+" .chat_content .dialoglist .dialog .whcls").parent().appendTo($("#wh_msg_"+e.toUserId+" .chat_content .dialoglist")).show(),chat.setTalkListScroll(!0,$("#wh_msg_"+e.toUserId+" .wh-content"),"dark")}})},setTalkListScroll:function(e,t,i){var a=t?t:$("#chatMsgContentDiv .scrollbox");a.hasClass("mCustomScrollbar")?(a.mCustomScrollbar("update"),e&&a.mCustomScrollbar("scrollTo","bottom")):(a.mCustomScrollbar({scrollInertia:1,scrollButtons:{enable:!1},theme:i?i:"light-thick",scrollbarPosition:"outside"}),a.mCustomScrollbar("scrollTo","bottom"))},setWhPushInfo:function(e,t){var i=e.attr("uid"),a=e.text().replace(/\s（助理）$/,"");if($("#wh_msg_"+i+" div[id="+chat.msgPushObj.whInfo.publishTime+"]").length>0)return!1;var s={fromUser:{publishTime:chat.msgPushObj.whInfo.publishTime,userId:i,nickname:a,userType:3},content:{msgType:chat.msgType.text,value:chat.msgPushObj.whInfo.info,infoId:chat.msgPushObj.whInfo.infoId}};return chat.setWhContent(s,!1,!1,!0),chat.msgPushObj.whInfo={},window.clearTimeout(chat.pushInfoTimeOutId),!0},formatUserToContent:function(e,t,i){var a={userId:e.userId,nickname:e.nickname,avatar:e.avatar,userType:e.userType,groupId:e.groupId,clientGroup:e.clientGroup,publishTime:e.publishTime,toUser:e.toUser,avatar:e.avatar,position:e.position};t?(a.toWhUserId=i,chat.setWhContent({fromUser:a,content:e.content},!1,!0)):chat.setContent({fromUser:a,content:e.content},!1,!0)},talkBoxPush:{showMsg:function(e){var t=[];t.push('<div class="dialog info_push" style="padding-right:10px;">'),t.push(e.content),t.push("</div>"),$("#dialog_list").append(t.join("")),$("#scrollbtn").hasClass("on")&&chat.setTalkListScroll(!0)}},setPushInfo:function(){var e=null,t=chat.msgPushObj.whInfos;if(t&&t.length>0&&"vip"!=$("#roomInfoId").attr("rt"))for(var i=0,a=t.length;a>i;i++)if(e=t[i],!e.pushed&&e&&indexJS.serverTime>=e.serverTime+60*e.timeOut*1e3){e.pushed=!0,chat.msgPushObj.whInfo={info:e.content,publishTime:e.publishTime,infoId:e.contentId};var s=$(".pletter_win .mult_dialog a[utype=3]"),n=$(s.get(common.randomIndex(s.length))),o=n.attr("uid");if(common.isBlank(o))continue;$(".mult_dialog a[uid="+o+"]").click(),chat.setWhPushInfo($(".mult_dialog a[uid="+o+"]")),$(".pletter_win").is(":hidden")&&$(".mod_infotab .tabnav .myaid").click()}var r=null,l=chat.msgPushObj.pbInfos;if(l&&l.length>0)for(var i=0,c=l.length;c>i;i++)r=l[i],r&&r.nextTm&&indexJS.serverTime>=r.nextTm&&common.dateTimeWeekCheck(r.pushDate,!1,indexJS.serverTime)&&(r.intervalMin&&r.intervalMin>0?r.nextTm=indexJS.serverTime+60*r.intervalMin*1e3:delete r.nextTm,chat.talkBoxPush.showMsg(r))},contactAnalystEvent:function(e,t){var i=$('#analystbar div[uid="'+e.userId+'"]');return t||i.size()>0?void i.remove():(i=['<div href="javascript:void(0);" class="contactbox" uid="'+e.userId+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_lts_"+e.userId+"', 'content_right', 1, true]);\">"],i.push('<div class="himg">'),i.push('<img src="'+e.avatar+'" alt="">'),i.push("</div>"),i.push('<a href="javascript:void(0);" class="contactbtn">'),i.push("联系"+e.nickname),i.push("</a></div>"),i=$(i.join("")),$("#analystbar").append(i),void i.find("a").bind("click",e,function(e){var t=e.data;t&&chat.setDialog(t.userId,t.nickname,0,t.userType,t.avatar)}))},replyEvent:function(e,t){e="object"==typeof e?e:$(e),e.unbind("click"),e.click(function(){var e=$(this),t=e.prev().children("span.sender").html();chat.setDialog(e.attr("uId"),t,e.attr("ts"),e.attr("futype")),$(".mymsg em").show()}),t="object"==typeof t?t:$(t),t.unbind("click"),t.click(function(){$(this).parent().remove(),0==$("#myMsgListContent .mymsg_list").length?$(".mymsg,.mymsg em").hide():$("#myMsgListContent .mymsg_list").length<2&&$(".mymsg").height(27)})},showSystemTopInfo:function(e,t,i){var a=$("#chatPrideSystemTopInfo");a.data("data",{type:e,id:t}),a.find(".pushcont span").text(i),a.slideDown()}},chatTeacher={teacherId:null,teacherSele:"off",init:function(){this.setEvent()},setEvent:function(){$("#sdNoAuthBox .contactContact").click(function(){0==$(".pletter_win .mult_dialog a[utype=3]").length&&chat.getCSList(),$(this).hasClass("nocs")?box.showTipBox("助理失联中"):common.openPopup(".blackbg,.pletter_win"),$("#sdNoAuthBox").hide()})},sd:{analyst:null,tradeList:[],loadAll:!1,setSDEvent:function(){$("#sdNoAuthBox .aid_chat span").bind("click",function(){$("#sdNoAuthBox .pop_close").trigger("click");var e=$(this).attr("uid"),t=$("#userListId li[id='"+e+"']");0==t.size()&&(t=$("#userListId li[utype='3']:first")),t.find("em").trigger("click")})},initSD:function(){var e=common.getSyllabusPlan(indexJS.syllabusData,indexJS.serverTime);!e||!e.lecturerId||videos.sd.analyst&&-1!=e.lecturerId.indexOf(videos.sd.analyst.userNo)||$.getJSON("/studio/getShowTradeInfo",{userNo:e.lecturerId},function(e){e&&e.analyst&&(videos.sd.analyst=e.analyst,videos.sd.tradeList=e.tradeList||[],videos.sd.loadAll=!1,$("#sdInfoId .nosd_tip").hide(),videos.sd.showPraiseInfo(),videos.sd.showSDInfo())})},showPraiseInfo:function(){$("#sdInfoId .te_info").empty();var e=this.analyst;$("#sdInfoId .te_info").append('<div class="te_detail sd" uid="'+e.userNo+'"><img src="'+e.avatar+'" alt=""><div class="rcont"><span><strong>'+e.userName+'</strong><i class="suc">TA的胜率：<b>'+(e.winRate||"--")+'</b></i></span> <a href="javascript:" class="support" uid="'+e.userNo+'"><label>'+e.praiseNum+"</label><i>+1</i></a> </div> </div>"),$("#sdInfoId .te_detail .support").click(function(){var e=$(this);try{common.getJson("/studio/setUserPraise",{clientId:indexJS.userInfo.userId,praiseId:e.attr("uid")},function(t){if(t.isOK){e.find("i").fadeIn().delay(400).fadeOut();var i=e.find("label");i.text(common.isValid(i.text())?parseInt(i.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");e.addClass("supported"),e.attr("title","已点赞");var a=$("#lvInfoId .te_detail .support[uid='"+videos.sd.analyst.userNo+"']");a.find("label").text(e.find("label").text()),a.addClass("supported"),a.attr("title","已点赞")},!0)}catch(t){console.error("setPraise->"+t)}})},showSDInfo:function(){this.showWXInfo(),$("#sdInfoId .sd_ul").empty(),this.showTradeList()},showWXInfo:function(){var e=[];this.analyst.wechatCode&&(e.push('<div class="te_wx">'),e.push('<div class="wx-qrcode">'),this.analyst.wechatCodeImg&&e.push('<img src="'+this.analyst.wechatCodeImg+'" alt="'+this.analyst.wechatCode+'">'),e.push("</div>"),e.push('<span class="wx-num">老师微信号: <b>'+this.analyst.wechatCode+"</b></span>"),e.push("</div>"),$("#sdInfoId .te_info").append(e.join("")))},showTradeList:function(){if(videos.sd.loadAll)return!1;for(var e=$("#sdInfoId .sd_ul li").size(),t=videos.sd.tradeList,i=t?t.length:0,a=null,s=[],n=indexJS.checkClientGroup("new"),o=!1,r=e;i>r&&e+6>r;r++)a=t[r],o=!a.profit,s.push('<li><div class="cont">'),s.push('<div class="sd_tit">'),s.push('<span class="dep">'),o?s.push("持仓中"):(s.push("获利："),s.push("<b"+(/^-/.test(a.profit)?' class="fall"':"")+">"+a.profit+"</b>")),s.push("</span>"),s.push('<span class="sdtime">晒单时间: '+common.formatterDateTime(a.showDate).substring(5,16)+"</span>"),s.push("</div>"),n&&o?(s.push('<a href="javascript:videos.sd.showAuthBox()">'),s.push('<img src="/pm/theme1/img/sd_default.png"></a>')):(s.push('<a href="'+a.tradeImg+'" data-lightbox="sd-img" data-title="'+(o?"持仓中":"获利："+a.profit)+'">'),s.push('<img src="'+a.tradeImg+'"></a>')),s.push("<i></i></div></li>");r>=i-1&&(videos.sd.loadAll=!0),$("#sdInfoId .sd_ul").append(s.join("")),indexJS.setListScroll($("#sdInfoId .sd_show"),null,{callbacks:{onTotalScroll:videos.sd.showTradeList}})},showAuthBox:function(){if(indexJS.userInfo.isLogin){var e=$("#userListId li[utype='3']:first");$("#sdNoAuthBox .sdzl").show(),$("#sdNoAuthBox .aid_chat img").attr("src",e.find(".headimg img").attr("src")),$("#sdNoAuthBox .aid_chat span").attr("uid",e.attr("id")).text(e.find(".uname span:first").text()),$("#sdNoAuthBox,.blackbg").show()}else box.openLgBox()}},trainDetails:function(e){var t=$(e),i=t.attr("userno"),a=t.parent().find(".train_name").text();chatTeacher.trainDetailsLoad(i,a)},trainDetailsLoad:function(e,t){$(".train_detail .pop_tit label").text(t);var i={joe_chung:"popup_box tbox train_detail zwytrain dn",tracey_jiang:"popup_box tbox train_detail cctrain_detail dn","default":"popup_box tbox train_detail dn"};$("#panel_popupBox_train").attr("class",i.hasOwnProperty(e)?i[e]:i["default"]),LazyLoad.css(["/pm/theme1/css/train.min.css"]),$("#train_info_id").empty().load("/studio/getTrDetail?uid="+e,function(){$("#train_info_id > .scrollbox").mCustomScrollbar({theme:"light-thick",scrollbarPosition:"outside",scrollButtons:!1}),common.openPopup(".blackbg,.train_detail")})},trainRegisByUserNo:function(e){var t=$(".pop_train .scrollbox .trainlist a[userno='"+e+"']:first");0==t.size()&&(t=$("#roomList_panel a[userno='"+e+"'][rt='train']")),chatTeacher.trainRegis(t[0])},trainRegis:function(e){if(indexJS.userInfo.isLogin){var t=$(e).attr("userno"),i=$(e).attr("cgs"),a=$(e).attr("updateTrain"),s=$(e).attr("isDetail"),n=indexJS.userInfo.clientGroup,o=indexJS.userInfo.nickname;if(i&&-1!=i.indexOf(n)){var r={groupId:$(e).attr("rid"),userNo:t,clientGroup:i,nickname:o};common.getJson("/studio/addClientTrain",{data:JSON.stringify(r)},function(i){i.awInto?indexJS.toRefreshView():i.errcode?!$(".train_detail").is(":visible")&&"true"==$(e).attr("rml")&&$.inArray(i.errcode,["3003","3009"])>-1?chatTeacher.trainDetailsLoad(t,$(e).text()):box.showMsg(i.errmsg):i.isOK?a?chatTeacher.showTrani(i.chatGroup):"true"==s?(box.showMsg(i.msg),videosTrain.getTrainList()):box.showMsg(i.msg):box.showMsg(i.msg||i.errmsg)})}else videosLive.changeRoomMsg({title:"",type:"onlyTrain"})}else $("#loginBox").css("z-index","102"),common.openPopup(".blackbg,.login")},selectAnalyst:function(e){chatTeacher.teacherSele="off",chatTeacher.getShowTeacher($(e).attr("uid")),chatTeacher.teacherSele="on"},clearHtml:function(e){var t=$(".main_tab .teacherlist .teacherbox");for(var i in e)t.find(e[i]).html("")},getShowTeacher:function(e){if($(".main_tabnav a[t=teacher]").hasClass("on")){var t;if(common.isBlank(e))t=indexJS.courseTick.course&&indexJS.courseTick.course.lecturerId.split(",")[0];else if(t=e,t==chatTeacher.teacherId||"on"==chatTeacher.teacherSele)return;common.isBlank(t)&&(t=$("#textlivePanel .livebrief[pt]:eq(0)>div.te_info").attr("tid")||"");var i=LoginAuto.sessionUser.groupId;this.clearHtml([".taglist",".sd_show .sd_ul",".tebox_teachLive ul",".tebox_studentLive ul",".tebox_teachVideo ul"]),common.getJson("/studio/getShowTeacher",{data:JSON.stringify({groupId:i,authorId:t})},function(e){var i=e.userInfo,a=e.teacherList,s=e.tradeList,n=e.trainList,o=e.trAndClNum;if(null!=i){chatTeacher.teacherId=i.userNo,$(".main_tab .teacherlist .teacherbox .te_top  .info-l span").eq(0).text(i.userName),$(".main_tab .teacherlist .teacherbox .te_top  .info-l span").eq(1).text(i.position),$(".main_tab .teacherlist .teacherbox .te_top  .himg img").attr({src:i.avatar});var r=common.isBlank(i.winRate)||""==i.winRate?"--":i.winRate,l=common.isBlank(i.earningsM)||""==i.earningsM?"--":i.earningsM;if($(".main_tab .teacherlist .teacherbox .te_top  .stateshow .item b").eq(0).text(r),$(".main_tab .teacherlist .teacherbox .te_top  .stateshow .item b").eq(1).text(l),$("#analystIntro").text(i.introduction),$("#analystWeChatQrCode").attr("src",i.wechatCodeImg),$(".main_tab .teacherlist .teacherbox .te_top  .stateshow .item:last-child").empty(),$(".main_tab .teacherlist .teacherbox .te_top  .stateshow .item:last-child").append('<a href="javascript:void(0)" class="support" uid="'+i.userNo+'" onclick="chatTeacher.showAnalystPraiseInfo(this)"><i class="i6"></i></a><b>(<label>'+i.praiseNum+"</label>)</b><span>赞</span>"),$(".main_tab .teacherlist .teacherbox  .taglist").empty(),i.tag){for(var c=[],d=i.tag.split(","),u=0;u<d.length;u++){var p=d[u];c.push('<span class="tag"><span>'+p+"</span><i></i></span>")}$(".main_tab .teacherlist .teacherbox  .taglist").html(c.join(""))}}if(null!=a){for(var h=[],m=null,u=0;u<a.length;u++)m=a[u],h.push("<a href=\"javascript:void(0)\" onclick=\"chatTeacher.selectAnalyst(this);_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_OthenTeacher', '"+m.userName+'\', 1, true]);" uid="'+m.userNo+'">'+m.userName+"</a>");$(".main_tab .teacherlist .teacherbox  .clearfix .teacher_select .selectlist").html(h.join(""))}if(null!=s){var e={type:"prerogative",item:"prerogative_position"};common.getJson("/studio/getChatPointsConfig",{data:JSON.stringify(e)},function(e){var t=!1,i=!1;if(e)for(var a=e.clientGroup,n=0,o=a?a.length:0;o>n;n++){var r=a[n];r==indexJS.userInfo.clientGroup&&(t=!0)}for(var l=[],c=null,n=0,d=1;n<s.tradeList.length&&(c=s.tradeList[n],i=!c.profit,!(d>4));n++,d++)d%2!=0?l.push("<li>"):l.push('<li class="r">'),l.push('<div class="cont">'),l.push('<div class="sd_tit">'),l.push('<span class="dep">'),i?l.push("持仓中"):(l.push("获利："),l.push("<b"+(/^-/.test(c.profit)?' class="fall"':"")+">"+c.profit+"</b>")),l.push("</span>"),l.push('<span class="sdtime">晒单时间: '+common.formatterDateTime(c.showDate).substring(5,16)+"</span>"),l.push("</div>"),i?indexJS.userInfo.isLogin&&t?(l.push('<a href="#" onclick="chatTeacher.deductionIntegralShowTrade(this)" tradeId="'+c._id+'" tradeimg="'+c.tradeImg+'" isPos="'+i+'" profit="'+c.profit+'">'),l.push('<i class="i-zoom"></i><img src="/pm/theme1/img/sd_default.png"></a>')):indexJS.userInfo.isLogin?(l.push('<a href="'+c.tradeImg+'" data-lightbox="sd-img" data-title="'+(i?"持仓中":"获利："+c.profit)+'">'),l.push('<i class="i-zoom"></i><img src="'+c.tradeImg+'"></a>')):(l.push("<a href=\"javascript:chatTeacher.sd.showAuthBox();_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_ChiChangZhong', 'content_right', 1, true]);\">"),l.push('<i class="i-zoom"></i><img src="/pm/theme1/img/sd_default.png"></a>')):(l.push('<a href="'+c.tradeImg+'" data-lightbox="sd-img" data-title="'+(i?"持仓中":"获利："+c.profit)+'">'),l.push('<i class="i-zoom"></i><img src="'+c.tradeImg+'"></a>')),l.push("</div></li>");$(".main_tab .teacherlist .teacherbox .sd_show .sd_ul").html(l.join(""))})}null!=n&&chatTeacher.showTrani(n,o),indexJS.getArticleList("teach_video_base,teach_video_expert,teach_video_financial,teach_video_gw,student_style,teach_live_video",indexJS.userInfo.groupId,0,1,20,'{"createDate":"desc"}',{authorId:t},function(e){if(e&&0==e.result){for(var t=e.data,i=1,a=1,s=1,n=[],o=[],r=[],l=null,c=null,d=0;d<t.length;d++)l=t[d],c=t[d].detailList[0],"teach_live_video"==l.categoryId?6>=i&&(i%3!=0?n.push("<li>"):n.push('<li class="r">'),n.push('<a href="javascript:" class="imga" title="'+c.title+'" ct="'+l.categoryId+'" articleId="'+l._id+'" vurl="'+l.mediaUrl+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_Wonderfullive', '"+c.title+'\', 1, true]);"><img src="'+l.mediaImgUrl+'" ><b class="playbtn"><i></i></b></a>'),n.push('<a href="javascript:" class="vlink" title="'+c.title+'" ct="'+l.categoryId+'" articleId="'+l._id+'" vurl="'+l.mediaUrl+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_Wonderfullive', '"+c.title+"', 1, true]);\">"+c.tag+"</a>"),n.push("</li>"),i++):"student_style"==l.categoryId?3>=a&&(a%3!=0?o.push("<li>"):o.push('<li class="r">'),o.push('<a href="'+l.mediaUrl+'" data-lightbox="student-img" data-title="'+c.title+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_StudentsStyle', '"+c.tag+'\', 1, true]);"><div class="imga"><img src="'+l.mediaUrl+'" ></div></a>'),o.push('<span class="vlink">'+c.tag+"</span>"),o.push("</li>"),
a++):3>=s&&(s%3!=0?r.push("<li>"):r.push('<li class="r">'),r.push('<a href="javascript:" class="imga" title="'+c.title+'" ct="'+l.categoryId+'" articleId="'+l._id+'" vurl="'+l.mediaUrl+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_teachvideo', '"+c.title+'\', 1, true]);"><img src="'+l.mediaImgUrl+'" ><b class="playbtn"><i></i></b></a>'),r.push('<a href="javascript:" class="vlink" title="'+c.title+'" ct="'+l.categoryId+'" articleId="'+l._id+'" vurl="'+l.mediaUrl+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_teachvideo', '"+c.title+"', 1, true]);\">"+c.tag+"</a>"),r.push("</li>"),s++);$(".main_tab .teacherlist .teacherbox .tebox_teachLive ul").html(n.join("")),$(".main_tab .teacherlist .teacherbox .tebox_studentLive ul").html(o.join("")),$(".main_tab .teacherlist .teacherbox .tebox_teachVideo ul").html(r.join("")),$(".main_tab .teacherlist .teacherbox .tebox_teachLive ul li a").click(function(){$(".main_tab .teacherlist .teacherbox .tebox_teachLive ul li .vlink").removeClass("on"),"imga"==$(this).attr("class")&&$(this).next(".vlink").addClass("on"),"vlink"==$(this).attr("class")&&$(this).addClass("on");var e=$(this).attr("title");videos.player.play($(this).attr("vurl"),e);var t=$(this).attr("articleId");chatAnalyze.setUTM(!1,$.extend({operationType:7,videoId:t,videoName:e},indexJS.userInfo,indexJS.courseTick.course))}),$(".main_tab .teacherlist .teacherbox .tebox_teachVideo ul li a").click(function(){$(".main_tab .teacherlist .teacherbox .tebox_teachVideo ul li .vlink").removeClass("on"),"imga"==$(this).attr("class")&&$(this).next(".vlink").addClass("on"),"vlink"==$(this).attr("class")&&$(this).addClass("on");var e=$(this).attr("title");videos.player.play($(this).attr("vurl"),e);var t=$(this).attr("articleId");chatAnalyze.setUTM(!1,$.extend({operationType:7,videoId:t,videoName:e},indexJS.userInfo,indexJS.courseTick.course))})}})})}},showTrani:function(e,t){if(null!=e){var i=[];e.forEach(function(e,t){(t+1)%2!=0?i.push("<li>"):i.push('<li class="r">');var a="报名",s="trainbtn",n="("+e.clientSize+"人)",o=" onclick=\"chatTeacher.trainRegis(this);_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_Signup', '"+e.name+"', 1, true]);\"";e.allowInto?(a="进入",n=""):e.isEnd&&(a="已结束",s+=" b2",o="",n="");var r=common.trim(e.remark);i.push('<div class="cont">'),i.push('<div class="headimg"><img src="'+e.defaultAnalyst.avatar+'" alt=""></div>'),i.push('<div class="train_name">'+e.name+"</span></div>"),i.push("<p>"+r+"</p>"),i.push('<a href="javascript:void(0)" class="'+s+'" userno="'+e.defaultAnalyst.userNo+'" sp="'+e.allowInto+'" cgs= "'+e.clientGroup+'" rid="'+e._id+'" updateTrain="updateTrain"'+o+">"+a+n+"</a>"),i.push("</div></li>")}),t&&$(".main_tab .teacherlist .teacherbox .tebox_train  .tebox_tit span").text("(已结束开班"+t.trainNum+"期/总共"+t.clientNum+"人)"),$(".main_tab .teacherlist .teacherbox .tebox_train  ul").empty().prepend(i.join(""))}},showAnalystPraiseInfo:function(e){var t=$(e);try{common.getJson("/studio/setUserPraise",{clientId:indexJS.userInfo.userId,praiseId:t.attr("uid")},function(e){if(e.isOK){var i=t.next().find("label");i.text(common.isValid(i.text())?parseInt(i.text())+1:0),box.showTipBox("亲，点赞成功！")}else box.showTipBox("亲，已点赞，当天只能点赞一次！");t.addClass("supported"),t.attr("title","已点赞")},!0)}catch(i){console.error("setPraise->"+i)}},deductionIntegralShowTrade:function(e){var t=$(e);if(indexJS.userInfo.isLogin){var i={groupType:indexJS.userInfo.groupType,item:"prerogative_position",tag:"trade_"+t.attr("tradeId")};common.getJson("/studio/addPointsInfo",{params:JSON.stringify(i)},function(e){if(e.isOK){var i=t.attr("tradeimg");t.attr("href",i),t.find("img").attr("src",i),t.attr("data-lightbox","sd-img"),t.attr("data-title",t.attr("isPos")?"持仓中":"获利："+t.attr("profit")),t.removeAttr("onclick"),t.unbind("click"),t.click()}else box.showTipBox(e.msg)})}}},chatShowTrade={tradeForUser:null,tradeList:[],tradeLoadAll:!1,init:function(){this.setEvent()},setEvent:function(){indexJS.userInfo.isLogin&&chatShowTrade.getPointsInfo(),$("#wantShowTrade").click(function(){if(indexJS.userInfo.isLogin)(common.isBlank(indexJS.userInfo.isSetName)||indexJS.userInfo.isSetName)&&$("#userName").val(indexJS.userInfo.nickname).attr("readonly","readonly"),common.openPopup(".pop_addsd,.blackbg");else{var e=e||{};box.openLgBox(e.closeable,e.showTip)}}),$("#myShowTrade").click(function(){if(indexJS.userInfo.isLogin)$(".pop_mysd .sd_list .sd_ul").empty(),chatShowTrade.getPointsInfo(),chatShowTrade.tradeForUser=indexJS.userInfo.userId,chatShowTrade.initShowTrade(),$(".pop_mysd .personal_info .headimg img").attr("src",$("#avatarInfoId").attr("src")),$(".pop_mysd .personal_info .username").text(indexJS.userInfo.nickname),$(".pop_mysd .personal_info .infobar").removeClass("dn"),common.openPopup(".pop_mysd,.blackbg");else{var e={};box.openLgBox(e.closeable,e.showTip)}}),$("#flTradeImg").change(function(){var e=this,t=e.files[0];if(!t)return!1;if(0!=t.type.indexOf("image")||!t.type||!/\.(?:jpg|png|gif)$/.test(t.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=t.size;if(i>=524288)return alert("上传的图片大小不要超过512KB."),!1;try{var a=new FormData($("#showTradeForm")[0]);$.ajax({url:indexJS.apiUrl+"/upload/uploadFile",type:"POST",data:a,async:!1,cache:!1,contentType:!1,processData:!1,success:function(t){if(0==t.result){var i=t.data?t.data[0]:null;i&&($("#tradeImg").val(i.fileDomain+i.filePath),$(e).val(""))}else alert("上传图片失败，请联系在线客服！")},error:function(e){console.error("error:",e)}})}catch(s){console.error("上传图片失败",s)}}),$("#tradeSubmit").click(function(){chatShowTrade.showTrade()})},initShowTrade:function(){var e={groupType:indexJS.userInfo.groupType};common.isValid(chatShowTrade.tradeForUser)&&(e.userNo=chatShowTrade.tradeForUser),common.getJson("/studio/getShowTrade",{data:JSON.stringify(e)},function(e){e.isOK&&common.isValid(e.data)&&(common.isValid(chatShowTrade.tradeForUser)&&$(".pop_mysd .sd_list .sd_ul").empty(),chatShowTrade.tradeList=e.data.tradeList||[],chatShowTrade.tradeLoadAll=!1,chatShowTrade.setShowTrade())})},setShowTrade:function(){if(chatShowTrade.tradeLoadAll)return!1;for(var e,t=common.isBlank(chatShowTrade.tradeForUser)?$("#showTradeDiv .scrollbox ul.sd_ul li").size():$(".pop_mysd .sd_list .sd_ul li").size(),i=chatShowTrade.tradeList,a=null,s=i.length,n="",o=common.isBlank(chatShowTrade.tradeForUser)?chatShowTrade.formatHtml("showTradeAll"):chatShowTrade.formatHtml("showTradeUser"),r=t;s>r&&t+20>r;r++)if(a=i[r],!($('#showTradeDiv .sd_ul li[sid="'+a._id+'"]').length>0&&common.isBlank(chatShowTrade.tradeForUser))){switch(a.status){case 1:e="";break;case 0:e=' class="checking"';break;case-1:e=' class="failed"'}var l=common.formatterDateTime(a.showDate,"/").substr(5,11);n+=common.isBlank(chatShowTrade.tradeForUser)?o.formatStr(a.title,a.user.userName,l,a.tradeImg,a.remark,common.isBlank(a.praise)?0:a.praise,a._id,a.user.userNo,a.user.avatar):o.formatStr(a.title,l,a.tradeImg,a.remark,common.isBlank(a.praise)?0:a.praise,a._id,e)}common.isBlank(chatShowTrade.tradeForUser)?($("#showTradeDiv .scrollbox ul.sd_ul li").removeClass("r"),$("#showTradeDiv .scrollbox ul.sd_ul").append(n),$("#showTradeDiv .scrollbox ul.sd_ul li:odd").addClass("r")):($(".pop_mysd .sd_list .sd_ul li").removeClass("r"),$(".pop_mysd .sd_list .sd_ul").append(n),$(".pop_mysd .sd_list .sd_ul li:odd").addClass("r")),r>=s-1&&(chatShowTrade.tradeLoadAll=!0),chatShowTrade.setUserShowTrade(),chatShowTrade.showTradePraise(),common.isBlank(chatShowTrade.tradeForUser)?indexJS.setListScroll("#showTradeDiv .scrollbox",null,{callbacks:{onTotalScroll:function(){chatShowTrade.setShowTrade()}}}):($(".pop_mysd .sd_list .scrollbox").height(340),indexJS.setListScroll(".pop_mysd .sd_list .scrollbox",null,{callbacks:{onTotalScroll:function(){chatShowTrade.setShowTrade()}}}))},setUserShowTrade:function(){$("#showTradeDiv .sd_ul li .sd_tit .dep a").unbind("click").click(function(){chatShowTrade.tradeForUser=$(this).attr("userId"),chatShowTrade.initShowTrade(),$(".pop_mysd .personal_info .headimg img").attr("src",$(this).attr("avatar")),$(".pop_mysd .personal_info .username").text($(this).text()),$(".pop_mysd .personal_info .infobar").addClass("dn"),common.openPopup(".pop_mysd,.blackbg")})},showTrade:function(){var e=$("#title").val(),t=$("#userName").val(),i=$("#tradeImg").val(),a=$("#remark").val();if(common.isBlank(e))$("#trade_error").text("请输入标题").show();else if(common.isBlank(t))$("#trade_error").text("请输入晒单人").show();else if(common.isRightName(t))if(common.isBlank(i))$("#trade_error").text("请上传晒单图片").show();else{var s={groupType:indexJS.userInfo.groupType,groupId:indexJS.userInfo.groupId,userNo:indexJS.userInfo.userId,avatar:$("#avatarInfoId").attr("src"),userName:t,tradeImg:i,remark:a,title:e,tradeType:2};common.getJson("/studio/addShowTrade",{data:JSON.stringify(s)},function(e){e.isOK?(box.showMsg("您的晒单已成功提交，等待系统审核！"),indexJS.userInfo.isSetName||($("#myNickName").val(t),$("#setNkBtn").click()),$(".pop_addsd").hide(),$('.pop_addsd input[type="text"],.pop_addsd textarea').empty()):box.showMsg(e.msg)})}else $("#trade_error").text("晒单人为2至10位字符(数字/英文/中文/下划线)，不能全数字!")},showTradePraise:function(){$("#showTradeDiv .scrollbox ul li .support,.pop_mysd .sd_list .sd_ul li .support").unbind("click").click(function(){var e=$(this),t={clientId:indexJS.userInfo.userId,praiseId:$(this).attr("id")};common.getJson("/studio/setTradePraise",{data:JSON.stringify(t)},function(t){if(t.isOK){var i=e.find("span");i.text(common.isValid(i.text())?parseInt(i.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");e.addClass("supported"),e.attr("title","已点赞")},!0)})},getPointsInfo:function(e){common.getJson("/studio/getPointsInfo",{params:JSON.stringify({groupType:indexJS.userInfo.groupType})},function(t){if(t){for(var i={},a={},s=indexJS.pointLevel.length-1;s>=0;s--){var n=indexJS.pointLevel[s];if(t.pointsGlobal>=n.points){i=n,a=indexJS.pointLevel[s+1];break}}$("#myLevel,#sdLevel").text(i.name),$(".personal_center .levelbar .progress b,.pop_mysd .levelbar .progress b").css("width",t.pointsGlobal/a.points*100+"%"),$(".personal_center .levelbar .le_detail,.pop_mysd .levelbar .le_detail").attr({pg:t.pointsGlobal,sendget:e}).text(t.pointsGlobal+"/"+a.points),$("#mypoints,#sdPoints").text(t.points);var o=[],r=[],l=chatShowTrade.formatHtml("getPoint"),c=chatShowTrade.formatHtml("pointConsume");$.each(t.journal,function(e,t){t.change>0?o.unshift(l.formatStr(common.formatterDate(t.date,"."),t.remark?t.remark+"，":"",t.change)):t.change<0&&r.unshift(c.formatStr(common.formatterDate(t.date,"."),t.remark?t.remark+"，":"",Math.abs(t.change)))}),$("#myPointsDetail .get .borbox table tbody").html(o.join("")),$("#myPointsDetail .consume .borbox table tbody").html(r.join("")),$("#myPointsDetail").css("height","280px"),indexJS.setListScroll($("#myPointsDetail"))}else $("#myLevel,#sdLevel").text("L0"),$(".personal_center .levelbar .progress b,.pop_mysd .levelbar .progress b").css("width","0%"),$(".personal_center .levelbar .le_detail,.pop_mysd .levelbar .le_detail").text("0/0"),$("#mypoints,#sdPoints").text("0")})},pushShowTradeInfo:function(e){for(var t="",i=chatShowTrade.formatHtml("showTradeAll"),a=null,s=null,n=chatShowTrade.formatHtml("pushShowTradeInfo"),o=0,r=e.length;r>o;o++){if(a=e[o],0==$('#showTradeDiv .sd_ul li[sid="'+a.id+'"]').length){var l=common.formatterDateTime(a.showDate.time,"/").substr(5,11);t+=i.formatStr(a.title,a.boUser.userName,l,a.tradeImg,a.remark,common.isBlank(a.praise)?0:a.praise,a.id,a.boUser.userNo,a.boUser.avatar),$("#showTradeDiv .scrollbox ul.sd_ul li").removeClass("r"),$("#showTradeDiv .scrollbox ul.sd_ul").prepend(t),$("#showTradeDiv .scrollbox ul.sd_ul li:odd").addClass("r"),indexJS.setListScroll("#showTradeDiv .scrollbox",null,{callbacks:{onTotalScroll:function(){chatShowTrade.setShowTrade()}}})}s=a.boUser.userName+"在晒单墙晒了一单，"+(common.isBlank(a.title)?"...":a.title),$("#chatMsgContentDiv .dialoglist").append(n.formatStr(s,a.id)),chat.showSystemTopInfo("showTrade",a.id,s)}chat.setTalkListScroll(!0),$("#chatMsgContentDiv .dialoglist .pushclose").unbind("click"),$("#chatMsgContentDiv .dialoglist .pushclose").click(function(){$(this).parent().hide()}),$("#chatMsgContentDiv .dialoglist .showtrade").unbind("click"),$("#chatMsgContentDiv .dialoglist .showtrade").click(function(){chatShowTrade.gotoLook($(this).attr("_id"))})},gotoLook:function(e){$('.main_tabnav a[t="showtrade"]').click(),common.isValid(e)&&indexJS.setListScroll("#showTradeDiv .scrollbox",$('#showTradeDiv .sd_ul li[sid="'+e+'"]').offset().top)},formatHtml:function(e){var t=[];switch(e){case"showTradeAll":t.push('<li sid="{6}">'),t.push('    <div class="cont">'),t.push('        <div class="sd_summary">{0}</div>'),t.push('        <div class="sd_tit">'),t.push('            <span class="dep">晒单人：<a href="javascript:void(0);" class="sd_author" userId="{7}" avatar="{8}">{1}</a></span>'),t.push('            <span class="sdtime">晒单时间: {2}</span>'),t.push("        </div>"),t.push('        <a href="{3}" data-rel="sd-img" data-title="{0}" data-lightbox="dialog-img">'),t.push('            <img src="{3}" alt="{0}" class="mCS_img_loaded"><i class="i-zoom"></i>'),t.push("        </a>"),t.push('        <p class="sd_p">{4}</p>'),t.push('        <div class="sd_bot">'),t.push('            <span class="from"><b>&nbsp;</b></span>'),t.push('            <a href="javascript:void(0)" class="support" id="{6}"><i></i>(<span>{5}</span>)</a>'),t.push("        </div>"),t.push("    </div>"),t.push("</li>");break;case"showTradeUser":t.push("<li{6}>"),t.push('    <div class="cont">'),t.push('        <div class="sd_summary">{0}<i class="status"></i></div>'),t.push('        <div class="sd_tit"><span class="sdtime">晒单时间: {1}</span></div>'),t.push('        <a href="{2}" data-rel="sd-img" data-title="{0}" data-lightbox="my-dialog-img"><img src="{2}" alt="{0}" class="mCS_img_loaded"><i class="i-zoom"></i></a>'),t.push('        <p class="sd_p">{3}</p>'),t.push('        <div class="sd_bot">'),t.push('          <span class="from"><b>&nbsp;</b></span>'),t.push('            <a href="javascript:void(0)" class="support" id="{5}"><i></i>(<span>{4}</span>)</a>'),t.push("        </div>"),t.push("    </div>"),t.push("</li>");break;case"getPoint":t.push("<tr>"),t.push('<td><span class="date">{0}</span></td>'),t.push("<td>{1}获得<b>{2}</b>积分</td>"),t.push("</tr>");break;case"pointConsume":t.push("<tr>"),t.push('<td><span class="date">{0}</span></td>'),t.push("<td>{1}消费<b>{2}</b>积分</td>"),t.push("</tr>");break;case"pushShowTradeInfo":t.push('<div class="info_push">'),t.push('    <div class="pushcont">系统：{0}</div>'),t.push("    <a href=\"javascript:void(0);\" class=\"detailbtn showtrade\" _id=\"{1}\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_lts_QuKankan', 'content_right', 1, true]);\">去看看</a>"),t.push('    <a href="javascript:void(0);" class="pushclose"><i></i></a>'),t.push("</div>")}return t.join("")}},noticeJS={socket:null,init:function(){this.showLastReview(),this.setSocket()},showLastReview:function(){$.getJSON("/studio/getLastReview",null,function(e){if(e&&e.comments&&e.comments.length>0){var t=e,i=t.comments[t.comments.length-1],a="",s=noticeJS.formatHtml("financeReview"),n=noticeJS.getNationalFlag(t.country),o="http://img.kgold852.com/public/economicCalenda/images/country/"+n+".png",r=noticeJS.getStar(t.importanceLevel),l=t.description.split("_"),c=noticeJS.getProfit(l[3]),d=common.isValid(t.predictValue)&&$.isNumeric(t.predictValue)?Number(t.predictValue.toString().match(/^\d+(?:\.\d{0,2})?/)):t.predictValue,u=common.isValid(t.lastValue)&&$.isNumeric(t.lastValue)?Number(t.lastValue.toString().match(/^\d+(?:\.\d{0,2})?/)):t.lastValue,p=common.isValid(t.value)&&$.isNumeric(t.value)?Number(t.value.toString().match(/^\d+(?:\.\d{0,2})?/)):t.value;a=s.formatStr(i.avatar,o,t.country,t.name,r,"none"==n?"":n,c,d,u,p,i.comment),$("#financeDataAndReview .comment").html(a),$("#financeDataAndReview").show(),indexJS.setListScroll($(".tabcont .main_tab .livebrief_list .scrollbox"))}else $("#financeDataAndReview").hide()})},setSocket:function(){this.socket=io.connect(indexJS.socketUrl.apiSocket),this.socket.on("connect",function(){console.log("connected to server!")}),this.socket.on("error",function(e){console.error("e:"+e)}),this.socket.on("disconnect",function(e){console.log("disconnect")}),this.socket.on("financeData",function(e){if(e&&e.finance&&!(e.finance.importanceLevel<4)&&e.review){var t=e.review,i=e.finance,a="",s="",n=noticeJS.formatHtml("financeData"),o=noticeJS.formatHtml("financeReview"),r=noticeJS.getNationalFlag(i.country),l="http://img.kgold852.com/public/economicCalenda/images/country/"+r+".png",c=noticeJS.getStar(i.importanceLevel),d=i.description.split("_"),u=noticeJS.getProfit(d[3]),p=common.isValid(i.predictValue)&&$.isNumeric(i.predictValue)?Number(i.predictValue.toString().match(/^\d+(?:\.\d{0,2})?/)):i.predictValue,h=common.isValid(i.lastValue)&&$.isNumeric(i.lastValue)?Number(i.lastValue.toString().match(/^\d+(?:\.\d{0,2})?/)):i.lastValue,m=common.isValid(i.value)&&$.isNumeric(i.value)?Number(i.value.toString().match(/^\d+(?:\.\d{0,2})?/)):i.value;a=n.formatStr(l,i.country,i.name,c,"none"==r?"":r,u,p,h,m),t?(s=o.formatStr(t.avatar,l,i.country,i.name,c,"none"==r?"":r,u,p,h,m,t.comment),$("#financeDataAndReview .comment").html(s),$("#financeDataAndReview").show(),$("#dialog_list").append('<div class="calendabox comment">'+s+"</div>"),indexJS.setListScroll($(".tabcont .main_tab .livebrief_list .scrollbox"))):$("#dialog_list").append('<div class="calendabox">'+a+"</div>"),chat.setTalkListScroll(!0),chat.showChatMsgNumTip(!1)}})},formatHtml:function(e){var t=[];switch(e){case"financeData":t.push('<div class="ca_cont">'),t.push('    <table class="ca_table" cellspacing="0" cellpadding="0" width="100%" border="0">'),t.push("        <tbody><tr>"),t.push('            <td rowspan="2">'),t.push('                <div class="ctbox">'),t.push('                    <div class="country"><img src="{0}" width="100%" alt="{1}" class="mCS_img_loaded"></div>'),t.push('                    <span class="zbname">{2}</span>'),t.push("                </div>"),t.push("            </td>"),t.push("            <td>"),t.push('                <div class="star">'),t.push("                    {3}"),t.push("                </div>"),t.push('                <div class="yx">'),t.push("                    <b>{4}</b>"),t.push("                    {5}"),t.push("                </div>"),t.push("            </td>"),t.push("        </tr>"),t.push("        <tr>"),t.push("            <td>"),t.push('                <span class="ca_value">前值：<b>{6}</b></span>'),t.push('                <span class="ca_value">预期值：<b>{7}</b></span>'),t.push('                <span class="ca_value">实际值：<b>{8}</b></span>'),t.push("            </td>"),t.push("        </tr>"),t.push("    </tbody></table>"),t.push("</div>");break;case"financeReview":t.push('<div class="ca_cont">'),t.push('    <div class="himgline">'),t.push('        <div class="himg"><img src="{0}" class="mCS_img_loaded"></div>'),t.push('        <table class="ca_table" cellspacing="0" cellpadding="0" width="100%" border="0">'),t.push("            <tbody><tr>"),t.push('                <td rowspan="2">'),t.push('                    <div class="ctbox">'),t.push('                        <div class="country"><img src="{1}" width="100%" alt="{2}" class="mCS_img_loaded"></div>'),t.push('                        <span class="zbname">{3}</span>'),t.push("                    </div>"),t.push("                </td>"),t.push("                <td>"),t.push('                    <div class="star">'),t.push("                        {4}"),t.push("                    </div>"),t.push('                    <div class="yx">'),t.push("                        <b>{5}</b>"),t.push("                        {6}"),t.push("                    </div>"),t.push("                </td>"),t.push("            </tr>"),t.push("            <tr>"),t.push("                <td>"),t.push('                    <span class="ca_value">前值：<b>{7}</b></span>'),t.push('                    <span class="ca_value">预期值：<b>{8}</b></span>'),t.push('                    <span class="ca_value">实际值：<b>{9}</b></span>'),t.push("                </td>"),t.push("            </tr>"),t.push("        </tbody></table>"),t.push("    </div>"),t.push('    <div class="commentline">'),t.push('        <span class="ctit">点评：</span>'),t.push('        <div class="comtext">{10}</div>'),t.push("    </div>"),t.push("</div>")}return t.join("")},getStar:function(e){var t=[];t.push('<i class="on">');for(var i=0;e>i;i++)t.push("★");t.push("</i>"),t.push("<i>");for(var i=e;5>i;i++)t.push("★");return t.push("</i>"),t.join("")},getProfit:function(e){var t=[];switch(e){case"GOOD":t.push('<span class="cz">利多</span>');break;case"BAD":t.push('<span class="cz c2">利空</span>');break;case"FLAT":t.push('<span class="cz c3">持平</span>')}return t.join("")},getNationalFlag:function(e){return"新西兰"==e?"NZD":"韩国"==e?"SK":"澳大利亚"==e?"AUD":"日本"==e?"JPY":"德国"==e?"Germany":"瑞士"==e?"CHF":"香港"==e?"HKD":"西班牙"==e?"Spain":"英国"==e?"GBP":"意大利"==e?"Italy":"加拿大"==e?"CAD":"美国"==e?"USD":"中国"==e?"CNY":"台湾"==e?"Taiwan":"印度"==e?"INR":"法国"==e?"France":"欧元区"==e?"EUR":"新加坡"==e?"Singapore":"none"}},indexTool={store:function(e,t){var i=LoginAuto.get(),a=null;return 1==arguments.length?a=i&&i[e]:i&&(i[e]=t,LoginAuto.set(i),a=t),a},Theme:{setTheme:function(e,t){e=e||"";var i=null;if(i="true"==$("#panel_theme").attr("ismin")?{pm_darkblue:"/pm/theme1/css/darkblue.min.css"}:{pm_darkblue:"/pm/theme1/css/darkblue.css"},i.hasOwnProperty(e)?LazyLoad.css(i[e],function(e){$("#panel_theme .sebox.on").removeClass("on"),$("#panel_theme .sk_item[theme='"+e+"'] .sebox").addClass("on"),$("head link[href='"+i[e]+"']").attr("theme",e)},e):($("#panel_theme .sebox.on").removeClass("on"),$("#panel_theme .sk_item[theme='pm_def'] .sebox").addClass("on"),$("head link[theme]").remove()),t&&common.isValid(indexJS.userInfo.userId)&&indexJS.userInfo.isLogin){var a={theme:"theme1",style:e||"pm_def"},s={defTemplate:JSON.stringify(a)};common.getJson("/studio/setThemeStyle",{data:JSON.stringify(s)},function(e){})}}},SimpleRoom:{countdown:{time:10,id:0},init:function(){var e=$("#roomInfoId").attr("rt");if(indexJS.userInfo.isLogin||"simple"==e){if("simple"==e&&($(".mod_main .main_tabnav a[t='chat']").trigger("click"),$(".mod_main .main_tabnav a[t='livepride'], .mod_main .tabcont .main_tab[t='livepride']").hide(),!indexJS.userInfo.isLogin)){var t=new Date(indexJS.serverTime);t=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime();var i=indexTool.store("guideTipTime");!i||t>i?this.showSimpleGuideTip("start"):this.showSimpleGuide(!0)}}else{var a=$("#roomInfoId").attr("lgt");/\d+(\.\d+)?/.test(a)&&(a=parseFloat(a),indexTool.store("simpleTip")?this.showSimpleTip(!0,a):window.setTimeout(function(){indexTool.store("simpleTip",!0),indexTool.SimpleRoom.showSimpleTip(!0,a)},6e4*a))}},showSimpleTip:function(e,t){e&&($("#pop_stTime").html(t||3),$("#pop_simpleTip .enteritem:first a").bind("click",function(){$("#login_a").trigger("click",{closeable:!1})}),$("#pop_simpleTip .enteritem.newbie a").bind("click",function(){$("#roomList_panel>a[rt='simple']:first").trigger("click")})),$("#pop_stCountdown").hide(),videos.player.play("type=blws&vid=28c30edf38841e1603a2f98ae61545fb_2","在线金道贵金属实盘直播室"),this.simpleTipCountdown(),$(".popup_box").hide(),common.openPopup(".blackbg,#pop_simpleTip")},simpleTipCountdown:function(){window.setTimeout(function(){indexTool.SimpleRoom.countdown={time:10,id:null},$("#pop_stCountdown span").html(indexTool.SimpleRoom.countdown.time),$("#pop_stCountdown").show(),indexTool.SimpleRoom.countdown.id=window.setInterval(function(){var e=indexTool.SimpleRoom.countdown;e.time--,e.time>0?$("#pop_stCountdown span").html(indexTool.SimpleRoom.countdown.time):(window.clearInterval(indexTool.SimpleRoom.countdown.id),indexTool.SimpleRoom.countdown.id=0,$("#roomList_panel>a[rt='simple']:first").trigger("click"))},1e3)},107e3)},showSimpleGuide:function(e){e&&$("#pop_simpleGuide .newbie_course li").bind("click",function(){$("#pop_simpleGuide").hide();var e=$(this).attr("vt");e&&$("#teachVideoId a[t='"+e+"']").trigger("click",[videosTeach.playTeachByUrlFunc,{url:$(this).attr("url"),title:$(this).text()}]),"connCs"==$(this).attr("t")&&$(".mod_infotab .tabnav .myaid").trigger("click")}),common.openPopup("#pop_simpleGuide")},showSimpleGuideTip:function(e){"start"==e?($("#pop_guideBg,#pop_guide").show(),$("#pop_guide .jumpbtn").bind("click",function(){indexTool.SimpleRoom.showSimpleGuideTip($(this).attr("step"))}),$("#pop_guideLogin").bind("click",function(){$("#pop_guideBg,#pop_guide").hide(),$("#login_a").trigger("click")}),$("#pop_guideReg").bind("click",function(){$("#pop_guideBg,#pop_guide").hide(),$("#register_a").trigger("click")}),indexTool.SimpleRoom.showSimpleGuideTip(-1),indexTool.store("guideTipTime",indexJS.serverTime)):"end"==e?($("#pop_guideBg,#pop_guide").hide(),indexTool.SimpleRoom.showSimpleGuide(!0)):$("#pop_guide .n_guide").each(function(t){t-1!=e?$(this).hide():$(this).show()})}},RedPacket:{config:{init:!1,cycleTime:3e5,stayTime:5e3,startTime:306e5,endTime:846e5,courseTime:-1,analysts:[{start:306e5,userId:"tonylee",userName:"李呱呱",wechat:"lee_24k",wechatImg:"https://chatfiles.kgold852.com/upload/pic/wechat/1_liguagua.png"},{start:34200001,userId:"tracey_jiang",userName:"陈丞",wechat:"chan24k",wechatImg:"https://chatfiles.kgold852.com/upload/pic/wechat/2_chencheng.png"},{start:41400001,userId:"joe_chung",userName:"钟文耀",wechat:"chung24k",wechatImg:"https://chatfiles.kgold852.com/upload/pic/wechat/3_zhongwenyao.png"},{start:48600001,userId:"joe_zhuang",userName:"庄蓝玉",wechat:"zhuang24k",wechatImg:"https://chatfiles.kgold852.com/upload/pic/wechat/4_zhuanglanyu.png"},{start:55800001,userId:"dan_yeh",userName:"叶航",wechat:"yehang24k",wechatImg:"https://chatfiles.kgold852.com/upload/pic/wechat/5_yehang.png"},{start:63000001,userId:"dusan_kao",userName:"高登",wechat:"kao_24k",wechatImg:"https://chatfiles.kgold852.com/upload/pic/wechat/6_gaodeng.png"},{start:70200001,userId:"eric_liu",userName:"刘策",wechat:"liu_gw24k",wechatImg:"https://chatfiles.kgold852.com/upload/pic/wechat/7_liuce.png"},{start:77400001,userId:"buck_chen",userName:"陈铎",wechat:"chen_gw24k",wechatImg:"https://chatfiles.kgold852.com/upload/pic/wechat/8_chendou.png"}],redPacketPopFlag:!0,miniClose:!1,opened:!1,times:0,minutes:0,seconds:0,timesLabel:"--",minutesLabel:"--",secondsLabel:"--",redPacketPeriods:0},init:function(){this.config.redPacketPopFlag=indexTool.store("redPacketPopFlag")!==!1,this.setEvent(),this.config.init=!0},setEvent:function(){$("#redPacket_header").bind("view",function(){var e=indexTool.RedPacket.config;$(this).find("[rp]").each(function(){$(this).text(e[$(this).attr("rp")])})}),$("#redPacket_mini").bind("view",function(){var e=indexTool.RedPacket.config;0==e.minutes&&e.times>0?($("#redPacket_mini [rp='timesLabel']").text(e.timesLabel),indexTool.RedPacket.isStayTime()?($("#redPacket_miniWait").hide(),$("#redPacket_miniRob").show()):indexTool.RedPacket.isCountDownTime()?($("#redPacket_mini [rp='seconds']").attr("class","t"+e.seconds).text(e.seconds),$("#redPacket_miniWait").show(),$("#redPacket_miniRob").hide()):$("#redPacket_mini").hide()):$("#redPacket_mini").hide()}),$("#redPacket_resYes").bind("view",function(e,t){$("#redPacket_resYes [rp='money']").html(t.money),$("#redPacket_resYes [rp='wechatImg']").attr("src",t.wechatImg)}),$("#redPacket_resNo").bind("view",function(e,t){$("#redPacket_resNo [rp='wechatImg']").attr("src",t.wechatImg)}),$("#redPacket_normal").bind("view",function(){var e=indexTool.RedPacket.config;$(this).find("[rp]").each(function(){$(this).text(e[$(this).attr("rp")])}),indexTool.RedPacket.isStayTime()?($("#redPacket_wait").hide(),$("#redPacket_rob").show()):($("#redPacket_wait").show(),$("#redPacket_rob").hide())}),$(".redbag_pop .pop_close").click(function(){$(this).parent().parent().hide(),$(this).parent().parent().hasClass("pop2")&&$(".redbag_pop_box").hide()}),$("#redPacket_mini .pop_close").bind("click",function(){var e=indexTool.RedPacket.config,t=!$("#redPacket_popFlag").prop("checked");e.redPacketPopFlag!=t&&(e.redPacketPopFlag=t,indexTool.store("redPacketPopFlag",t)),e.miniClose=!0}),$("#redPacket_normal .pop_close").bind("click",function(){indexTool.RedPacket.config.miniClose||!indexTool.RedPacket.isStayTime()&&!indexTool.RedPacket.isCountDownTime()||(indexTool.RedPacket.config.miniClose=!0)}),$("#redPacket_regBtn, #redPacket_regBtn2").bind("click",function(){$("#register_a").trigger("click")}),$("#redPacket_loginBtn").bind("click",function(){$("#login_a").trigger("click")}),$("#redPacket_header").bind("click",function(){indexTool.RedPacket.config.redPacketPopFlag||(indexTool.RedPacket.config.redPacketPopFlag=!0,indexTool.store("redPacketPopFlag",!0)),indexJS.userInfo.isLogin?indexTool.RedPacket.showPop("normal"):indexTool.RedPacket.showPop("noLogin")}),$("#redPacket_miniRob, #redPacket_rob").bind("click",function(){indexTool.RedPacket.config.opened||(indexTool.RedPacket.config.opened=!0,indexTool.RedPacket.rob())})},view:function(){var e=indexTool.RedPacket.config;$("#redPacket_header").trigger("view"),$("#redPacket_normal").is(":visible")?$("#redPacket_normal").trigger("view"):$("#redPacket_mini").is(":visible")?$("#redPacket_mini").trigger("view"):e.redPacketPopFlag&&(indexTool.RedPacket.isStayTime()||indexTool.RedPacket.isCountDownTime())&&(e.miniClose||indexTool.RedPacket.showPop("mini"))},showPop:function(e,t){var i=null;switch(e){case"noLogin":i=$("#redPacket_noLogin"),i.is(":visible")||($(".redbag_pop_box,.redbag_pop").hide(),i.css({opacity:0,left:"30%",top:"30%"}).show().animate({opacity:1,left:"50%",top:"50%"},300));break;case"mini":i=$("#redPacket_mini"),i.is(":visible")||(i.trigger("view"),$(".redbag_pop_box,.redbag_pop").hide(),i.show(),$("#redPacket_mini2").css({opacity:0,top:"-10%"}).show().animate({opacity:1,top:0},300));break;case"normal":i=$("#redPacket_normal"),i.is(":visible")||(i.trigger("view"),$(".redbag_pop_box,.redbag_pop").hide(),i.css({opacity:0,left:"30%",top:"30%"}).show().animate({opacity:1,left:"50%",top:"50%"},300));break;case"resNo":i=$("#redPacket_resNo"),i.is(":visible")||(i.trigger("view",t),$(".redbag_pop_box,.redbag_pop").hide(),i.css("opacity",0).show().animate({opacity:1},300));break;case"resYes":i=$("#redPacket_resYes"),i.is(":visible")||(i.trigger("view",t),$(".redbag_pop_box,.redbag_pop").hide(),i.css("opacity",0).show().animate({opacity:1},300))}},tick:function(){if(this.config.init){var e=this.config,t=indexJS.serverTime,i=new Date(t);i=new Date(i.getFullYear(),i.getMonth(),i.getDate()),t-=i.getTime(),indexTool.RedPacket.isStayTime()&&t-e.redPacketPeriods>=e.stayTime&&(e.miniClose=!1,e.redPacketPeriods=0),this.isRedPacketTime(function(i){if(i){e.times=Math.ceil((t-e.startTime)/e.cycleTime),e.timesLabel=e.times;var a=e.cycleTime-(t-e.startTime)%e.cycleTime;e.minutes=Math.floor(a/6e4),e.seconds=Math.floor(a%6e4/1e3),0==e.minutes&&0==e.seconds&&(e.redPacketPeriods=t,e.minutes=Math.floor(e.cycleTime/6e4),e.seconds=Math.floor(e.cycleTime%6e4/1e3)),e.minutesLabel=(e.minutes<10?"0":"")+e.minutes,e.secondsLabel=(e.seconds<10?"0":"")+e.seconds}else e.times=0,e.timesLabel="--",e.minutes=-1,e.minutesLabel="--",e.seconds=-1,e.minutesLabel="--",e.redPacketPeriods=0;indexTool.RedPacket.view()})}},initCourseTime:function(e){var t=this.config;return-2==t.courseTime||-1!=t.courseTime&&t.courseTime>indexJS.serverTime?void e(t.courseTime):void $.getJSON(indexJS.apiUrl+"/common/getCourse",{platform:"web24k",flag:"S"},function(t){0==t.result&&(t.data&&0!=t.data.length?indexTool.RedPacket.config.courseTime=t.data[0].date+864e5-1:indexTool.RedPacket.config.courseTime=-2,e(indexTool.RedPacket.config.courseTime))})},isStayTime:function(){return 0!=indexTool.RedPacket.config.redPacketPeriods},isCountDownTime:function(){return 0==indexTool.RedPacket.config.minutes&&indexTool.RedPacket.config.seconds<=5},isRedPacketTime:function(e){var t=new Date(indexJS.serverTime);t=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime();
var i=indexJS.serverTime-t;return i<=this.config.startTime||i>this.config.endTime?void e(!1):void this.initCourseTime(function(i){e(t+864e5-1==i)})},rob:function(){var e=indexTool.RedPacket.config;indexJS.userInfo.isLogin?0==e.redPacketPeriods?box.showMsg("红包已过期!"):common.getJson("/studio/rob",{t:indexJS.serverTime},function(e){if(0==e.result){indexTool.RedPacket.config.redPacketPeriods=0;var t=indexTool.RedPacket.getAnalyst();e.money>0?indexTool.RedPacket.showPop("resYes",{money:e.money,wechatImg:t.wechatImg}):indexTool.RedPacket.showPop("resNo",{wechatImg:t.wechatImg})}else chat.socket.emit("serverTime"),box.showMsg(e.msg||"红包信息异常!");indexTool.RedPacket.config.opened=!1}):this.showPop("noLogin")},getAnalyst:function(){var e=new Date(indexJS.serverTime);e=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();for(var t=indexJS.serverTime-e,i=indexTool.RedPacket.config.analysts,a=null,s=i.length-1;s>0&&(a=i[s],!(a.start<=t));s--);return a}}};