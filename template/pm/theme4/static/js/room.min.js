function UUID(){this.id=this.createUUID()}function openLive800Chat(t){var e="https://www.onlineservice-hk.com/k800/chatClient/chatbox.jsp?companyID=209&s=1";t?location.href=e:window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonv3(t,e){common.isBlank(e)&&(e="800018282");var i="http://crm2.qq.com/page/portalpage/wpa.php?uin="+e+"&cref=&ref=&f=1&ty=1&ap=&as="+t;window.open(i,"QQChatindow","height=544, width=644,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonjs(){var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018282";window.open(t)}function live800Prompt(t){window.onbeforeunload=null;var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886",i="http://onlinecustomer-service.gwghk.com/live800/chatClient/chatbox.jsp?companyID=283&enterurl=http%3A%2F%2Fwww%2Egwfx%2Ecom%2F&tm=1355377642406";if(2==t)try{UUID.prototype.createUUID();window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(o){window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}else try{UUID.prototype.createUUID();window.open(i,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(o){window.open(i)}}function qqPrompt(t){var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886";window.onbeforeunload=null;try{var i=UUID.prototype.createUUID();getGacookiesTrack(i,"2","1"),window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(o){window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}}var _gaq=_gaq||[],_hmt=_hmt||[];UUID.prototype.valueOf=function(){return this.id},UUID.prototype.toString=function(){return this.id},UUID.prototype.createUUID=function(t){var e=new Date(1582,10,15,0,0,0,0),i=new Date,o=i.getTime()-e.getTime(),s=UUID.getIntegerBits(o,0,31),a=UUID.getIntegerBits(o,32,47),r=UUID.getIntegerBits(o,48,59)+"1",n=UUID.getIntegerBits(UUID.rand(4095),0,7),u=UUID.getIntegerBits(UUID.rand(4095),0,7),l=UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,15);return(t||"")+s+a+r+n+u+l},UUID.getIntegerBits=function(t,e,i){var o=UUID.returnBase(t,16),s=new Array,a="",r=0;for(r=0;r<o.length;r++)s.push(o.substring(r,r+1));for(r=Math.floor(e/4);r<=Math.floor(i/4);r++)a+=s[r]&&""!=s[r]?s[r]:"0";return a},UUID.returnBase=function(t,e){return t.toString(e).toUpperCase()},UUID.rand=function(t){return Math.floor(Math.random()*(t+1))};var chatAnalyze={localHref:window.location.href,utmStore:{userIp:"",storeKey:"GWAFLGPHONECOOIKETRACK",userId:"",roomId:"",userTel:"",userType:"",userName:"",roomName:"",userSource:"web",useEquipment:"",tradingAccount:"",tradingPlatform:"",platformType:0,businessPlatform:"",operateEntrance:"",operationType:2,touristId:"",sessionId:"",nickName:"",email:"",videoId:"",videoName:"",courseId:"",courseName:"",teacherId:"",teacherName:""},isLocalHref:function(){return/^https?:\/\/(\d{1,3}\.){3}\d{1,3}.+/.test(chatAnalyze.localHref)},init:function(){if(!this.isLocalHref()){var t="";-1!=chatAnalyze.localHref.indexOf("/studio")?t="studio":-1!=chatAnalyze.localHref.indexOf("/fxstudio")?t="fxstudio":-1!=chatAnalyze.localHref.indexOf("/hxstudio")&&(t="hxstudio"),""!=t&&(this.initGA(t),this.setGA(),this.setBaidu())}},initGA:function(t){"studio"==t&&(_gaq.push(["_setAccount","UA-31478987-1"]),_gaq.push(["_setDomainName","24k.hk"]),_gaq.push(["_addIgnoredRef","24k.hk"])),"fxstudio"==t&&(_gaq.push(["_setAccount","UA-49389835-1"]),_gaq.push(["_setDomainName","gwfx.com"]),_gaq.push(["_addIgnoredRef","gwfx.com"])),"hxstudio"==t&&(_gaq.push(["_setAccount",""]),_gaq.push(["_setDomainName","handan.hx9999"]),_gaq.push(["_addIgnoredRef","handan.hx9999"])),_gaq.push(["_setAllowLinker",!0]),_gaq.push(["_addOrganic","soso","w"]),_gaq.push(["_addOrganic","sogou","query"]),_gaq.push(["_addOrganic","youdao","q"]),_gaq.push(["_addOrganic","baidu","word"]),_gaq.push(["_addOrganic","baidu","q1"]),_gaq.push(["_addOrganic","ucweb","keyword"]),_gaq.push(["_addOrganic","ucweb","word"]),_gaq.push(["_addOrganic","114so","kw"]),_gaq.push(["_addOrganic","360","q"]),_gaq.push(["_addOrganic","so","q"]),_gaq.push(["_trackPageview"])},setGA:function(){try{var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}catch(i){console.log("Set GA fail!"+i)}},setBaidu:function(){try{var t=document.createElement("script");t.src="//hm.baidu.com/hm.js?52a2828b884f1a2ba8a3e25efe98eb65";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}catch(i){console.log("Set GA fail!"+i)}},getIp:function(t){$.getJSON("https://oa.24k.hk/ajax/getIp?callback=ip&_="+Math.random(),function(e){chatAnalyze.utmStore.userIp=e.Ip,t&&t()})},getUTMCookie:function(){for(var t=document.cookie,e=t.split(/[;&]/),i=0;i<e.length;i++){var o=e[i].split("=");if($.trim(o[0])==this.utmStore.storeKey)return o[1]}var s=document.domain;$.inArray(s,["pmchat.24k.hk","chat.gwfx.com","handan.hx9999.com"])>-1&&(-1!=chatAnalyze.localHref.indexOf("/studio")?s=".24k.hk":-1!=chatAnalyze.localHref.indexOf("/fxstudio")&&(s=".gwfx.com"));var a=UUID.prototype.createUUID(-1!=s.indexOf("gwfx")?"":"G");return document.cookie=this.utmStore.storeKey+"="+escape(a)+"; expires=Tue, 31 Dec 2030 00:00:00 UTC; path=/;domain="+s,a},setUTM:function(t,e){try{if(t)this.utmStore.roomId=e.groupId,this.utmStore.userId=e.userId,this.utmStore.userTel=e.userTel,this.utmStore.clientGroup=e.clientGroup,this.utmStore.groupType=e.groupType,$(window).unload(function(){chatAnalyze.utmStore.onlineETM=(new Date).getTime(),window.event.returnValue=!0});else if(chatAnalyze.utmStore.userId=chatAnalyze.getUTMCookie(),chatAnalyze.utmStore.userType=chatAnalyze.getClientGroup(e.clientGroup),chatAnalyze.utmStore.businessPlatform=chatAnalyze.getGroupType(e.groupType),chatAnalyze.utmStore.roomId=e.groupId,chatAnalyze.utmStore.userTel=e.mobile,chatAnalyze.utmStore.userName=e.userName,chatAnalyze.utmStore.roomName=e.roomName,chatAnalyze.utmStore.platformType=common.isMobile(navigator.userAgent)?1:0,chatAnalyze.utmStore.touristId=e.visitorId,chatAnalyze.utmStore.sessionId=e.sid,chatAnalyze.utmStore.nickName=e.nickname,chatAnalyze.utmStore.email=e.email,chatAnalyze.utmStore.useEquipment=navigator.userAgent,chatAnalyze.utmStore.operateEntrance=common.isBlank(common.getUrlParam("platform"))?"web":common.getUrlParam("platform"),chatAnalyze.utmStore.courseId=e.courseId||"",chatAnalyze.utmStore.courseName=e.courseName,chatAnalyze.utmStore.teacherId=e.lecturerId||"",chatAnalyze.utmStore.teacherName=e.lecturer||"",i?chatAnalyze.utmStore.userIp=e.ip:this.getIp(),chatAnalyze.utmStore.operationType=e.operationType,chatAnalyze.utmStore.tradingAccount=e.accountNo||"",e&&7==e.operationType&&(chatAnalyze.utmStore.videoId=e.videoId,chatAnalyze.utmStore.videoName=e.videoName),e=chatAnalyze.utmStore,common.isValid(e.sessionId)&&common.isValid(e.userId)&&(common.isValid(e.touristId)||common.isValid(e.userTel))&&common.isValid(e.operationType)){var i=this.isLocalHref(),o=i?"http://testweboa.gwfx.com:8088/GwUserTrackingManager_NEW/put/insertRoom":"https://das.gwfx.com/put/insertRoom";chatAnalyze.utmAjax(o,e,!0)}}catch(s){console.log("Set UTM fail!"+s)}},utmAjax:function(t,e,i){$.post(t,{data:JSON.stringify(e),callback:"?"},function(t){})},sendUTM:function(t){return!1},getClientGroup:function(t){var e=1;switch(t){case"visitor":e=1;break;case"register":e=2;break;case"simulate":e=3;break;case"active":e=4;break;case"notActive":e=5;break;case"vip":e=6;break;case"analyst":e=7;break;case"admin":e=8;break;case"cs":e=9;break;default:e=1}return e},getGroupType:function(t){var e=1;return e=/^fx/.test(t)?1:/^hx/.test(t)?3:2}};$(function(){chatAnalyze.init()});var common={daysCN:{0:"星期天",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},clientGroupStr:{vip:"VIP会员",active:"激活会员",notActive:"真实会员",simulate:"模拟会员",register:"注册会员",visitor:"游客"},remove:function(t,e){return isNaN(e)||e>t.length?!1:void t.splice(e,1)},joinSplit:function(t){return",".concat(t).concat(",")},isBlank:function(t){return void 0==t||null==t||"undefined"==t||"null"==t||""==$.trim(t)},isValid:function(t){return!this.isBlank(t)},trim:function(t){return this.isBlank(t)?"":t.toString().replace(/(^\s*)|(\s*$)/g,"")},escapeHtml:function(t){return document.createElement("div").appendChild(document.createTextNode(t)).parentNode.innerHTML.replace(/"/g,'\\"')},encodeHtml:function(t){return this.isBlank(t)?"":t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},formatterDate:function(t,e){e||(e="-"),t instanceof Date||(t=new Date(t));var i=t.getFullYear()+e+(t.getMonth()+1>=10?t.getMonth()+1:"0"+(t.getMonth()+1))+e+(t.getDate()<10?"0"+t.getDate():t.getDate());return i},getHHMMSS:function(t){t instanceof Date||(t=new Date(t));var e=(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds());return e},getMMSS:function(t){return t instanceof Date||(t=new Date(t)),(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())},getHHMM:function(t){t instanceof Date||(t=new Date(t));var e=(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes());return e},formatterDateTime:function(t,e){if(e||(e="-"),t instanceof Date||(t=new Date(t)),"Invalid Date"==t)return"";var i=t.getFullYear()+e+(t.getMonth()+1>=10?t.getMonth()+1:"0"+(t.getMonth()+1))+e+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds());return i},longMsTimeToDateTime:function(t,e){var i=new Date(t);return this.formatterDateTime(i,e)},getDaysInMonth:function(t){var e=new Date(t.getFullYear(),t.getMonth()+1,1),i=Math.floor((e.getTime()-t.getTime())/864e5)+t.getDate()-1;return i},showBox:function(t,e){$(t).slideDown(),$(e||".layer-shadow").show()},hideBox:function(t,e){$(t).slideUp(),$(e||".layer-shadow").hide()},containSplitStr:function(t,e){return common.isBlank(t)||common.isBlank(e)?!1:-1!=(","+t+",").indexOf(","+e+",")},getJson:function(t,e,i,o,s){var a=null;return $.ajax({url:t,type:"POST",timeout:1e5,cache:!1,async:void 0!=o?o:i?!0:!1,dataType:"json",data:e,success:"function"==typeof i?i:function(t){a=t},error:function(e,i){"function"==typeof s?s(i):common.isValid(e.responseText)&&"OK"!=e.statusText?console.error(e.responseText):console.error("请求超时,请重试:url[%s]",t)}}),a},arraySort:function(t,e){return function(i,o){return e?i[t]<o[t]:i[t]>o[t]}},randomNumber:function(t){for(var e="",i=0;t>i;i++)e+=Math.floor(10*Math.random());return e},isMobilePhone:function(t){return/(^[0-9]{11})$|(^86(-){0,3}[0-9]{11})$/.test(t)},dateTimeWeekCheck:function(t,e,i){if(this.isBlank(t))return!!e;$.isPlainObject(t)||(t=JSON.parse(t));var o=i?new Date(i):new Date,s=!1,a=this.formatterDate(o);if(s=this.isBlank(t.beginDate)||a>=t.beginDate,s&&(s=this.isBlank(t.endDate)||a<=t.endDate),!s)return!1;var r=t.weekTime;if(this.isBlank(r))return s;var n=null,u=null,l=!1;for(var d in r)if(n=r[d],(!this.isValid(n.week)||o.getDay()==parseInt(n.week))&&(u=this.getHHMMSS(o),l=this.isBlank(n.beginTime)||u>=n.beginTime,l&&(l=this.isBlank(n.endTime)||u<=n.endTime),l))break;return l},arrayUnique:function(t){if(!t)return t;for(var e,i=[],o={},s=0;null!=(e=t[s]);s++)o[e]||(i.push(e),o[e]=!0);return i},isWebSocket:function(){return window.WebSocket},getSocket:function(t,e,i){return common.isWebSocket()?(console.log("used websocket!"),t.connect(e.webSocket+"/"+i,{transports:["websocket"]})):t.connect(e.socketIO+"/"+i)},randomNumber:function(t){for(var e="",i=0;t>i;i++)e+=Math.floor(10*Math.random());return e},clearMsgHtml:function(t){var t=t.replace(/((^((&nbsp;)+))|\n|\t|\r)/g,"").replace(/<\/?(?!(img|IMG)\s+src="[^>"]+\/face\/[^>"]+"\s*>)[^>]*>/g,"");return t&&(t=$.trim(t)),t},formatToJson:function(t){return this.isBlank(t)?null:JSON.parse(t)},getSyllabusPlan:function(t,e,i,o){if(!t||!t.courses)return null;var s=function(t,e){if(t&&3!=e){var s,a=common.isMobile();"object"!=typeof t&&(t=JSON.parse(t));for(var r in t)if(s=t[r],a){if(1==e&&(!i&&3==s.code||i&&4==s.code))return s.url}else if(o){if(1==e&&3==s.code){var n=s.url||"";return n=n.replace(/^http:/,"rtmps:").replace(/\/index\.m3u8$/,"")}}else if(s.code==e)return s.url}return null},a=function(e,i,o){var a=null,r=e.course;return r&&r.length>i?(a=r[i],0==a.status||common.isBlank(a.lecturerId)?null:(a.studioLink=s(t.studioLink,a.courseType),a.startTime=e.startTime,a.endTime=e.endTime,a.day=u[i].day,a.isNext=o,a)):null},r=null;r=this.isValid(t.courses)&&"object"!=typeof t.courses?JSON.parse(t.courses):t.courses;for(var n,u=r.days,l=r.timeBuckets,d=(new Date(e).getDay()+6)%7,c=common.getHHMM(e),h=null,p=null,m=0;m<u.length;m++)if(0!=u[m].status)if(n=(u[m].day+6)%7,n>d){for(var f in l)if(h=l[f],p=a(h,m,!0))return p}else if(n==d)for(var f in l)if(h=l[f],h.startTime<=c&&(h.endTime>=c||"00:00"==h.endTime)?p=a(h,m,!1):h.startTime>c&&(p=a(h,m,!0)),p)return p;if(!t.publishEnd)return null;for(var m=0;m<u.length;m++)if(0!=u[m].status&&(n=(u[m].day+6)%7,!(t.publishEnd<864e5*(n+7-d)+e)))for(var f=0;f<l.length;f++)if(p=a(l[f],m,!0))return p;return null},formatSyllabus:function(t,e,i,o){var s={dayCN:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],indexCN:["第一节","第二节","第三节","第四节","第五节","第六节","第七节","第八节"],courseCls:["prev","ing","next"],tableCls:"syllabus",courseType:{0:"文字在线",1:"视频在线",2:"ONE TV"}},a=new Date(e).getDay(),r=this.getHHMM(e),n=$.extend({},s,o),u=function(t,e,i,o){var s=0,u=(t+6)%7,l=(a+6)%7;return s=u>l?2:l>u?0:o?1:r>=i?0:e>r?2:1,n.courseCls[s]},l=[];try{if(t){var d=$.isPlainObject(t)?t:JSON.parse(t),c=d.days?d.days.length:0;if(c>0)if(1===i){var h={0:"文字",1:"视频",2:"oneTV"};l.push('<div class="sy_panel">');var p=e-864e5*((a+6)%7),m=null,f=null,g=null;l.push('<div class="sy_nav">');for(var b=' style="width:'+100/c+'%;"',v=0;c>v;v++)m=new Date(p+(d.days[v].day+6)%7*864e5),f=m.getFullYear()+"-"+(m.getMonth()<9?"0":"")+(m.getMonth()+1)+"-"+(m.getDate()<10?"0":"")+m.getDate(),g=d.days[v].day==a?' class="active"':"",l.push('<a href="javascript:void(0)" d="'+d.days[v].day+'"'+g+b+">"+n.dayCN[d.days[v].day]+"<br/><span>"+f+'</span><em class="dir">^</em></a>');l.push("</div>"),l.push('<div class="sy_cont"><div>'),l.push('<table cellpadding="0" cellspacing="0" border="0" class="'+n.tableCls+'">');for(var w=null,T=null,v=0;c>v;v++){if(l.push('<tbody d="'+d.days[v].day+'">'),0==d.days[v].status)T=u(d.days[v].day,null,null,!0),l.push('<tr class="'+T+'" width="100%"><td>休市</td></tr>');else for(var C=0,y=d.timeBuckets.length;y>C;C++)w=d.timeBuckets[C],T=u(d.days[v].day,w.startTime,w.endTime,!1),0==w.course[v].status?(l.push('<tr class="'+T+'">'),l.push('<td width="25%">'+w.startTime+"-"+w.endTime+"</td>"),l.push('<td colspan="2" width="75%">休市</td>'),l.push("</tr>")):w.course[v].lecturer&&(l.push('<tr class="'+T+'">'),l.push('<td width="25%">'+w.startTime+"-"+w.endTime+"【"+h[w.course[v].courseType]+"】</td>"),l.push('<td width="25%">'+w.course[v].lecturer+"</td>"),l.push('<td width="50%">'+w.course[v].title+"</td>"),l.push("</tr>"));l.push("</tbody>")}l.push("</table>"),l.push("</div></div>"),l.push("</div>")}else if(2===i){l.push('<table cellpadding="0" cellspacing="1" border="0" class="'+n.tableCls+'">'),l.push("<tr>"),l.push("<th>星期\\节次</th>");for(var y=d.timeBuckets?d.timeBuckets.length:0,w=null,T=null,C=0;y>C;C++)w=d.timeBuckets[C],l.push("<th>"+n.indexCN[C]+"<br><span>("+w.startTime+"-"+w.endTime+")</span></th>");l.push("</tr>");for(var M=null,v=0,I=d.days?d.days.length:0;I>v;v++){if(M=d.days[v],l.push("<tr>"),l.push("<th>"+n.dayCN[M.day]+"</th>"),0==M.status)T=u(M.day,null,null,!0),l.push('<td class="'+T+'" colspan="'+y+'">休市</td>');else for(var C=0;y>C;C++)w=d.timeBuckets[C],T=u(M.day,w.startTime,w.endTime,!1),l.push('<td class="'+T+'">'+(0==w.course[v].status?"休市":w.course[v].lecturer)+"</td>");l.push("</tr>")}l.push("</table>")}else if(3===i){var p=r-864e5*((a+6)%7),m=null,g=null,M=null,b=' style="width:'+100/c+'%;"';l.push("<tr>");for(var v=0;c>v;v++)M=d.days[v],m=new Date(p+(d.days[v].day+6)%7*864e5),g=d.days[v].day==a?' class="active"':"",l.push('<th d="'+d.days[v].day+'"'+g+b+">"+n.dayCN[d.days[v].day]+"<i></i></th>");l.push("</tr>"),l.push('<tr><td class="space" colspan="'+c+'"></td></tr>');for(var w=null,T=null,v=0;c>v;v++){if(M=d.days[v],l.push('<tr d="'+M.day+'"><td colspan="'+c+'">'),0==M.status)T=u(M.day,null,null,!0),l.push('<p class="'+T+'">休市</p>');else for(var C=0,y=d.timeBuckets?d.timeBuckets.length:0;y>C;C++)w=d.timeBuckets[C],w.course[v].lecturer&&(T=u(M.day,w.startTime,w.endTime,!1),l.push('<p class="'+T+'">'),l.push("<span>"+w.startTime+"-"+w.endTime+"</span>"),0==w.course[v].status?l.push("<span>休市</span>"):(l.push("<span>"+n.courseType[w.course[v].courseType]+"</span>"),l.push("<span>"+w.course[v].lecturer+"</span>"),l.push('<span class="item">'+w.course[v].title+"</span>")),l.push("</p>"));l.push("</td></tr>")}}}}catch(k){return console.error("formatSyllabus->"+k),""}return l.join("")},isMobile:function(){return/(iphone|ipod|ipad|android|mobile|playbook|bb10|meego)/.test(navigator.userAgent.toLowerCase())},isHTTPS:function(){return/^https:\/\//.test(location.href)},copyObject:function(t,e,i){if(!e)return t;for(var o in t)e.hasOwnProperty(o)&&common.isValid(e[o])&&(t[o]=e[o]);if(i)for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])},isRightName:function(t){return!/^([0-9]{2,10})$/g.test(t)&&/^([\w\u4e00-\u9fa5]{2,10})$/g.test(t)},randomIndex:function(t){var e=parseInt(Math.round(Math.random()*t));return e==t&&(e=t-1),0>e?0:e},saveToDesktop:function(t,e){try{var i=new ActiveXObject("WScript.Shell"),o=i.CreateShortcut(i.SpecialFolders("Desktop")+"\\"+e+".url");o.TargetPath=t,o.Save()}catch(s){return!1}return!0},getUrlParam:function(t,e){var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),o=window.location.search.substr(1).match(i);if(e){if(null!=o)return o[2]}else if(null!=o)return unescape(o[2]);return null},keysrt:function(t,e){return function(i,o){return e?~~(i[t]<o[t]):~~(i[t]>o[t])}},newsMarquee:function(t,e,i,o,s,a,r){t&&(clearInterval(t),t=null);var n="object"==typeof i?i:$(i),u="object"==typeof o?o[0]:$(o)[0],l="object"==typeof s?s:$(s),d="object"==typeof a?a:$(a);if(r&&l.children().size()>0?n.show():n.hide(),d.html(""),$(u).unbind("mouseover mouseout"),r){l.css("width","auto"),d.css("width","auto");var c=n.width()-27;l.width()<c&&(l.css("width",c),d.css("width",c)),d.html(l.html());var h=function(){l.width()-u.scrollLeft<=0?u.scrollLeft-=l.width():u.scrollLeft++};t=window.setInterval(h,e),$(u).bind("mouseover",function(){window.clearInterval(t),t=null}).bind("mouseout",function(){t&&(window.clearInterval(t),t=null),t=window.setInterval(h,e)})}},placeholderSupport:function(t){t="object"==typeof t?t:$(t);var e="placeholder"in document.createElement("input");e||t.each(function(){var t=$(this).attr("placeholder");if(t){var e=$(this),i=$('<span class="placeholder">'+t+"</span>");e.before(i),i.bind("click",function(){$(this).hide(),$(this).next().focus()}),e.bind("focus",function(){$(this).prev().hide()}),e.bind("blur",function(){""===$(this).val()&&$(this).prev().show()}),""!=e[0].defaultValue&&e.prev().hide(),$(this).attr("placeholder","")}})},openPopup:function(t){t="object"==typeof t?t:$(t),t.show()},isEmail:function(t){return/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(t)},getDateDiff:function(t,e){var i=new Date(t).getTime(),o=new Date(e).getTime(),s=Math.abs(i-o)/864e5;return s},getHourDiff:function(t,e){var i=new Date(t).getTime(),o=new Date(e).getTime(),s=Math.abs(i-o)/36e5;return s=Math.floor(s)},getMinuteDiff:function(t,e){var i=new Date(t).getTime(),o=new Date(e).getTime(),s=Math.abs(i-o)/6e4;return s=Math.floor(s)},addDate:function(t,e){var i=new Date(t);i.setDate(i.getDate()+e);var o=i.getMonth()+1;return i.getFullYear()+"-"+o+"-"+i.getDate()}};window.console||(console=function(){function t(){}function e(){return null==i&&(i=new t),i}var i=null;return t.prototype={log:function(t){},error:function(t){}},e()}()),$.fn.focusEnd=function(){$(this).focus();var t=$("<span/>").appendTo($(this)),e=t.get(0),i=null,o=null;return document.selection?(i=document.body.createTextRange(),i.moveToElementText(e),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e),o=window.getSelection(),o.removeAllRanges(),o.addRange(i)),t.remove(),this},String.prototype.formatStr=function(){if(0==arguments.length)return this;for(var t=this,e=0;e<arguments.length;e++)t=t.replace(new RegExp("\\{"+e+"\\}","g"),null==arguments[e]||void 0==arguments[e]?"":arguments[e]);return t};var studioChatMb={initSewise:!1,web24kPath:"",filePath:"",apiUrl:"",currStudioAuth:!1,visitorSpeak:!1,options:null,serverTime:0,pushObj:{talkPush:[],whInfos:[]},msgType:{text:"text",img:"img",file:"file"},socket:null,socketUrl:"",userInfo:null,init:function(){this.serverTimeUp(),this.setVisitStore(),this.whTalk.initWH(),this.initTimezone(),this.setSocket(),this.setEvent(),this.setVideoList(),studioMbPop.load(this.userInfo,this.options,{onShow:function(){$("#tVideoDiv video,#tVideoDiv iframe").hide()},onHide:function(){$("#tVideoDiv video,#tVideoDiv iframe").show()}}),this.initRoom()},initRoom:function(){if(this.userInfo.nickname||this.refreshNickname(!1,"匿名_"+this.userInfo.userId.substring(8,12)),"visitor"==this.userInfo.clientGroup){var t=$("#currStudioInfo").attr("lgt");if(common.isValid(t)&&!isNaN(t))if(this.currStudioAuth)if(studioMbPop.Login.forceLogin())studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientGroup:studioChatMb.userInfo.clientGroup,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.options.platform,closeable:!1,showTip:!0});else try{t=parseInt(t),window.setTimeout(function(){"visitor"==studioChatMb.userInfo.clientGroup&&(studioMbPop.Login.forceLogin(!0),studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientGroup:studioChatMb.userInfo.clientGroup,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.options.platform,closeable:!1,showTip:!0}))},60*t*1e3)}catch(e){console.error("set login Time has error",e)}else studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientGroup:studioChatMb.userInfo.clientGroup,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.options.platform,closeable:!1})}},initTimezone:function(){var t=studioChatMb.options.timezone;try{t=parseInt(t,10)||0}catch(e){t=0}studioChatMb.options.timezone=t,studioChatMb.options.timezoneLs=36e5*(t-8)},refreshNickname:function(t,e){this.userInfo.isSetName=t,this.userInfo.nickname=e,$("#header_ui").text(e),studioMbPop.Person.refreshNickname(e)},serverTimeUp:function(){setInterval(function(){studioChatMb.serverTime+=1e3,studioChatMb.setPushInfo(),studioChatMb.courseTick.tick()},1e3)},setVisitStore:function(){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var t="storeInfos_"+this.userInfo.groupType,e=store.get(t),i={};if(common.isBlank(e)){var o=common.randomNumber(8);i.clientStoreId=(new Date).getTime()+"_"+o,i.userId="visitor_"+o,i.nickname="游客_"+o,i.userType=-1,store.set(t,i),$(".collect-tip").fadeIn().delay(6e4).fadeOut()}else i=e;this.userInfo.clientStoreId=i.clientStoreId,this.userInfo.visitorId=i.userId,this.userInfo.loginId=i.loginId,this.userInfo.clientGroup&&"visitor"==this.userInfo.clientGroup?(this.userInfo.nickname=i.nickname,this.userInfo.userId=i.userId,this.visitorSpeak||($("#contentText").attr("contenteditable",!1).append('<span style="margin:15px 5px;">亲，<a id="contentText_login" href="javascript:void(0);" style="text-decoration: underline;color:#3F51B5;cursor: pointer;">登录</a>&nbsp;&nbsp;后可以发言哦~</span>'),$("#contentText_login").click(function(){studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.options.platform})}))):(i.loginId=this.userInfo.userId,store.set(t,i)),this.isNeverLogin=!common.isValid(i.loginId)},setSocket:function(){studioMbPop.loadingBlock($("#talkBoxTab")),this.socket=common.getSocket(io,this.socketUrl,this.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),studioChatMb.userInfo.socketId=studioChatMb.socket.id;var t="",e="";common.isValid(studioChatMb.courseTick.course)&&(t=studioChatMb.courseTick.course.courseId,e=studioChatMb.courseTick.course.courseName),studioChatMb.socket.emit("login",{courseId:t,courseName:e,cookieId:chatAnalyze.getUTMCookie(),userName:studioChatMb.userInfo.userName,roomName:studioChatMb.userInfo.roomName,email:studioChatMb.userInfo.email,userInfo:studioChatMb.userInfo,lastPublishTime:$("#dialog_list>li:last").attr("id"),fromPlatform:studioChatMb.options.platform,allowWhisper:studioChatMb.whTalk.enable},navigator.userAgent)}),this.socket.on("onlineUserList",function(t,e){for(var i in t)studioChatMb.whTalk.enable&&3==t[i].userType&&studioChatMb.whTalk.setCSOnline(t[i].userId,!0),(3==t[i].userType||2==t[i].userType)&&studioChatMb.setFastContact(t[i],!0);studioChatMb.whTalk.enable&&studioChatMb.whTalk.getCSList()}),this.socket.on("disconnect",function(){console.log("disconnect")}),this.socket.on("error",function(t){console.error("e:"+t)}),this.socket.on("sendMsg",function(t){if(t.fromUser.toUser&&1==t.fromUser.toUser.talkStyle)studioChatMb.whTalk.receiveMsg(t,!1,!1);else{if(!t.serverSuccess&&studioChatMb.userInfo.userId==t.fromUser.userId&&!t.rule)return;studioChatMb.setContent(t,!1,!1)}}),this.socket.on("notice",function(t){switch(t.type){case"onlineNum":var e=t.data,i=e.onlineUserInfo;3==i.userType&&studioChatMb.whTalk.enable&&studioChatMb.whTalk.setCSOnline(i.userId,e.online),(3==i.userType||2==i.userType)&&studioChatMb.setFastContact(i,e.online);break;case"removeMsg":$("#"+t.data.replace(/,/g,",#")).remove(),studioChatMb.setListScroll($("#talkPanel"));break;case"leaveRoom":studioChatMb.leaveRoomTip(t.flag);break;case"approvalResult":var e=t.data,o=0;if(e.refuseMsg){var s=e.publishTimeArr;for(o in s)$("#"+s[o]+" .dialog em[class=ruleTipStyle]").html("已拒绝")}else{for(o in e)studioChatMb.formatUserToContent(e[o]);studioChatMb.setListScroll($("#talkPanel"))}break;case"pushInfo":var e=t.data;if(1==e.position)studioChatMb.pushObj.whInfos=e.infos;else if(3==e.position){studioChatMb.pushObj.talkPush=e.infos;for(var o=0,a=studioChatMb.pushObj.talkPush.length;a>o;o++)studioChatMb.pushObj.talkPush[o].nextTm=studioChatMb.pushObj.talkPush[o].serverTime+60*studioChatMb.pushObj.talkPush[o].onlineMin*1e3}break;case"serverTime":studioChatMb.serverTime=t.data}}),this.socket.on("loadMsg",function(t){var e=t.msgData,i=t.isAdd;if(i||$("#content_ul").html(""),e&&$.isArray(e)){e.reverse();for(var o in e)studioChatMb.formatUserToContent(e[o]);studioMbPop.loadingBlock($("#talkBoxTab"),!0),studioChatMb.setListScroll($("#talkPanel"),{toButtom:!0})}}),this.socket.on("loadWhMsg",function(t){var e=t.data;if(e&&$.isArray(e))for(var i,o=0,s=e.length;s>o;o++)i=e[o],studioChatMb.formatUserToContent(i,!0,t.toUserId)})},setVideoList:function(){studioMbPop.loadingBlock($("#videosTab")),this.getArticleList("teach_video_base,teach_video_gw,teach_video_expert",this.userInfo.groupId,0,1,100,'{"sequence":"desc","publishStartDate":"desc"}',null,function(t){var e=$("#videosTab .boxcont");if(e.html(""),t&&0==t.result){for(var i=t.data,o=[],s=null,a=0,r=i?i.length:0;r>a;a++)a%5==0&&o.push('<ul class="teach-ul">'),s=i[a].detailList[0],o.push('<li><a title="'+s.title+"\" href=\"javascript:void(0)\" onclick=\"_gaq.push(['_trackEvent', 'm_24k_studio', 'teachvideo_"+a+"', 'content_middle',1,true]);\" id=\""+i[a]._id+'" vurl="'+i[a].mediaUrl+'"><i></i><span>'+s.title+"</span></a></li>"),(a%5==4||a==r-1)&&o.push("</ul>"),e.html(o.join(""));e.find("li a").click(function(){$(this).is(".on")||($("#videosTab .boxcont li a.on").removeClass("on"),$(this).addClass("on")),studioChatMb.video.player.play($(this).attr("vUrl"),$(this).text()),chatAnalyze.setUTM(!1,$.extend({operationType:7,videoId:$(this).attr("id"),videoName:$(this).text()},studioChatMb.userInfo,studioChatMb.courseTick.course))})}studioChatMb.video.start(),studioMbPop.loadingBlock($("#videosTab"),!0)})},setEvent:function(){this.setEventCen(),this.video.init(),this.setEventChat(),this.setHeight(),this.browserState.initBrowserState()},setHeight:function(){$("#tVideoDiv").height(.55*$(".videopart").width());var t=0;t+=$(".videopart").height(),t+=$(".cen-ulist").is(":hidden")?0:$(".cen-ulist").height(),t+=$("#header").is(":hidden")?0:$("#header").height(),t=$(window).height()-t,$(".cen-pubox .boxcont:gt(1)").height(t),t-=$(".float-box").height(),$(".cen-pubox .boxcont:lt(2)").height(t)},setFastContact:function(t,e){var i=$("#talkViewCtrl");if(e){if(0==i.find("a[uid='"+t.userId+"']").size()){3==t.userType&&(t.nickname=t.nickname+"&nbsp;（助理）");var o=$('<a href="javascript:void(0)" class="" uid="'+t.userId+'">@'+t.nickname+"</a>");o.bind("click",t,function(t){var e=t.data;studioChatMb.setDialog(e.userId,e.nickname,0,e.userType,e.avatar)}),3==t.userType?i.find("a[t='analyst']").before(o):i.prepend(o)}}else i.find("a[uid='"+t.userId+"']").remove()},setEventCen:function(){$(".cen-ulist li").click(function(){$(".cen-ulist li.on").removeClass("on"),$(this).addClass("on");var t=$(this).attr("t");"talkBoxTab"==t?(studioChatMb.view.boardCtrl(1),studioChatMb.whTalk.whSwitch(!1)):"whTalkBoxTab"==t?(studioChatMb.whTalk.whSwitch(!0),studioChatMb.view.boardCtrl(1)):(studioChatMb.whTalk.whSwitch(!1),studioChatMb.view.boardCtrl(0),"TradeArticleTab"==t?(_gaq.push(["_trackEvent","m_24k_studio","suggest_tab","content_middle",1,!0]),studioChatMb.setTradeArticle()):"videosTab"==t&&_gaq.push(["_trackEvent","m_24k_studio","teachvideo_tab","content_middle",1,!0])),$("#cenTabPanel").children().hide().eq($(this).index()).show()}),$("#header_hb").bind("click",function(){window.location.href="/studio/home"}),$("#header_ui").bind("click",function(){studioChatMb.userInfo&&studioChatMb.userInfo.isLogin?studioMbPop.popBox("person"):studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientGroup:studioChatMb.userInfo.clientGroup,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.options.platform})}),$(window).resize(function(){studioChatMb.setHeight(),studioChatMb.setListScroll($(".mCustomScrollbar"))})},setEventChat:function(){$("#msgFaceBtn").bind("click",function(){$(this).blur(),2==studioChatMb.view.viewBoard?studioChatMb.view.boardCtrl(1):studioChatMb.view.boardCtrl(2),studioChatMb.face.init($("#facePanel"),$("#contentText"),studioChatMb.filePath+"/face/",!studioChatMb.visitorSpeak&&"visitor"==studioChatMb.userInfo.clientGroup)}),$("#talkBoxTab .view_select").click(function(){var t=$(this);t.is(".dw")?(t.removeClass("dw"),studioChatMb.view.viewSelect=!1):(t.addClass("dw"),studioChatMb.view.viewSelect=!0)}).find(".selectlist a").click(function(){if($(this).is("[t]")&&!$(this).is(".on")){$("#talkBoxTab .view_select .selectlist a").removeClass("on"),$("#talkBoxTab .view_select .selected").text($(this).text()),$(this).addClass("on");var t=$(this).attr("t");_gaq.push(["_trackEvent","m_24k_studio","filter_"+t,"content_left",1,!0]),studioChatMb.showViewSelect(t)}}),$(document).bind("click",function(t){if(studioChatMb.view.viewSelect){
var e=$("#talkBoxTab .view_select");e.is(t.target)||0!=e.find(t.target).length||e.trigger("click")}if(studioChatMb.whTalk.viewSelect){var e=$("#whThtalkBoxTab .view_select");e.is(t.target)||0!=e.find(t.target).length||e.trigger("click")}}),$("#contentText").keydown(function(t){var e=$(this).html();return 13==t.keyCode?(common.isValid(e)&&($(this).html(e.replace(/<div>|<\/div>/g,"")),$("#sendBtn").click()),!1):void 0}).keyup(function(t){if($.browser.msie&&$(this).trigger("input"),8==t.keyCode){var e=$(this).find(".txt_dia");if($.trim($(this).text())==e.text()&&0==$(this).find("img").length)return e.remove(),$(this).html(""),!0}}).focus(function(){4==studioChatMb.view.viewBoard&&studioChatMb.view.boardCtrl(1)}).blur(function(){}).bind("input",function(){var t=$.trim($(this).text())!=$(this).find(".txt_dia").text()||$(this).find("img").size()>0;t?($("#sendBtn").show(),$("#sendToolBtn").hide(),$("#floatBox").removeClass("send-add")):($("#sendBtn").hide(),$("#sendToolBtn").show(),$("#floatBox").addClass("send-add"))}),$("#sendBtn").click(function(){if($(this).blur(),studioChatMb.view.boardCtrl(1),!studioChatMb.whTalk.tabCheck&&!studioChatMb.visitorSpeak&&"visitor"==studioChatMb.userInfo.clientGroup)return void studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientGroup:studioChatMb.userInfo.clientGroup,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.options.platform});if(studioChatMb.userInfo.isSetName===!1)return void studioMbPop.popBox("set",{studioChatObj:studioChatMb});var t=studioChatMb.getToUser(),e=studioChatMb.getSendMsg();if(e!==!1){var i={uiId:studioChatMb.getUiId(),fromUser:studioChatMb.userInfo,content:{msgType:studioChatMb.msgType.text,value:e}};i.fromUser.toUser=t,studioChatMb.whTalk.tabCheck?studioChatMb.whTalk.sendWhMsg(i):(studioChatMb.socket.emit("sendMsg",i),studioChatMb.setContent(i,!0,!1)),$("#contentText").html("").trigger("input"),chatAnalyze.setUTM(!1,$.extend({operationType:2},studioChatMb.userInfo,studioChatMb.courseTick.course))}}),$("#sendToolBtn").click(function(){4==studioChatMb.view.viewBoard?studioChatMb.view.boardCtrl(1):studioChatMb.view.boardCtrl(4)}),$("#top_msg").click(function(){var t=$(this).find("label");$(this).slideUp(),studioChatMb.setDialog(t.attr("fuserId"),t.attr("fnickname"),0,t.attr("fuType"),null)}),$("#top_msg i").click(function(){return $("#top_msg").slideUp(),!1}),$(".file-img").click(function(){return FileReader?studioChatMb.whTalk.tabCheck||studioChatMb.visitorSpeak||"visitor"!=studioChatMb.userInfo.clientGroup?studioChatMb.userInfo.isSetName===!1?(studioMbPop.popBox("set",{studioChatObj:studioChatMb}),!1):void 0:(studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientGroup:studioChatMb.userInfo.clientGroup,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.options.platform}),!1):(alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！"),!1)}),$(".file-img").bind("change",function(){var t=this,e=t.files[0];if(!e)return!1;if(0!=e.type.indexOf("image")||!e.type||!/\.(?:jpg|png|gif)$/.test(e.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=e.size;if(i>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var o=new FileReader;o.readAsDataURL(e),o.onload=function(t){studioChatMb.setUploadImg(t.target.result,studioChatMb.getToUser())},o.onprogress=function(t){},o.onloadend=function(t){},studioChatMb.view.boardCtrl(1),$(this).val("")})},setUploadImg:function(t,e){var i=studioChatMb.getUiId(),o={};common.copyObject(o,studioChatMb.userInfo,!0),o.toUser=e;var s={uiId:i,fromUser:o,content:{msgType:this.msgType.img,value:"",needMax:0,maxValue:""}};studioChatMb.whTalk.tabCheck?studioChatMb.whTalk.sendWhMsg(s):this.setContent(s,!0,!1),s.content.value=t,this.zipImg(s,100,60,function(t,e){if(t.error)return alert(t.error),$("#"+i).remove(),!1;var o=$("#"+t.uiId+" span[contt='a'] a");o.attr("url",e).children("img").attr("src",e).attr("needMax",t.content.needMax),studioChatMb.dataUpload(t)})},zipImg:function(t,e,i,o){var s=new Image;s.onload=function(){var a=document.createElement("canvas");a||o({error:"发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！"});var r=s.width,n=s.height;if(n>=9*r)return o({error:"该图片高度太高，暂不支持发送！"}),!1;e>0&&(n>e||r>e)&&(t.content.needMax=1,n>e&&e>=r?(r=e/n*r,n=e):(n=e/r*n,r=e),s.height=n,s.width=r);var u=a.getContext("2d");a.width=r,a.height=n,u.clearRect(0,0,a.width,a.height),u.drawImage(s,0,0,r,n),o(t,a.toDataURL("image/jpeg",i/100))},s.src=t.content.value},dataUpload:function(t){var e=new XMLHttpRequest;e.open("POST","/studio/uploadData"),e.addEventListener("progress",function(e){if(e.lengthComputable){var i=(e.loaded/e.total*100|0)+"%";$("#"+t.uiId+" .shadow-box").css({height:"'+ra+'"}),$("#"+t.uiId+" .shadow-conut").html(i)}},!1),e.setRequestHeader("Content-Type","application/json; charset=utf-8"),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&console.log("dataUpload success!")},t.fromUser.socketId=this.socket.id,e.send(JSON.stringify(t))},view:{viewSelect:!1,viewBoard:1,boardCtrl:function(t){if(this.viewBoard!=t){this.viewBoard=t;var e={header:$("#header"),backToLive:$("#backToLive"),floatBox:$("#floatBox"),facePanel:$("#facePanel"),imgBox:$("#sendToolPanel")};switch(t){case 0:e.header.show(),e.backToLive.data("showBoard",!0).trigger("show"),e.floatBox.hide();break;case 1:e.header.show(),e.backToLive.data("showBoard",!0).trigger("show"),e.floatBox.show(),e.facePanel.hide(),e.imgBox.hide();break;case 2:e.header.hide(),e.backToLive.data("showBoard",!1).trigger("show"),e.floatBox.show(),e.facePanel.show(),e.imgBox.hide();break;case 3:e.header.show(),e.backToLive.data("showBoard",!1).trigger("show"),e.floatBox.show(),e.facePanel.hide(),e.imgBox.hide();break;case 4:e.header.hide(),e.backToLive.data("showBoard",!1).trigger("show"),e.floatBox.show(),e.facePanel.hide(),e.imgBox.show()}}}},video:{$panel:$("#tVideoDiv"),init:function(){$("#tVideoDiv").css({"z-index":"inherit"}),this.setEvent()},start:function(t){var e=common.getSyllabusPlan(studioChatMb.syllabusData,studioChatMb.serverTime,!1,!0);!e||e.isNext||0!=e.courseType&&common.isBlank(e.studioLink)||2==e.courseType||0==e.courseType?t?studioMbPop.showMessage("目前还没有视频直播，详情请留意直播间的课程安排！"):e&&!e.isNext&&0==e.courseType?($(".videopart").hide().css({height:"0"}),studioChatMb.setHeight()):this.playMp4Vd():this.player.play(e.studioLink,"")},playMp4Vd:function(){if($("#studioTeachId a[class=on]").length<=0){var t=$("#videosTab li a"),e=$(t.get(common.randomIndex(t.length)));e.click()}},setEvent:function(){$("#backToLive").css({left:function(){return $(window).width()-$(this).width()-10},top:function(){return $(window).height()-$("#header").height()-70}}).data("showBoard",!0).data("showVideo",!0).bind("show",function(){var t=$(this);t.data("showBoard")&&t.data("showVideo")?t.show():t.hide()}),$("#backToLive").draggable({start:function(){$(this).css("background","#1A4C90")},stop:function(){$(this).css("background","#4874b0")}}),$("#backToLive").bind("click",function(){studioChatMb.socket.emit("serverTime"),window.setTimeout(function(){studioChatMb.video.start(!0)},1e3)}),$("#videoPop").bind("click",function(){studioChatMb.video.popVideoWindow(),$("#videoPopPlay").show(),$(this).hide()}),$("#videoPopPlay").bind("click",function(){var t=$("#tVideoDiv"),e=studioChatMb.video.player,i=e.videoData(t,"currVideoUrl"),o=e.videoData(t,"currVideoTitle");e.play(i,o)})},popVideoWindow:function(){studioChatMb.video.player.clear($("#tVideoDiv")),$("#videoPop").hide(),$("#videoPopPlay").show();var t=$("#tVideoDiv"),e=studioChatMb.video.player,i=e.videoData(t,"currVideoUrl"),o=e.videoData(t,"currVideoTitle"),s="url="+encodeURIComponent(i)+"&title="+encodeURIComponent(o);window.open("/studio/gotoVideo?"+s,"studioVideoWindow","height=600,width=800,top=0,right=0,toolbar=no,menubar=no,scrollbars=no,location=no,status=no")},player:{videoData:function(t,e,i){var o=t.data("videoData")||{};return 3==arguments.length?(o[e]=i,t.data("videoData",o),o):o[e]},playByIframe:function(t,e,i,o){this.clear(t),t.append('<iframe frameborder=0 width="100%" height="100%" src="'+e+'" allowfullscreen></iframe>')},playByBLWS:function(t,e,i,o){var s=e.split("&");if(s.length>1){var a=s[1].replace(/^vid=/g,"");if(this.clear(t),this.videoData(t,"isLoading"));else if(window.polyvObject){var r=polyvObject(t).videoPlayer({width:"100%",height:"100%",vid:a,flashvars:{autoplay:o,setScreen:"fill"},onPlayOver:function(t){}});this.videoData(t,"player",r)}else{this.videoData(t,"isLoading",!0);var n=this;LazyLoad.js(["/base/lib/polyvplayer.min.js"],function(){var e=polyvObject(t).videoPlayer({width:"100%",height:"100%",vid:a,flashvars:{autoplay:o,setScreen:"fill"},onPlayOver:function(t){}});n.videoData(t,"player",e),n.videoData(t,"isLoading",!1)})}}},playBySewise:function(t,e,i,o){if(this.clear(t),this.videoData(t,"isLoading"));else if(window.Sewise){var s=new Sewise.SewisePlayer({elid:t,autostart:o,url:e,title:i,skin:"vodWhite",localPath:"/base/lib/sewise/"});o&&s.startup(),this.videoData(t,"player",s)}else{this.videoData(t,"isLoading",!0);var a=this;LazyLoad.js(["/base/lib/sewise/sewise.player.min.js"],function(){var s=new Sewise.SewisePlayer({elid:t,autostart:o,url:e,title:i,skin:"vodWhite",localPath:"/base/lib/sewise/"});o&&s.startup(),a.videoData(t,"player",s),a.videoData(t,"isLoading",!1)})}},playByEmbed:function(t,e,i,o){this.clear(t);var s=[];s.push('<embed src="'),s.push(e),s.push('" autostart="'+o+'" wmode="Opaque" quality="high" width="100%" height="100%" align="middle" allowScriptAccess="never" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>'),t.html(s.join(""))},playByVideo:function(t,e,i,o){this.clear(t),t.html('<video src="'+e+'" controls="true" webkit-playsinline autoplay="'+o+'" style="width: 100%; height: 100%; background-color: rgb(0, 0, 0);"></video>');var s=t.find("video");o?s.trigger("play"):s.trigger("pause")},playByFlow:function(t,e,i,o){var s=/(.*)\/([0-9]+)\//g.exec(e);if(s&&!(s.length<3)){var a=null;if(a=-1!=e.indexOf("sz6")?"rtmps://5748416443938.streamlock.net/live":"rtmps://57721dbe47de5.streamlock.net/live",this.clear(t),this.videoData(t,"isLoading"));else if(window.flowplayer)flowplayer(t,"/base/lib/flowplayer/flowplayer.swf",{clip:{url:s[2],provider:"rtmp",live:!0},plugins:{rtmp:{proxyType:"best",url:"/base/lib/flowplayer/flowplayer.rtmp.swf",netConnectionUrl:a}},onError:function(t){}});else{this.videoData(t,"isLoading",!0);var r=this;LazyLoad.js(["/base/lib/flowplayer/flowplayer.min.js"],function(){flowplayer(t[0],"/base/lib/flowplayer/flowplayer.swf",{clip:{url:s[2],provider:"rtmp",live:!0},plugins:{rtmp:{proxyType:"best",url:"/base/lib/flowplayer/flowplayer.rtmp.swf",netConnectionUrl:a}},onError:function(t){}}),r.videoData(t,"isLoading",!1)})}}},clear:function(t){t.empty()},play:function(t,e){$("#videoPop").show(),$("#videoPopPlay").hide();var i=$("#backToLive");$(".videopart").is(":hidden")&&($(".videopart").show().css({height:"auto"}),studioChatMb.setHeight());var o=$("#tVideoDiv");/rtmp/.test(t)?(i.data("showVideo",!1).trigger("show"),$("#videosTab li a.on").removeClass("on")):i.data("showVideo",!0).trigger("show"),this.videoData(o,"currVideoUrl",t),this.videoData(o,"currVideoTitle",e),/type=blws/.test(t)?this.playByBLWS(o,t,e,!0):/rtmps/.test(t)?this.playByFlow(o,t,e,!0):/.mp4/i.test(t)?this.playBySewise(o,t,e,!0):this.playByEmbed(o,t,e,!0)}}},face:{initFace:!1,init:function(t,e,i,o){this.initFace||(this.build(t,i),new Swiper(t,{pagination:".swiper-pagination",paginationClickable:!0}),t.find("img").bind("click",{panel:t,assign:e,disabled:o},function(t){t.data.disabled||t.data.assign.append($(this).clone()).trigger("input")}),this.initFace=!0)},build:function(t,e){for(var i=[],o=7,s=1;75>=s;s+=21){i.push('<div class="swiper-slide"><table border="0" cellspacing="0" cellpadding="0">');for(var a=s,r=Math.min(s+20,75);r>=a;a++)a%o==1&&i.push("<tr>"),i.push('<td><img src="'+e+a+'.gif"/></td>'),(a%o==0||a==r)&&i.push("</tr>");i.push("</table></div>")}t.find("div.face").html(i.join(""))}},setListScroll:function(t,e){var i="object"==typeof t?t:$(t);e=$.extend({scrollButtons:{enable:!1},theme:"dark-2",toButtom:!1},e),i.hasClass("mCustomScrollbar")?(i.mCustomScrollbar("update"),e.toButtom&&i.mCustomScrollbar("scrollTo","bottom")):(i.mCustomScrollbar(e),e.toButtom&&i.mCustomScrollbar("scrollTo","bottom"))},getUiId:function(){var t=new Date;return t.getTime()+"_ms"},getArticleList:function(t,e,i,o,s,a,r,n){try{var u={code:t,platform:e,hasContent:i,pageNo:o,pageSize:s,orderByStr:a};r&&(u.authorId=common.trim(r)),$.getJSON("/studio/getArticleList",u,function(t){n(t)})}catch(l){console.error("getArticleList->"+l),n(null)}},setTradeArticle:function(){studioMbPop.loadingBlock($("#TradeArticleTab")),studioChatMb.getArticleList("trade_strategy_article",studioChatMb.userInfo.groupId,1,1,1,'{"createDate":"desc"}',null,function(t){var e=$("#TradeArticleTab ul:first"),i=[];if(t&&0==t.result){var o=t.data;if(o&&o.length>0)for(var s=null,a=null,r=0,n=o.length;n>r;r++)s=o[r].detailList[0],a=s.authorInfo||{},i.push("<li>"),i.push('<div class="himg"><img src="'+(a.avatar||"")+'"></div>'),i.push('<div class="detail">'),i.push("<h3>"+s.title+"</h3>"),i.push('<div class="subinfo">'),i.push("<span>"+(a.name||"")+"</span>"),i.push("<span>"+(o[r].publishStartDate?common.longMsTimeToDateTime(o[r].publishStartDate):"")+"</span>"),i.push("</div>"),i.push("<p>"+s.content+"</p>"),i.push("</div>")}e.html(i.join("")),$("#TradeArticleTab .detail p span").attr("style",""),studioMbPop.loadingBlock($("#TradeArticleTab"),!0)})},showViewSelect:function(t){var e=$("#dialog_list");"analyst"==t?(e.children("[utype!=2]").hide(),e.children("[utype=2]").show()):"me"==t?(e.children("[isme='false']").hide(),e.children("[isme='true']").show()):e.children().show(),studioChatMb.setListScroll($("#talkPanel"),{toButtom:!0})},getSendMsg:function(t){if(t=t||$("#contentText"),t.text().length+t.find("img").size()>140)return studioMbPop.showMessage("消息内容超过最大长度限制（140字以内）！"),!1;var e=t.html();return e=common.clearMsgHtml(e),common.isBlank(e)?(t.html(""),!1):(t.find(".txt_dia").length>0&&(t.find(".txt_dia").remove(),e=t.html(),e=e.replace(/^(&nbsp;){1,2}/,"")),e)},getToUser:function(){var t=$("#contentText .txt_dia");return t.length>0?{userId:t.attr("uid"),nickname:t.find("label").text(),talkStyle:0,userType:t.attr("utype"),avatar:t.attr("avatar")}:null},formatPublishTime:function(t){if(common.isBlank(t))return"";var e=Number(t.replace(/_.+/g,""));return e+=studioChatMb.options.timezoneLs,common.getHHMM(e)},setDialog:function(t,e,i,o,s){(studioChatMb.visitorSpeak||"visitor"!=studioChatMb.userInfo.clientGroup)&&($("#contentText .txt_dia").remove(),$("#contentText").html($("#contentText").html().replace(/^((&nbsp;)+)/g,"")),$("#contentText").prepend('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+t+'" utype="'+o+'" avatar="'+s+'">@<label>'+e+"</label></span>&nbsp;").focusEnd())},setContent:function(t,e,i){var o=t.fromUser;if(e&&(o.publishTime=t.uiId),t.isVisitor)return void $("#"+t.uiId).remove();if(i&&$("#"+o.publishTime).length>0)return $("#"+o.publishTime+" .dialog em[class=ruleTipStyle]").remove(),void $("#"+o.publishTime+" input").remove();if(t.rule)return void(t.value&&t.value.needApproval?$("#"+t.uiId).attr("id",o.publishTime):$("#"+t.uiId+" .dialog").append('<em class="ruleTipStyle">'+t.value.tip+"</em>"));if(e||studioChatMb.userInfo.userId!=o.userId||!t.serverSuccess){var s=studioChatMb.formatContentHtml(t,e,i,!1),a=$("#dialog_list");$("#talkPanel");a.append(s),i||studioChatMb.setListScroll($("#talkPanel"),{toButtom:!0}),this.formatMsgToLink(o.publishTime);var r=$("#talkBoxTab .view_select .selectlist a[class=on]").attr("t");"all"!=r&&studioChatMb.showViewSelect(r),$("#"+o.publishTime+" .c-menu a").click(function(){var t=$(this).parents(".c-menu");studioChatMb.setDialog(t.attr("uid"),t.attr("nk"),$(this).attr("t"),t.attr("utype"))}),$("#"+o.publishTime+" .headimg").click(function(){$("#"+o.publishTime+" .c-menu a[t=0]").trigger("click")}),$("#"+o.publishTime+" .txt_dia").click(function(){studioChatMb.setDialog($(this).attr("uid"),$(this).find("label").text(),0,$(this).attr("utype"))}),$("#"+o.publishTime+" .uname").click(function(){$("#"+o.publishTime+" .c-menu a[t=0]").trigger("click")})}else if($("#"+t.uiId+" .uname span").html(studioChatMb.formatPublishTime(o.publishTime)),$("#"+t.uiId).attr("id",o.publishTime),t.content.msgType==studioChatMb.msgType.img){studioChatMb.removeLoadDom(o.publishTime);var n=$("#"+o.publishTime+' span[contt="a"]>a'),u=t.content.needMax?"/studio/getBigImg?publishTime="+o.publishTime+"&userId="+o.userId:n.children("img").attr("src");n.attr("url",u)}},formatContentHtml:function(t,e,i,o){var s,a="clearfix ",r="",n="false",u="",l=t.fromUser,d=t.content,c=l.nickname,h=l.toUser,p=[],m="";studioChatMb.userInfo.userId==l.userId&&e&&(l.publishTime=t.uiId,m='<em class="img-loading"><i></i></em><span class="shadow-box"></span><s class="shadow-conut"></s>'),d.msgType==studioChatMb.msgType.img?(s=d.needMax?'<a href="javascript:void(0)" onclick="studioChatMb.showImgInWindow(this)" url="/studio/getBigImg?publishTime='+l.publishTime+"&userId="+l.userId+'"><img src="'+d.value+'" alt="图片"/></a>':'<a href="javascript:void(0)" onclick="studioChatMb.showImgInWindow(this)" url="'+d.value+'"><img src="'+d.value+'" alt="图片" /></a>',s='<span contt="a">'+s+"</span>"+m):s='<span contt="a">'+d.value+"</span>",h&&common.isValid(h.userId)?(o?p.push(s):common.isValid(h.question)?(p.push('<p class="question"><em>'),p.push('<strong class="asker" uid="'+h.userId+'" utype="'+h.userType+'">'+h.nickname+"</strong>"),p.push("提问：</em>"),p.push('<span contt="q">'+h.question+"</span>"),p.push("</p>"),p.push('<p class="reply"><span>回复：</span>'),p.push(s),p.push("</p>")):(p.push('<span class="txt_dia" uid="'+h.userId+'" utype="'+h.userType+'">'),p.push("@<label>"+h.nickname+"</label>"),p.push("</span>"),p.push(s)),studioChatMb.userInfo.userId==h.userId&&(n="true")):p.push(s),studioChatMb.userInfo.userId==l.userId?(a+="me-li",c="我",n="true",o&&h&&(u=" csid="+h.userId)):(3==l.userType?(c+="&nbsp;（助理）",a+="admin"):2==l.userType?a+="analyst":1==l.userType&&(a+="admin"),o&&(u=" csid="+l.userId),r=o?"":studioChatMb.getDialogHtml(l.userId,c,l.userType),!i&&h&&(studioChatMb.userInfo.userId!=h.userId||o||($("#top_msg label").html(l.nickname+":@"+h.nickname).attr("tId",h.userId).attr("fuType",l.userType).attr("fnickname",l.nickname).attr("fuserId",l.userId),$("#top_msg span").html(d.value),$("#top_msg").slideDown())));var f=[];return f.push('<li class="'+a+'" id="'+l.publishTime+'" isme="'+n+'" utype="'+l.userType+'" mType="'+d.msgType+'" t="header"'+u+">"),f.push('<div class="headimg" uid="'+l.userId+'">'),f.push(studioChatMb.getUserAImgCls(l.userId,l.clientGroup,l.userType,l.avatar)),f.push("</div>"),f.push('<div class="detail">'),f.push('<span class="uname">'),studioChatMb.userInfo.userId==l.userId?(f.push("<span>"+studioChatMb.formatPublishTime(l.publishTime)+"</span>"),f.push("<strong>"+c+"</strong>")):(f.push("<strong>"+c+"</strong>"),f.push("<span>"+studioChatMb.formatPublishTime(l.publishTime)+"</span>")),f.push("</span>"),f.push('<div class="dialog">'+p.join("")+"</div>"),f.push("</div>"),f.push(r),f.push("</li>"),f.join("")},showImgInWindow:function(t){var e=$(t).attr("url");e&&window.open(e,"studioImgWindow","top=0,right=0,toolbar=no,menubar=no,scrollbars=no,location=no,status=no")},formatMsgToLink:function(t){$("#"+t+' span[contt]:contains("http:"),#'+t+' span[contt]:contains("https:")').each(function(t,e){var i,o=$(e).html(),s=o.split(/<img[^>]*>|<a[^>]*>.*?<\/a>/g);for(var a in s)if(i=s[a],!common.isBlank(i)){var r=i.replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\\&|-)+)(:\d+)?(\/|\S)+/g,function(t){return'<a href="'+t+'" target="_blank">'+t+"</a>"});e.innerHTML=e.innerHTML.replace(i,r)}})},removeLoadDom:function(t){$("#"+t+" .img-loading,#"+t+" .img-load-gan,#"+t+" .shadow-box,#"+t+" .shadow-conut").remove()},getUserAImgCls:function(t,e,i,o){var s="";if(common.isValid(o))return'<img src="'+o+'">';if("vip"==e)s="user_v";else{if("active"==e){var a=0;return t&&t.length>0&&(a+=t.charCodeAt(0)+t.charCodeAt(t.length-1)),a=(a+15)%40,'<img src="'+studioChatMb.filePath+"/upload/pic/header/chat/visitor/"+a+'.png">'}if("notActive"==e)s="user_r";else if("simulate"==e)s="user_d";else if("register"==e)s="user_m";else{if("visitor"==e||-1==i){t=t||"";var a=parseInt(t.substring(t.length-2),10);return isNaN(a)&&(a=100),a=(a+17)%40,'<img src="'+studioChatMb.filePath+"/upload/pic/header/chat/visitor/"+a+'.png">'}s="user_c"}}return'<img src="/pm/theme4/img/'+s+'.png">'},leaveRoomTip:function(t){if("roomClose"==t)studioMbPop.showMessage("注意：房间已停用，正自动登出..."),"visitor"==studioChatMb.userInfo.clientGroup?window.setTimeout(function(){studioMbPop.reload()},2e3):window.setTimeout(function(){LoginAuto.setAutoLogin(!1),window.location.href="/studio/logout"},2e3);else if("otherLogin"==t){if("visitor"==studioChatMb.userInfo.clientGroup)return;studioChatMb.socket.disconnect(),studioMbPop.popBox("msg",{msg:"注意：您的账号已在其他页面或手机端登陆，此处被登出！",type:"logout"})}},getDialogHtml:function(t,e,i){if(studioChatMb.userInfo.userId!=t){var o=!1,s=$("#studioListId a[class~=ing]"),a='<div class="c-menu" style="display:none;" nk="'+e+'" uid="'+t+'" utype="'+i+'">';return a+="<ul>",(studioChatMb.visitorSpeak||-1==studioChatMb.userInfo.userId.indexOf("visitor_")&&t&&-1==t.indexOf("visitor_"))&&(a+='<li><a href="javascript:void(0)" t="0"><i></i>@TA</a></li>',o=!0),"true"==s.attr("aw")&&common.containSplitStr(s.attr("awr"),i)&&(a+='<li><a href="javascript:void(0)" t="1"><i></i>私信</a></li>',o=!0),a+="</ul>",o?a+"</div>":""}return""},formatUserToContent:function(t,e,i){var o={userId:t.userId,nickname:t.nickname,avatar:t.avatar,userType:t.userType,groupId:t.groupId,clientGroup:t.clientGroup,publishTime:t.publishTime,toUser:t.toUser,position:t.position};e?(o.toWhUserId=i,studioChatMb.whTalk.receiveMsg({fromUser:o,content:t.content},!1,!0)):studioChatMb.setContent({fromUser:o,content:t.content},!1,!0)},showTalkPushMsg:function(t){var e=[];e.push('<li class="clearfix push">'),e.push(t.content),e.push("</div>");$("#talkPanel");$("#dialog_list").append(e.join("")),studioChatMb.setListScroll($("#talkPanel"),{toButtom:!0})},browserState:{hiddenProperty:"hidden",visibilityStateProperty:"visibilityState",visibilityEvent:"visibilitychange",getBrowserPrefix:function(){if("hidden"in document)return null;for(var t=["moz","ms","o","webkit"],e=0;e<t.length;e++){var i=t[e]+"Hidden";if(i in document)return t[e]}return null},initBrowserState:function(){var t=this.getBrowserPrefix();t?(this.hiddenProperty=t+"Hidden",this.visibilityStateProperty=t+"VisibilityState",this.visibilityEvent=t+"visibilitychange"):(this.hiddenProperty="hidden",this.visibilityStateProperty="visibilityState",this.visibilityEvent="visibilitychange"),this.setBrowserStateEvent()},setBrowserStateEvent:function(){document.addEventListener(this.visibilityEvent,function(){"visible"===document[studioChatMb.browserState.visibilityStateProperty]&&studioChatMb.socket.emit("serverTime")})}},whTalk:{enable:!1,status:0,tabCheck:!1,CSMap:{},currCS:null,msgCnt:0,pushObj:null,askMsgObj:null,viewSelect:!1,initWH:function(){this.enable="true"==$("#currStudioInfo").attr("aw"),this.refreshTips(),$("#whTalkBoxTab .view_select").click(function(){var t=$(this);t.is(".dw")?(t.removeClass("dw"),studioChatMb.whTalk.viewSelect=!1):(t.addClass("dw"),studioChatMb.whTalk.viewSelect=!0)}).find(".selectlist a").live("click",function(){if(!$(this).is(".on")){var t=$(this).attr("uid");studioChatMb.whTalk.setCurrCS({userId:t})}})},whSwitch:function(t){t?(this.tabCheck=!0,this.msgCnt=0,this.refreshTips(),this.setWHTalkListScroll(),this.pushMsg()):this.tabCheck=!1},loadMsg:function(t){if(this.CSMap.hasOwnProperty(t)&&!this.CSMap[t].load){var e=this.CSMap[t];e.load=!0,studioChatMb.socket.emit("getWhMsg",{clientStoreId:studioChatMb.userInfo.clientStoreId,userType:studioChatMb.userInfo.userType,groupId:studioChatMb.userInfo.groupId,groupType:studioChatMb.userInfo.groupType,userId:studioChatMb.userInfo.userId,toUser:{userId:e.userNo,userType:e.userType}})}},setCurrCS:function(t){var e=null;if(t&&t.userId)this.CSMap.hasOwnProperty(t.userId)?e=this.CSMap[t.userId]:(e={userNo:t.userId,userName:t.userName||t.nickname,online:!0,load:!1,userType:t.userType,avatar:t.avatar},this.CSMap[t.userId]=e);else{var i=null;for(var o in this.CSMap)i=this.CSMap[o],(!e||3!=e.userType&&3==i.userType||e.userType==i.userType&&!e.online&&i.online)&&(e=i)}if(!e)return null;if(e.load||this.loadMsg(e.userNo),e.userNo){this.currCS=e;var s=$("#whTalkBoxTab .view_select"),a=s.find("a[uid="+this.currCS.userNo+"]");return s.find(".selectlist a").removeClass("on"),0==a.size()?(s.find(".selectlist").append('<a href="javascript:void(0)" class="on" uid="'+this.currCS.userNo+'">'+this.currCS.userName+"</a>"),s.find(".selected").text(this.currCS.userName)):(a.addClass("on"),s.find(".selected").text(a.text())),s.find(".selectlist a").size()<=1?s.hide():(s.show(),$("#whDialog_list").children().hide(),$("#whDialog_list").children("[csid="+this.currCS.userNo+"]").show(),this.setWHTalkListScroll()),e}return null},getCSList:function(){try{$.getJSON("/studio/getCS",{groupId:studioChatMb.userInfo.groupId},function(t){if(t&&t.length>0)for(var e,i,o=0,s=t.length;s>o;o++)e=t[o],studioChatMb.whTalk.CSMap.hasOwnProperty(e.userNo)?i=studioChatMb.whTalk.CSMap[e.userNo]:(i={online:!1},studioChatMb.whTalk.CSMap[e.userNo]=i),i.userNo=e.userNo,i.userName=e.userName,i.userType=3,i.avatar=common.isValid(e.avatar)?e.avatar:"/pm/theme4/img/cm.png",i.load=!1})}catch(t){console.error("getCSList->"+t)}},setCSOnline:function(t,e){var i=null;this.CSMap.hasOwnProperty(t)?i=this.CSMap[t]:(i={},this.CSMap[t]=i),i.online=e},refreshTips:function(){studioChatMb.whTalk.msgCnt>0?$(".wh_tips").text(studioChatMb.whTalk.msgCnt).show():$(".wh_tips").hide()},setWHTalkListScroll:function(){studioChatMb.setListScroll($("#whTalkPanel"),{toButtom:!0})},receiveMsg:function(t,e,i){var o=t.fromUser;if(e&&(o.publishTime=t.uiId),t.isVisitor)return void $("#"+t.uiId).remove();if(i&&$("#"+o.publishTime).length>0)return $("#"+o.publishTime+" .dialog em.ruleTipStyle").remove(),void $("#"+o.publishTime+" input").remove();if(t.rule)return void(t.value&&t.value.needApproval?$("#"+t.uiId).attr("id",o.publishTime):$("#"+t.uiId+" .dialog").append('<em class="ruleTipStyle">'+t.value.tip+"</em>"));if(e||studioChatMb.userInfo.userId!=o.userId||!t.serverSuccess){var s=studioChatMb.formatContentHtml(t,e,i,!0);$("#whTalkPanel");if(i?$("#whDialog_list").prepend(s):$("#whDialog_list").append(s),this.tabCheck&&studioChatMb.whTalk.setWHTalkListScroll(),studioChatMb.formatMsgToLink(o.publishTime),studioChatMb.userInfo.userId!=o.userId&&$("#"+o.publishTime+" .uname,#"+o.publishTime+" .headimg").click(function(){var t=$(this).parents("li:first"),e={userId:t.find(".headimg").attr("uid"),nickname:t.find(".uname strong").text(),userType:t.attr("utype"),avatar:t.find(".headimg img").attr("src")};studioChatMb.whTalk.setCurrCS(e)}),this.tabCheck||i||(studioChatMb.whTalk.msgCnt++,this.refreshTips()),i||studioChatMb.userInfo.userId==o.userId||this.setCurrCS(o),i||(this.askMsgObj=null),i&&o.toUser&&common.isValid(o.toUser.question)){var a=this.setCurrCS({userId:o.toUser.userId});this.receiveMsg({content:{maxValue:"",msgType:"text",status:1,value:o.toUser.question},fromUser:{nickname:a.userName,userId:a.userNo,userType:a.userType,avatar:a.avatar,publishTime:o.toUser.publishTime}},!1,!0)}}else if($("#"+t.uiId+" .uname span").html(studioChatMb.formatPublishTime(o.publishTime)),$("#"+t.uiId).attr("id",o.publishTime),t.content.msgType==studioChatMb.msgType.img){studioChatMb.removeLoadDom(o.publishTime);var r=$("#"+o.publishTime+' span[contt="a"]>a'),n=t.content.needMax?"/studio/getBigImg?publishTime="+o.publishTime+"&userId="+o.userId:r.children("img").attr("src");r.attr("url",n)}},pushMsg:function(){this.currCS||this.setCurrCS(),this.pushObj&&this.currCS&&(this.receiveMsg({content:{maxValue:"",msgType:"text",status:1,value:this.pushObj.info},fromUser:{nickname:this.currCS.userName,userId:this.currCS.userNo,userType:this.currCS.userType,avatar:this.currCS.avatar,publishTime:this.pushObj.publishTime}},!1,!1),this.askMsgObj=this.pushObj,this.pushObj=null)},sendWhMsg:function(t){return this.currCS||this.setCurrCS(),this.currCS?(t.fromUser.toUser={userId:this.currCS.userNo,nickname:this.currCS.nickname,talkStyle:1,userType:this.currCS.userType},this.askMsgObj&&(t.fromUser.toUser.question=this.askMsgObj.info,t.fromUser.toUser.questionId=this.askMsgObj.infoId,t.fromUser.toUser.publishTime=this.askMsgObj.publishTime),studioChatMb.whTalk.receiveMsg(t,!0,!1),t.content.msgType!=studioChatMb.msgType.img&&studioChatMb.socket.emit("sendMsg",t),void chatAnalyze.setUTM(!1,$.extend({operationType:8,userTel:$("#person_mb").text()},studioChatMb.userInfo,studioChatMb.courseTick.course))):void studioMbPop.showMessage("老师助理不在线，暂不可私聊！")}},setPushInfo:function(){var t=null,e=studioChatMb.pushObj.whInfos;if(e&&e.length>0)for(var i=0,o=e.length;o>i;i++)t=e[i],t.pushed||t&&studioChatMb.serverTime>=t.serverTime+60*t.timeOut*1e3&&(t.pushed=!0,studioChatMb.whTalk.pushObj={info:t.content,publishTime:t.publishTime,infoId:t.contentId},studioChatMb.whTalk.pushMsg());var s=null,a=studioChatMb.pushObj.talkPush;if(a&&a.length>0)for(var i=0,r=a.length;r>i;i++)s=a[i],s&&s.nextTm&&studioChatMb.serverTime>=s.nextTm&&common.dateTimeWeekCheck(s.pushDate,!1,studioChatMb.serverTime)&&(s.intervalMin&&s.intervalMin>0?s.nextTm=studioChatMb.serverTime+60*s.intervalMin*1e3:delete s.nextTm,studioChatMb.showTalkPushMsg(s))},courseTick:{course:{courseId:"",courseType:0,courseTypeName:"",day:0,endTime:"",isNext:!1,lecturer:"",lecturerId:"",startTime:"",status:0,studioLink:null,title:"",courseName:""},nextTickTime:0,tick:function(){if(!(studioChatMb.serverTime<=this.nextTickTime)){var currCourse=common.getSyllabusPlan(studioChatMb.syllabusData,studioChatMb.serverTime);if(currCourse){var nextTime=0,timezoneOffset=6e4*(new Date).getTimezoneOffset();if(nextTime=currCourse.isNext?6e4*eval(currCourse.startTime.replace(":","*60+"))+studioChatMb.serverTime-studioChatMb.serverTime%864e5+timezoneOffset:6e4*eval(currCourse.endTime.replace(":","*60+"))+studioChatMb.serverTime-studioChatMb.serverTime%864e5+timezoneOffset+6e4,this.nextTickTime!=nextTime){var courseType={0:"文字直播",1:"视频直播",2:"oneTV直播"},courseId=common.formatterDate(studioChatMb.serverTime,"-")+"_"+currCourse.startTime+"_"+studioChatMb.userInfo.groupId;this.course=currCourse,this.course.courseId=courseId,common.isValid(currCourse.title)&&common.isValid(currCourse.lecturer)&&common.isValid(currCourse.courseType)&&(this.course.courseTypeName=courseType[currCourse.courseType],this.course.courseName=currCourse.title+"_"+currCourse.lecturer+"_"+courseType[currCourse.courseType]),this.nextTickTime=nextTime}}}}}};